var wiki={version:"1.25",browser:"chrome",test:!1,log:!1,settings:{version:"1.25",font:"sans",font_size:3,line_height:2,width:2,justify:!1,language:"en",theme:"light",contents:!0,contents_font_size:3,contents_line_height:5,contents_width:4,contents_bullets:!1,fixed_header:!0,auto_theme:!1,auto_theme_light:"light",auto_theme_dark:"black",links_new:!1,hide_links:!1},history:[],mostread:{articles:[],date:"",language:"en"}};function wikiLog(e){1==wiki.log&&console.log(e)}function wikiStartup(){var e=window.location.href;if(-1==e.indexOf(".m.wikipedia.org")){var t=new URLSearchParams(window.location.search),i=!1;if(0==(i=1==t.has("useskin")&&"vector"==t.get("useskin")?!0:i)){i=new URL(window.location.href);return i.searchParams.set("useskin","vector"),void window.location.replace(i)}chrome.storage.local.get(["enabled"],function(e){void 0!==e.enabled&&1!=e.enabled||(e=getImageUrl("content.css"),document.head.insertAdjacentHTML("beforeend",'<link rel="stylesheet" type="text/css" href="'+e+'">'),wikiSetup())}),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){1==wiki.settings.auto_theme&&(e.matches?updateSettingTheme(wiki.settings.auto_theme_dark):updateSettingTheme(wiki.settings.auto_theme_light))})}else window.location.replace(e.replace(".m.wikipedia.org",".wikipedia.org"))}function wikiSetup(){$("body").addClass("theme-not-mac"),loadSettings(),loadHistory(),loadMostRead(),wikiDrawHeader(),wikiDrawContents(),wikiDrawTopButton(),wikiSetupArticle(),wikiSetupSearch(),wikiSetupCollapsed(),wikiSetupEvents(),wikiSetupImages()}function loadMostRead(){chrome.storage.local.get(["mostread"],function(e){var t,i,n,s;void 0!==e.mostread?(t=wikiGetLanguage(),i=(s=new Date).getFullYear(),(n=s.getMonth()+1)<10&&(n="0"+n),(s=s.getDate())<10&&(s="0"+s),(e=JSON.parse(e.mostread)).date!=i+"-"+n+"-"+s||e.language!=t?grabMostRead():wiki.mostread=e):grabMostRead()})}function grabMostRead(){var e=wikiGetLanguage(),t=new Date,i=t.getFullYear(),n=t.getMonth()+1,t=t.getDate();wiki.mostread.date==i+"-"+(n=n<10?"0"+n:n)+"-"+(t=t<10?"0"+t:t)&&wiki.mostread.language==e||$.ajax({url:"https://"+e+".wikipedia.org/api/rest_v1/feed/featured/"+i+"/"+n+"/"+t,type:"GET",data:{},timeout:15e3,dataType:"json",success:function(e){if(void 0!==e.mostread&&void 0!==e.mostread.articles){wiki.mostread.articles=[];for(var t=0;t<e.mostread.articles.length;t++){var i=e.mostread.articles[t],n="";void 0!==i.thumbnail&&void 0!==i.thumbnail.source&&(n=i.thumbnail.source);var s="";0==(s=void 0!==i.description?i.description:s).length&&(s=i.extract.slice(0,50)),wiki.mostread.articles.push({title:i.titles.display,description:s,views:i.views,rank:i.rank,thumb:n,url:i.content_urls.desktop.page})}var a=new Date,o=a.getFullYear(),r=a.getMonth()+1,a=a.getDate();wiki.mostread.date=o+"-"+(r=r<10?"0"+r:r)+"-"+(a=a<10?"0"+a:a),wiki.mostread.language=wikiGetLanguage(),saveMostRead()}}})}function saveMostRead(){chrome.storage.local.set({mostread:JSON.stringify(wiki.mostread)})}function clearMostRead(){chrome.storage.local.remove("mostread"),wiki.mostread={articles:[],date:"",language:"en"}}function wikiSetupHistory(){$(window).bind("popstate",function(e){location.hash.replace("#","");0<$(":target").length?($(":target")[0].scrollIntoView(),console.log("popstate - scrollIntoView")):console.log("popstate"),updateContentsSelection()})}function hideLoadingOverlay(){$("#wiki_loading").addClass("wiki-loading-hide"),setTimeout(function(){$("#wiki_loading").remove()},420)}function wikiSetupArticle(){0<$("#firstHeading").length&&$("#firstHeading").is(":visible")&&(0<$(".shortdescription").length?($(".mw-parser-output").prepend($(".shortdescription").first().show().remove()),$("<div />").addClass("wiki-tagline-sep").insertAfter($(".shortdescription").first())):1==wikiOnArticlePage()&&$(".mw-parser-output").prepend($("<div />").addClass("wiki-tagline-spacer")));var e=$("<div />").addClass("wiki-footer").insertBefore("#footer");e.append($("footer").remove()),$("<div />").addClass("wiki-footer-clear").appendTo(e),$(".thumbimage, .infobox-image img").each(function(e){var t=$(this).attr("width");$(this).attr("data-file-width");"220"==t&&$(this).attr("width","400")}),(0<$("#t-info a").length||0<$("#t-permalink a").length||0<$("#t-whatlinkshere a").length||0<$("#t-wikibase a").length||0<$("#t-cite a").length||0<$("#coll-download-as-rl a").length||0<$('a[rel="discussion"]').length||0<$("#ca-history a").length||0<$("#ca-edit a").length||0<$("#ca-viewsource a").length||0<$("#ca-watch a").length||0<$("#ca-unwatch a").length)&&(e=$("<div />").attr("id","button_article").addClass("wiki-header-button wiki-header-button-article").prependTo("#firstHeading"),$("<div />").appendTo(e),e.on("click",function(){wikiShowMenu("article","button_article")}),e.on("mousedown",function(){$(this).addClass("wiki-header-button-down")}))}function wikiSetupCollapsed(){var e,i,n,t=$("#References");0!=(t=0==t.length?$("#Citations"):t).length&&(t.addClass("wiki-heading-expandable"),e=getImageUrl("images/icon-chevron-down.png"),$("<span />").addClass("wiki-heading-chevron").css("background-image","url('"+e+"')").appendTo(t),t.on("click",function(){wikiToggleRefs()}),i=t.offset().top,n=null,$(".references").each(function(e){var t=$(this).offset().top;if(i<t)return n=$(this),!1}),null!=n&&n.addClass("wiki-refs-wrap").hide(),$(".reference").on("click",function(){wikiToggleRefs()}))}function wikiToggleRefs(){$(".wiki-heading-expandable").first().toggleClass("wiki-heading-expanded"),$(".wiki-refs-wrap").first().toggle()}function wikiSetupImages(){var e=getImageUrl("images/icon-menu2.png"),t=getImageUrl("images/logo-text.png"),i=getImageUrl("images/icon-search-50pc.png"),n=getImageUrl("images/icon-bookmark.png"),s=getImageUrl("images/icon-history2.png"),a=getImageUrl("images/icon-font2.png"),o=getImageUrl("images/icon-lang4.png"),r=getImageUrl("images/icon-user.png"),l=getImageUrl("images/arrow-up.png"),d=getImageUrl("images/icon-dots.png"),c=getImageUrl("images/icon-cross.png");$(".wiki-logo-text").attr("src",t),$("#wiki_search_icon").css("background-image","url('"+i+"')"),$("#wiki_search_delete").css("background-image","url('"+c+"')"),$("#button_menu div").css("background-image","url('"+e+"')"),$("#button_bookmark div").css("background-image","url('"+n+"')"),$("#button_history div").css("background-image","url('"+s+"')"),$("#button_settings div").css("background-image","url('"+a+"')"),$("#button_lang div").css("background-image","url('"+o+"')"),$("#button_user div").css("background-image","url('"+r+"')"),$(".top-button-wrap").css("background-image","url('"+l+"')"),$("#button_article div").css("background-image","url('"+d+"')")}function wikiSetupEvents(){$(window).on("scroll",function(){180<$(this).scrollTop()?$("#top_button").css("-webkit-animation","top-button-in 0.3s ease-out 0s 1 normal forwards"):$("#top_button").css("-webkit-animation","top-button-out 0.2s ease-in-out 0s 1 normal forwards"),65<$(this).scrollTop()?$("#wiki_contents").addClass("wiki-contents-scrolled"):$("#wiki_contents").removeClass("wiki-contents-scrolled"),"article"!=menuName&&0!=wiki.settings.fixed_header||wikiHideMenu(!1)}),$(document).on("mouseup",function(e){$(".wiki-header-button").removeClass("wiki-header-button-down"),1==menuOpen&&(0<$(e.target).closest(".menu-inner").length||0<$(e.target).closest(".wiki-search").length||(clearTimeout(hideMenuTimer),hideMenuTimer=setTimeout(function(){wikiHideMenu()},20)))}),$(document).keydown(function(e){if(1!=e.metaKey&&($(e.target).is("input[type='text']:focus"),!e.repeat))return 191!=e.which||$("#wiki_search").is(":focus")?void 0:($("#wiki_search").focus().select(),e.preventDefault(),!1)})}function wikiDrawHeader(){var e=$("<div />").addClass("wiki-header").attr("id","wiki_header").prependTo("body"),t=$("<div />").addClass("wiki-header-inner").appendTo(e);updateSettingHeader();var i=$("<div />").attr("id","button_menu").addClass("wiki-header-button wiki-header-button-menu").appendTo(e);i.on("click",function(){toggleContents()});var n="/wiki/Main_Page",s=$(".mw-wiki-logo").first();0<s.length&&(n=s.attr("href"));var a=$("<a />").attr("href",n).addClass("wiki-logo").appendTo(e),o=($("<img />").addClass("wiki-logo-text").attr("src","logo-text.png").appendTo(a),$("<div />").attr("id","wiki_search_wrap").addClass("wiki-search-wrap").html("&nbsp;").appendTo(t));$("<div />").attr("id","wiki_search_icon").addClass("wiki-search-icon").appendTo(o);$("<div />").attr("id","wiki_search_delete").addClass("wiki-search-delete").appendTo(o).on("click",function(){searchQuery="",$("#wiki_search").val("").focus(),$(this).hide()});s=$("<input />").attr("id","wiki_search").addClass("wiki-search").appendTo(o);s.attr("autocomplete","off").attr("spellcheck","false").attr("autocapitalize","off").attr("autocorrect","off");n=$("#searchInput").attr("placeholder");null!=n&&0!=n.length||(n="Search Wikipedia"),s.attr("placeholder",n);a=$("<div />").addClass("wiki-header-buttons").appendTo(e),t=$("<div />").attr("id","button_lang").addClass("wiki-header-button wiki-header-button-lang"),o=$("<div />").attr("id","button_bookmark").addClass("wiki-header-button wiki-header-button-bookmark"),s=$("<div />").attr("id","button_history").addClass("wiki-header-button wiki-header-button-history"),n=$("<div />").attr("id","button_settings").addClass("wiki-header-button wiki-header-button-settings"),e=$("<div />").attr("id","button_user").addClass("wiki-header-button wiki-header-button-user");s.appendTo(a),(0<$("#p-lang .interlanguage-link-target").length||0<$(".interlanguage-link").length)&&(t.appendTo(a),$("#p-lang-btn").hide()),n.appendTo(a),e.appendTo(a),$("<div />").appendTo(i),$("<div />").appendTo(t),$("<div />").appendTo(o),$("<div />").appendTo(s),$("<div />").appendTo(n),$("<div />").appendTo(e),o.on("click",function(e){wikiShowMenu("bookmark","button_bookmark"),e.preventDefault()}),s.on("click",function(e){loadHistoryMenu(),e.preventDefault()}),t.on("click",function(e){wikiShowMenu("lang","button_lang"),e.preventDefault()}),n.on("click",function(e){wikiShowMenu("settings","button_settings"),e.preventDefault()}),e.on("click",function(e){wikiShowMenu("user","button_user"),e.preventDefault()}),$(".wiki-header-button").on("mousedown",function(){$(this).addClass("wiki-header-button-down")})}function wikiDrawTopButton(){var e=$("<div />").attr("id","top_button").addClass("top-button").appendTo("body");$("<div />").addClass("top-button-wrap").appendTo(e).on("click",function(){wikiScrollToTopClick()})}chrome.runtime.onMessage.addListener(function(e,t,i){e.action});var searchTimer,searchQuery="",searchResults=[],searchCounter=0,searchLimit=50,searchResultSelected=null;function wikiSetupSearch(){var e=$("#wiki_search");e.on("keyup",function(e){0==$(this).val().length?$("#wiki_search_delete").hide():$("#wiki_search_delete").show(),1!=e.metaKey&&40!=e.which&&38!=e.which&&37!=e.which&&39!=e.which&&13!=e.which&&(191==e.which&&0==$(this).val().length||loadSearchResults())}),e.on("focus",function(){$.trim($("#wiki_search").val());1==menuOpen&&"search"!=menuName&&wikiHideMenu(),showSearchResults()}),e.on("blur",function(){hideSearchResults(),0==searchQuery.length&&($(this).val(""),$("#wiki_search_delete").hide())}),e.keydown(function(e){if(1!=e.metaKey&&!e.repeat)return 40==e.which?((null==searchResultSelected||++searchResultSelected>=searchResults.length)&&(searchResultSelected=0),updateResultSelection(),e.preventDefault(),!1):38==e.which?((null==searchResultSelected||--searchResultSelected<0)&&(searchResultSelected=searchResults.length-1),updateResultSelection(),e.preventDefault(),!1):13==e.which?(openSelectedResult(),e.preventDefault(),!1):void(27==e.which&&$(this).blur())})}function loadSearchResults(){0!=(searchQuery=(searchQuery=$.trim($("#wiki_search").val())).replace(/[\(\)]/g,"")).length?(clearTimeout(searchTimer),searchTimer=setTimeout(function(){doLoadSearchResults()},150)):hideSearchResults()}function doLoadSearchResults(){searchResultSelected=null;var t=++searchCounter,e=wikiGetLanguage();$.ajax({url:"https://"+e+".wikipedia.org/w/api.php",type:"GET",data:{action:"query",format:"json",generator:"prefixsearch",prop:"pageprops|pageimages|description",ppprop:"displaytitle",piprop:"thumbnail",pithumbsize:160,pilimit:searchLimit,gpssearch:searchQuery,gpsnamespace:0,gpslimit:searchLimit},timeout:15e3,dataType:"json",success:function(e){t==searchCounter&&void 0!==e.query&&void 0!==e.query.pages&&processSearchResults(e.query.pages)}})}function processSearchResults(t){searchResults=[],$.each(t,function(e){searchResults.push(t[e])}),searchResults.sort(function(e,t){return e.index-t.index}),$("#menu_inner").scrollTop(0),showSearchResults()}function showSearchResults(){var e=$.trim($("#wiki_search").val());if(0!=e.length||0!=wiki.mostread.articles.length){1==menuOpen&&"search"!=menuName&&wikiHideMenu(),0==menuOpen&&wikiShowMenu("search","wiki_search");var t=$("#menu_inner").html(""),i=!1;if(0==e.length&&0<wiki.mostread.articles.length){i=!0,searchResults=[];for(var n=0;n<wiki.mostread.articles.length;n++){var s=wiki.mostread.articles[n];searchResults.push({title:s.title,thumbnail:{source:s.thumb},description:s.description,url:s.url})}var a=$("<div />").addClass("menu-heading").text("Trending").appendTo(t),o="/wiki/Special:Random",r="Random",e=$("#n-randompage a");0<e.length&&(o=e.first().attr("href"),r=e.first().text()),(e=$("<a />").addClass("menu-random-link").attr("href",o).text(r).appendTo(a)).on("click",function(){wikiHideMenu()}),t.addClass("menu-inner-no-max"),t=$("<div />").attr("id","menu_list_wrap").addClass("menu-list-wrap").appendTo(t)}else t.removeClass("menu-inner-no-max");for(n=0;n<searchResults.length;n++){var l=$("<a />").addClass("wiki-results-row").attr("id","result_row_"+n).appendTo(t);l.attr("href",getResultUrl(n)),1==i&&(l.addClass("wiki-results-row-mostread"),$("<div />").addClass("wiki-results-number").text(n+1).appendTo(l));var d="";void 0!==searchResults[n].thumbnail&&0<searchResults[n].thumbnail.source.length&&(d=searchResults[n].thumbnail.source);var c=$("<div />").addClass("wiki-results-img").appendTo(l),u=$("<div />").appendTo(c);0==d.length&&(d=getImageUrl("images/icon-w.png"),c.addClass("wiki-results-img-placeholder"),1==i&&c.hide()),u.css("background-image","url('"+d+"')");u=searchResults[n].title,d=new RegExp(searchQuery,"i");u=u.replace(d,function(e){return"<b>"+e+"</b>"});u=$("<div />").addClass("wiki-results-title").html(u).appendTo(l),$("<div />").addClass("wiki-results-desc").text(searchResults[n].description).appendTo(l)}}}function hideSearchResults(){searchResultSelected=null,searchCounter++,wikiHideMenu()}function updateResultSelection(){var e,t;null!=searchResultSelected&&($("#wiki_search").val($("<div>"+searchResults[searchResultSelected].title+"</div>").text()),e=$("#menu_inner"),0<$("#menu_list_wrap",e).length&&(e=$("#menu_list_wrap")),t=$("#result_row_"+searchResultSelected),$(".wiki-results-row-selected").removeClass("wiki-results-row-selected"),t.addClass("wiki-results-row-selected"),t=e.scrollTop()+t.position().top-e.height()/2+t.height()/2-4,e.scrollTop(t))}function openSelectedResult(){var e=getResultUrl(searchResultSelected);null!=e&&(location.href=e),wikiHideMenu(),$("#wiki_search").blur()}function getResultUrl(e){var t=wikiGetLanguage();return null==e?"https://"+t+".wikipedia.org/w/index.php?search="+encodeURIComponent($("#wiki_search").val())+"&title=Special%3ASearch&go=Go&ns0=1":void 0!==searchResults[e].url?searchResults[e].url:"https://"+t+".wikipedia.org/wiki/"+encodeURIComponent(searchResults[e].title.replace(/ /g,"_"))}var menuOpen=!1,menuName="",hideMenuTimer=null;function wikiShowMenu(e,t){if(1==menuOpen){if(menuName==e)return void wikiHideMenu();wikiHideMenu()}"search"!=(menuName=e)&&$("#"+t).addClass("wiki-header-button-active"),clearTimeout(hideMenuTimer),$("#menu").remove();var i=$("<div />").addClass("menu menu-right").attr("id","menu").appendTo("body"),e=$("<div />").attr("id","menu_inner").addClass("menu-inner").appendTo(i),t=$("#"+t).offset();"settings"==menuName?(e.addClass("wiki-menu-settings"),drawSettingsMenu(e)):"history"==menuName?drawHistoryMenu():"bookmark"==menuName?$("<div />").addClass("wiki-menu-bookmark").text("Saved").appendTo(e):"search"==menuName?i.removeClass("menu-right"):"lang"==menuName?drawLanguageMenu(e):"user"==menuName?drawUserMenu(e):"article"==menuName&&drawArticleMenu(e),$("a",e).on("click",function(){wikiHideMenu()});e=t.left-i.width()+41,t=t.top+29-$(window).scrollTop();"search"==menuName&&(e-=20,t+=0),i.css("left",e+"px").css("top",t+"px").css("right","auto"),i.css("animation","menu-show-anim2 0.15s ease 0s 1 normal forwards"),menuOpen=!0}function wikiHideMenu(e){e=void 0===e||e;$(".wiki-header-button-active").removeClass("wiki-header-button-active"),0!=menuOpen&&(1==e?$("#menu").css("animation","menu-hide-anim2 0.25s ease 0s 1 normal forwards"):$("#menu").css("animation","menu-hide-anim2 0.01s ease 0s 1 normal forwards"),menuOpen=!1)}var sliderBgColor="rgba(var(--theme-colors),0.8)",currentTab="style",currentSwitch="article";function drawSettingsMenu(e){var t=$("<div />").addClass("settings-menu-wrap").attr("id","settings_menu_wrap").appendTo(e),i=$("<div />").addClass("menu-tabs").appendTo(t),n=$("<div />").text("Theme").attr("id","menu_tab_style").addClass("menu-tab").appendTo(i),e=$("<div />").text("Settings").attr("id","menu_tab_settings").addClass("menu-tab").appendTo(i);("style"==currentTab?n:e).addClass("menu-tab-selected"),$("div",i).off("click").on("click",function(){var e=$(this).attr("id").split("_")[2];currentTab=e,$(".menu-tab-selected").removeClass("menu-tab-selected"),$("#menu_tab_"+currentTab).addClass("menu-tab-selected"),("style"==currentTab?drawTabStyle:drawTabSettings)()}),$("<div />").attr("id","menu_tab_content").appendTo(t),("style"==currentTab?drawTabStyle:drawTabSettings)()}function drawTabStyle(){var e=$("#menu_tab_content").html("");1==wikiOnArticlePage()&&(i=$("<div />").addClass("settings-row settings-row-font settings-row-top").appendTo(e),n=$("<div />").addClass("settings-font-wrap").appendTo(i),s=$("<div />").addClass("settings-font-button settings-font-button-sans").appendTo(n),$("<div />").addClass("settings-font-button-title").text("Sans").appendTo(s),$("<div />").addClass("settings-font-button-preview").text("Aa").appendTo(s),a=$("<div />").addClass("settings-font-button settings-font-button-serif").appendTo(n),$("<div />").addClass("settings-font-button-title").text("Serif").appendTo(a),$("<div />").addClass("settings-font-button-preview").text("Aa").appendTo(a),s.on("click",function(){updateSettingFont("sans")}),a.on("click",function(){updateSettingFont("serif")}),"sans"==wiki.settings.font?s.addClass("settings-font-button-selected"):"serif"==wiki.settings.font&&a.addClass("settings-font-button-selected"));var t=$("<div />").addClass("settings-row settings-row-colors").appendTo(e);0==wikiOnArticlePage()&&t.addClass("settings-row-top");var i=$("<div />").addClass("settings-color settings-color-light").appendTo(t),n=$("<div />").addClass("settings-color settings-color-sepia").appendTo(t),s=$("<div />").addClass("settings-color settings-color-slate").appendTo(t),a=$("<div />").addClass("settings-color settings-color-dark").appendTo(t),t=$("<div />").addClass("settings-color settings-color-black").appendTo(t);"light"==wiki.settings.theme?i.addClass("settings-color-selected"):"sepia"==wiki.settings.theme?n.addClass("settings-color-selected"):"slate"==wiki.settings.theme?s.addClass("settings-color-selected"):"dark"==wiki.settings.theme?a.addClass("settings-color-selected"):"black"==wiki.settings.theme&&t.addClass("settings-color-selected"),i.on("click",function(){updateSettingTheme(wiki.settings.auto_theme_light="light")}),n.on("click",function(){updateSettingTheme(wiki.settings.auto_theme_light="sepia")}),s.on("click",function(){updateSettingTheme(wiki.settings.auto_theme_dark="slate")}),a.on("click",function(){updateSettingTheme(wiki.settings.auto_theme_dark="dark")}),t.on("click",function(){updateSettingTheme(wiki.settings.auto_theme_dark="black")}),1==wikiOnArticlePage()&&(s=$("<div />").addClass("menu-switcher-wrap").attr("id","menu_switcher").appendTo(e),a=$("<div />").addClass("menu-switcher").appendTo(s),t=$("<div />").text("Contents").attr("id","menu_switcher_contents").appendTo(a),s=$("<div />").text("Article").attr("id","menu_switcher_article").appendTo(a),("article"==currentSwitch?s:t).addClass("menu-switcher-selected"),$("div",a).off("click").on("click",function(){var e=$(this).attr("id").split("_")[2];currentSwitch=e,$(".menu-switcher-selected").removeClass("menu-switcher-selected"),$("#menu_switcher_"+currentSwitch).addClass("menu-switcher-selected"),drawStyleSliders()}),$("<div />").addClass("menu-sliders-wrap").attr("id","menu_sliders_wrap").appendTo(e),drawStyleSliders())}function drawTabSettings(){var e=$("#menu_tab_content").html("");$("<div />").attr("id","menu_toggles_wrap").addClass("settings-toggles-wrap").appendTo(e);addSettingsToggle("auto_theme","Auto Dark Theme"),addSettingsToggle("fixed_header","Fixed Header"),addSettingsToggle("justify","Justify Text"),addSettingsToggle("links_new","Open Links In New Tab"),addSettingsToggle("hide_links","Hide Article Links"),addSettingsToggle("contents_bullets","Contents Bullet Points")}function addSettingsToggle(e,t,i){var i=void 0!==i&&i,n=$("#menu_toggles_wrap"),n=$("<div />").addClass("settings-row settings-row-toggle").data("name",e).appendTo(n);$("<div />").addClass("toggle").html("<span></span>").attr("id","toggle_"+e).appendTo(n);0==i&&n.addClass("settings-row-top"),updateToggleValue(e),$("<div />").addClass("settings-menu-label").text(t).appendTo(n),n.on("click",function(){var e=$(this).data("name");$(".toggle",this).toggleClass("toggle-selected"),"fixed_header"==e?(wiki.settings.fixed_header=!wiki.settings.fixed_header,updateSettingHeader()):"justify"==e?(wiki.settings.justify=!wiki.settings.justify,updateSettingJustify()):"links_new"==e?(wiki.settings.links_new=!wiki.settings.links_new,updateSettingLinksNew()):"hide_links"==e?(wiki.settings.hide_links=!wiki.settings.hide_links,updateSettingHideLinks()):"contents_bullets"==e?(wiki.settings.contents_bullets=!wiki.settings.contents_bullets,updateSettingContentsBullets()):"auto_theme"==e&&(wiki.settings.auto_theme=!wiki.settings.auto_theme),saveSettings()})}function updateToggleValue(e){var t=$("#toggle_"+e),i=!1;"fixed_header"==e?i=wiki.settings.fixed_header:"justify"==e?i=wiki.settings.justify:"links_new"==e?i=wiki.settings.links_new:"hide_links"==e?i=wiki.settings.hide_links:"contents_bullets"==e?i=wiki.settings.contents_bullets:"auto_theme"==e&&(i=wiki.settings.auto_theme),1==i?t.addClass("toggle-selected"):t.removeClass("toggle-selected")}function drawStyleSliders(){var e=wiki.settings.font_size,t=wiki.settings.line_height,i=wiki.settings.width;"contents"==currentSwitch&&(e=wiki.settings.contents_font_size,t=wiki.settings.contents_line_height,i=wiki.settings.contents_width);var n=$("#menu_sliders_wrap").html(""),s=$("<div />").addClass("settings-row settings-row-top").appendTo(n),a=$("<div />").addClass("settings-slider-wrap").appendTo(s),o=$("<div />").addClass("settings-slider-icon settings-slider-icon-left").appendTo(a),r=$("<div />").addClass("settings-slider-icon settings-slider-icon-right").appendTo(a);o.on("click",function(){var e=wiki.settings.font_size,t=(e="contents"==currentSwitch?wiki.settings.contents_font_size:e)-1;t<0&&(t=0);e=$("#font_size_slider").val(t);updateSettingFontSize(t),updateSliderTrackSize(e)}),r.on("click",function(){var e=wiki.settings.font_size,t=(e="contents"==currentSwitch?wiki.settings.contents_font_size:e)+1;10<t&&(t=10);e=$("#font_size_slider").val(t);updateSettingFontSize(t),updateSliderTrackSize(e)});s=getImageUrl("images/icon-font-up.png"),getImageUrl("images/icon-font-down.png");o.css("background-image","url('"+s+"')").addClass("settings-slider-icon-font-down"),r.css("background-image","url('"+s+"')");o=$("<input />").attr("id","font_size_slider").addClass("knob-slider").appendTo(a);o.attr({type:"range",min:0,max:10,step:1,value:e}),updateSliderStyle(o),updateSliderTrackSize(o),o.on("input change",function(e){updateSettingFontSize(parseInt($(this).val()))}),o.on("input",function(e){updateSliderTrackSize($(e.target))}),o.on("mouseup touchend",function(){$(this).blur()});r=$("<div />").addClass("settings-row settings-row-top").appendTo(n),s=$("<div />").addClass("settings-slider-wrap").appendTo(r),a=$("<div />").addClass("settings-slider-icon settings-slider-icon-left").appendTo(s),e=$("<div />").addClass("settings-slider-icon settings-slider-icon-right").appendTo(s);a.on("click",function(){var e=wiki.settings.line_height,t=(e="contents"==currentSwitch?wiki.settings.contents_line_height:e)-1;t<0&&(t=0);e=$("#line_height_slider").val(t);updateSettingLineHeight(t),updateSliderTrackSize(e)}),e.on("click",function(){var e=wiki.settings.line_height,t=(e="contents"==currentSwitch?wiki.settings.contents_line_height:e)+1;10<t&&(t=10);e=$("#line_height_slider").val(t);updateSettingLineHeight(t),updateSliderTrackSize(e)}),a.addClass("settings-slider-icon-line-height"),e.addClass("settings-slider-icon-line-height");o=getImageUrl("images/icon-line-height-up2.png"),r=getImageUrl("images/icon-line-height-down2.png");a.css("background-image","url('"+r+"')"),e.css("background-image","url('"+o+"')");e=$("<input />").attr("id","line_height_slider").addClass("knob-slider").appendTo(s);e.attr({type:"range",min:0,max:10,step:1,value:t}),updateSliderStyle(e),updateSliderTrackSize(e),e.on("input change",function(e){updateSettingLineHeight(parseInt($(this).val()))}),e.on("input",function(e){updateSliderTrackSize($(e.target))}),e.on("mouseup touchend",function(){$(this).blur()});o=$("<div />").addClass("settings-row settings-row-top").appendTo(n),s=$("<div />").addClass("settings-slider-wrap").appendTo(o),t=$("<div />").addClass("settings-slider-icon settings-slider-icon-left").appendTo(s),e=$("<div />").addClass("settings-slider-icon settings-slider-icon-right").appendTo(s);t.addClass("settings-slider-icon-width"),e.addClass("settings-slider-icon-width"),t.on("click",function(){var e=wiki.settings.width,t=(e="contents"==currentSwitch?wiki.settings.contents_width:e)-1;t<0&&(t=0);e=$("#width_slider").val(t);updateSettingWidth(t),updateSliderTrackSize(e)}),e.on("click",function(){var e=wiki.settings.width,t=(e="contents"==currentSwitch?wiki.settings.contents_width:e)+1;10<t&&(t=10);e=$("#width_slider").val(t);updateSettingWidth(t),updateSliderTrackSize(e)});n=getImageUrl("images/icon-width-up6.png"),o=getImageUrl("images/icon-width-down5.png");t.css("background-image","url('"+o+"')"),e.css("background-image","url('"+n+"')");s=$("<input />").attr("id","width_slider").addClass("knob-slider").appendTo(s);s.attr({type:"range",min:0,max:10,step:1,value:i}),updateSliderStyle(s),updateSliderTrackSize(s),s.on("input change",function(e){updateSettingWidth(parseInt($(this).val()))}),s.on("input",function(e){updateSliderTrackSize($(e.target))}),s.on("mouseup touchend",function(){$(this).blur()})}function drawUserMenu(e){if(e.addClass("menu-inner-rows"),0==wikiLoggedIn()){var t=$("#pt-createaccount a").first(),i=$("#pt-login a").first(),n=$("#pt-anontalk a").first(),s=$("#pt-anoncontribs a").first();0==t.length&&(t=$("#p-createaccount a").first()),0==i.length&&(i=$(".vector-menu-content-item-login").first()),0<t.length&&$("<a />").text(t.text()).attr("href",t.attr("href")).addClass("menu-row").appendTo(e),0<i.length&&$("<a />").text(i.text()).attr("href",i.attr("href")).addClass("menu-row").appendTo(e),$("<div />").addClass("menu-row-sep").appendTo(e),0<n.length&&$("<a />").text(n.text()).attr("href",n.attr("href")).addClass("menu-row").appendTo(e),0<s.length&&$("<a />").text(s.text()).attr("href",s.attr("href")).addClass("menu-row").appendTo(e)}else{var a=$("#pt-userpage a").first(),o=$("#pt-notifications-alert a").first(),r=$("#pt-notifications-notice a").first(),n=$("#pt-mytalk a").first(),l=$("#pt-sandbox a").first(),d=$("#pt-preferences a").first(),c=$("#pt-betafeatures a").first(),u=$("#pt-watchlist a").first(),s=$("#pt-mycontris a").first(),h=$("#pt-logout a").first();0<a.length&&$("<a />").text(a.text()).attr("href",a.attr("href")).addClass("menu-row menu-row-profile").appendTo(e),$("<div />").addClass("menu-row-sep").appendTo(e);var g=o.text(),t="",i=r.text(),a="",g=g.replace(/\([0-9]+\)/,""),i=i.replace(/\([0-9]+\)/,"");try{var w=parseInt($("#pt-notifications-alert a").data("counter-num"));0<w&&(g+=" <span class='menu-row-counter'>"+w+"</span>",t=" menu-row-with-counter")}catch(e){}try{var p=parseInt($("#pt-notifications-notice a").data("counter-num"));0<p&&(i+=" <span class='menu-row-counter'>"+p+"</span>",a=" menu-row-with-counter")}catch(e){}0<o.length&&$("<a />").html(g).attr("href",o.attr("href")).addClass("menu-row"+t).appendTo(e),0<r.length&&$("<a />").html(i).attr("href",r.attr("href")).addClass("menu-row"+a).appendTo(e),$("<div />").addClass("menu-row-sep").appendTo(e),0<n.length&&$("<a />").text(n.text()).attr("href",n.attr("href")).addClass("menu-row").appendTo(e),0<l.length&&$("<a />").text(l.text()).attr("href",l.attr("href")).addClass("menu-row").appendTo(e),0<d.length&&$("<a />").text(d.text()).attr("href",d.attr("href")).addClass("menu-row").appendTo(e),0<c.length&&$("<a />").text(c.text()).attr("href",c.attr("href")).addClass("menu-row").appendTo(e),0<u.length&&$("<a />").text(u.text()).attr("href",u.attr("href")).addClass("menu-row").appendTo(e),0<s.length&&$("<a />").text(s.text()).attr("href",s.attr("href")).addClass("menu-row").appendTo(e),$("<div />").addClass("menu-row-sep").appendTo(e),0<h.length&&$("<a />").text(h.text()).attr("href",h.attr("href")).addClass("menu-row").appendTo(e)}}function wikiGetLanguage(){var e="en";return e=-1!=window.location.href.indexOf(".wikipedia.org")?window.location.host.split(".")[0]:e}function wikiLoggedIn(){return 0==$("#pt-anontalk").length}function drawLanguageMenu(e){languageSelected=null,(e=$("#menu_inner")).addClass("menu-inner-languages").html("");var t=$("<div />").attr("id","menu_search_wrap").addClass("menu-search-wrap").html("&nbsp;").appendTo(e),i=$("<div />").attr("id","menu_search_icon").addClass("menu-search-icon").appendTo(t),n=$("<div />").attr("id","menu_search_delete").addClass("menu-search-delete").appendTo(t);n.on("click",function(){$("#wiki_languages_input").val("").focus(),$(this).hide(),drawLanguagesList()}),i.css("background-image","url('"+getImageUrl("images/icon-search-50pc.png")+"')"),n.css("background-image","url('"+getImageUrl("images/icon-cross.png")+"')");t=$("<input />").attr("id","wiki_languages_input").addClass("menu-search-input").attr("placeholder","Find language").appendTo(t);t.attr("autocomplete","off").attr("spellcheck","false").attr("autocapitalize","off").attr("autocorrect","off"),t.on("keyup",function(e){0==$(this).val().length?$("#menu_search_delete").hide():$("#menu_search_delete").show(),1!=e.metaKey&&40!=e.which&&38!=e.which&&37!=e.which&&39!=e.which&&13!=e.which&&drawLanguagesList()}),t.keydown(function(e){if(1!=e.metaKey&&!e.repeat)return 40==e.which?((null==languageSelected||++languageSelected>=wikiLanguages.length)&&(languageSelected=0),updateLanguageSelection(),e.preventDefault(),!1):38==e.which?((null==languageSelected||--languageSelected<0)&&(languageSelected=wikiLanguages.length-1),updateLanguageSelection(),e.preventDefault(),!1):13==e.which?(selectLanguage(),e.preventDefault(),!1):void(27==e.which&&(wikiHideMenu(),$(this).blur(),languageSelected=null))});$("<div />").attr("id","wiki_languages_wrap").addClass("menu-list-wrap menu-inner-rows menu-inner-rows-narrow").appendTo(e);drawLanguagesList(),setTimeout(function(){$("#wiki_languages_input").focus()},20)}var applySettingsTimer,wikiLanguagesFull=[],wikiLanguages=[],languageSelected=null;function drawLanguagesList(){0==wikiLanguagesFull.length&&($("#p-lang .interlanguage-link-target").each(function(e){var t="–";-1==$(this).attr("title").indexOf(t)&&(t="-"),-1==$(this).attr("title").indexOf(t)&&(t="—");t=$(this).attr("title").split(t),t=$.trim(t[t.length-1]);wikiLanguagesFull.push({name:$("span",this).text(),tagline:t,url:$(this).attr("href"),title:$(this).attr("title")})}),0==wikiLanguagesFull.length&&$(".interlanguage-link a").each(function(e){var t="–";-1==$(this).attr("title").indexOf(t)&&(t="-"),-1==$(this).attr("title").indexOf(t)&&(t="—");t=$(this).attr("title").split(t),t=$.trim(t[t.length-1]);wikiLanguagesFull.push({name:$(this).text(),tagline:t,url:$(this).attr("href"),title:$(this).attr("title")})}));var e=$("#wiki_languages_wrap").html(""),t=$("#wiki_languages_input").val().toLowerCase();wikiLanguages=[],languageSelected=null;for(var i=0;i<wikiLanguagesFull.length;i++)0<t.length&&-1==wikiLanguagesFull[i].name.toLowerCase().indexOf(t)&&-1==wikiLanguagesFull[i].tagline.toLowerCase().indexOf(t)||wikiLanguages.push(wikiLanguagesFull[i]);for(i=0;i<wikiLanguages.length;i++){var n=$("<a />").text(wikiLanguages[i].name).addClass("menu-row").appendTo(e);$("<div />").addClass("menu-row-tagline").text(wikiLanguages[i].tagline).appendTo(n),n.attr("id","language_row_"+i),n.attr("href",wikiLanguages[i].url).attr("title",wikiLanguages[i].title)}}function updateLanguageSelection(){var e,t;null!=languageSelected&&($("#wiki_languages_input").val(wikiLanguages[languageSelected].name),e=$("#wiki_languages_wrap"),t=$("#language_row_"+languageSelected),$(".wiki-results-row-selected").removeClass("wiki-results-row-selected"),t.addClass("wiki-results-row-selected"),t=e.scrollTop()+t.position().top-e.height()/2+t.height()/2-4,e.scrollTop(t))}function selectLanguage(){location.href=wikiLanguages[languageSelected].url,wikiHideMenu(),$("#wiki_languages_input").blur()}function wikiAddToHistory(){if(0!=wikiOnArticlePage()){var e=$("script[type='application/ld+json']");if(0!=e.length){var t=JSON.parse(e.last().text()),i=t.name,n="",s=t.url,a="",e=$(".shortdescription");if(0==(n=0<e.length?e.first().text():n).length&&void 0!==t.headline&&(n=t.headline),void 0!==t.image){e=(a=t.image).split("/");if(0==e.length)return;t=e[e.length-1],e=wikiGetLanguage();".png"!=(a=(a=a.replace("commons/","commons/thumb/").replace("wikipedia/"+e+"/","wikipedia/"+e+"/thumb/"))+"/160px-"+t).slice(-4)&&(a+=".png")}wiki.history=wiki.history.slice(-100);for(var o=null,r=wiki.history.length-1;0<=r;r--)if(wiki.history[r].url==s){o=r;break}null!=o?wiki.history[o].timestamp=Math.floor(Date.now()/1e3):wiki.history.push({title:i,description:n,url:s,thumb:a,scroll:$(document).scrollTop(),timestamp:Math.floor(Date.now()/1e3)}),saveHistory()}}}function saveHistory(){chrome.storage.local.set({history:JSON.stringify(wiki.history)})}function clearHistory(){1==confirm("Your history will be cleared. Are you sure?")&&(chrome.storage.local.remove("history"),wikiHideMenu(!(wiki.history=[])),wikiShowMenu("history","button_history"))}function loadHistory(){chrome.storage.local.get(["history"],function(e){void 0!==e.history&&(wiki.history=JSON.parse(e.history)),wikiAddToHistory()})}function loadHistoryMenu(){chrome.storage.local.get(["history"],function(e){void 0!==e.history&&(wiki.history=JSON.parse(e.history)),wikiShowMenu("history","button_history")})}function drawHistoryMenu(){var e=$("#menu_inner");if(e.addClass("menu-inner-history").html(""),0==wiki.history.length)$("<div />").addClass("menu-placeholder").appendTo(e).text("Your history will appear here.");else{var t=$("<div />").addClass("menu-heading").text("History").appendTo(e);$("<div />").addClass("menu-clear-link").text("Clear").appendTo(t).on("click",function(){clearHistory()});var i=$("<div />").addClass("menu-list-wrap").appendTo(e),n=new Date,s=new Date;s.setDate(s.getDate()-1);var a=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r="";wiki.history.sort(function(e,t){return e.timestamp-t.timestamp});for(var l=wiki.history.length-1;0<=l;l--){var d=new Date(1e3*wiki.history[l].timestamp),c=o[d.getDay()]+" "+d.getDate()+" "+a[d.getMonth()];c!=r&&(h=c,n.getDate()==d.getDate()&&n.getMonth()==d.getMonth()&&n.getFullYear()==d.getFullYear()?h="Today":s.getDate()==d.getDate()&&s.getMonth()==d.getMonth()&&s.getFullYear()==d.getFullYear()&&(h="Yesterday"),$("<div />").addClass("menu-day-heading").text(h).appendTo(i),r=c,$(".wiki-results-row",i).last().addClass("wiki-results-row-last"));var u=$("<a />").addClass("wiki-results-row").attr("id","history_row_"+l).appendTo(i);u.attr("href",wiki.history[l].url);d="";0<wiki.history[l].thumb.length&&(d=wiki.history[l].thumb);var h=$("<div />").addClass("wiki-results-img").appendTo(u),c=$("<div />").appendTo(h);0==d.length&&(d=getImageUrl("images/icon-w.png"),h.addClass("wiki-results-img-placeholder")),c.css("background-image","url('"+d+"')"),$("<div />").addClass("wiki-results-title").html(wiki.history[l].title).appendTo(u);$("<div />").addClass("wiki-results-desc").text(wiki.history[l].description).appendTo(u);u=$("<div />").data("history_index",l).addClass("wiki-results-delete").appendTo(u);u.css("background-image","url('"+getImageUrl("images/icon-cross.png")+"')"),u.on("click",function(e){var t=parseInt($(this).data("history_index"));return wiki.history.splice(t,1),$("#history_row_"+t).remove(),saveHistory(),0==wiki.history.length&&(wikiHideMenu(!1),wikiShowMenu("history","button_history")),e.preventDefault(),!1})}}}function drawArticleMenu(e){e.addClass("menu-inner-rows");var t=$('a[rel="discussion"]').first(),i=$("#ca-history a").first(),n=$("#ca-edit a").first(),s=$("#ca-watch a").first(),a=$("#t-info a").first(),o=$("#t-permalink a").first(),r=$("#t-whatlinkshere a").first(),l=$("#t-wikibase a").first(),d=$("#t-cite a").first(),c=$("#coll-download-as-rl a").first();0==n.length&&(n=$("#ca-viewsource a").first()),0==s.length&&(s=$("#ca-unwatch a").first()),0<t.length&&$("<a />").text(t.text()).attr("href",t.attr("href")).addClass("menu-row").appendTo(e),0<i.length&&$("<a />").text(i.text()).attr("href",i.attr("href")).addClass("menu-row").appendTo(e),0<n.length&&$("<a />").text(n.text()).attr("href",n.attr("href")).addClass("menu-row").appendTo(e),1==wikiLoggedIn()&&0<s.length&&(s=$("<a />").text(s.text()).attr("href",s.attr("href")).addClass("menu-row").appendTo(e),0<$("#ca-watch").length?s.on("click",function(e){return document.getElementById("ca-watch").children[0].click(),wikiHideMenu(),e.preventDefault(),!1}):s.on("click",function(e){return document.getElementById("ca-unwatch").children[0].click(),wikiHideMenu(),e.preventDefault(),!1})),(0<a.length||0<o.length||0<r.length||0<l.length||0<d.length||0<c.length)&&$("<div />").addClass("menu-row-sep").appendTo(e),0<a.length&&$("<a />").text(a.text()).attr("href",a.attr("href")).addClass("menu-row").appendTo(e),0<o.length&&$("<a />").text(o.text()).attr("href",o.attr("href")).addClass("menu-row").appendTo(e),0<r.length&&$("<a />").text(r.text()).attr("href",r.attr("href")).addClass("menu-row").appendTo(e),0<l.length&&$("<a />").text(l.text()).attr("href",l.attr("href")).addClass("menu-row").appendTo(e),0<d.length&&$("<a />").text(d.text()).attr("href",d.attr("href")).addClass("menu-row").appendTo(e),0<c.length&&$("<a />").text(c.text()).attr("href",c.attr("href")).addClass("menu-row").appendTo(e)}function updateSettingFontSize(e){"article"==currentSwitch?wiki.settings.font_size=e:wiki.settings.contents_font_size=e,saveSettings(),clearTimeout(applySettingsTimer),applySettingsTimer=setTimeout(function(){1==wikiOnArticlePage()&&("article"==currentSwitch?($("body").removeClass("theme-font-size-0 theme-font-size-1 theme-font-size-2 theme-font-size-3 theme-font-size-4 theme-font-size-5 theme-font-size-6 theme-font-size-7 theme-font-size-8 theme-font-size-9 theme-font-size-10"),$("body").addClass("theme-font-size-"+wiki.settings.font_size)):($("body").removeClass("theme-contents-font-size-0 theme-contents-font-size-1 theme-contents-font-size-2 theme-contents-font-size-3 theme-contents-font-size-4 theme-contents-font-size-5 theme-contents-font-size-6 theme-contents-font-size-7 theme-contents-font-size-8 theme-contents-font-size-9 theme-contents-font-size-10"),$("body").addClass("theme-contents-font-size-"+wiki.settings.contents_font_size)))},applySettingsTimeout)}function updateSettingLineHeight(e){"article"==currentSwitch?wiki.settings.line_height=e:wiki.settings.contents_line_height=e,saveSettings(),clearTimeout(applySettingsTimer),applySettingsTimer=setTimeout(function(){1==wikiOnArticlePage()&&("article"==currentSwitch?($("body").removeClass("theme-line-height-0 theme-line-height-1 theme-line-height-2 theme-line-height-3 theme-line-height-4 theme-line-height-5 theme-line-height-6 theme-line-height-7 theme-line-height-8 theme-line-height-9 theme-line-height-10"),$("body").addClass("theme-line-height-"+wiki.settings.line_height)):($("body").removeClass("theme-contents-line-height-0 theme-contents-line-height-1 theme-contents-line-height-2 theme-contents-line-height-3 theme-contents-line-height-4 theme-contents-line-height-5 theme-contents-line-height-6 theme-contents-line-height-7 theme-contents-line-height-8 theme-contents-line-height-9 theme-contents-line-height-10"),$("body").addClass("theme-contents-line-height-"+wiki.settings.contents_line_height)))},applySettingsTimeout)}function updateSettingWidth(e){"article"==currentSwitch?wiki.settings.width=e:wiki.settings.contents_width=e,saveSettings(),clearTimeout(applySettingsTimer),applySettingsTimer=setTimeout(function(){1==wikiOnArticlePage()&&("article"==currentSwitch?($("body").removeClass("theme-width-0 theme-width-1 theme-width-2 theme-width-3 theme-width-4 theme-width-5 theme-width-6 theme-width-7 theme-width-8 theme-width-9 theme-width-10"),$("body").addClass("theme-width-"+wiki.settings.width)):($("body").removeClass("theme-contents-width-0 theme-contents-width-1 theme-contents-width-2 theme-contents-width-3 theme-contents-width-4 theme-contents-width-5 theme-contents-width-6 theme-contents-width-7 theme-contents-width-8 theme-contents-width-9 theme-contents-width-10"),$("body").addClass("theme-contents-width-"+wiki.settings.contents_width)))},applySettingsTimeout)}function updateSettingFont(e){wiki.settings.font=e,saveSettings(),clearTimeout(applySettingsTimer),applySettingsTimer=setTimeout(function(){1==wikiOnArticlePage()&&($("body").removeClass("theme-font-sans theme-font-serif"),$("body").addClass("theme-font-"+wiki.settings.font))},applySettingsTimeout),$(".settings-font-button-selected").removeClass("settings-font-button-selected"),("sans"==e?$(".settings-font-button-sans"):$(".settings-font-button-serif")).addClass("settings-font-button-selected")}function updateSettingTheme(e){wiki.settings.theme=e,saveSettings(),clearTimeout(applySettingsTimer),applySettingsTimer=setTimeout(function(){$("body").removeClass("theme-light theme-sepia theme-slate theme-dark theme-black"),$("body").addClass("theme-"+wiki.settings.theme),updateSettingThemeStyle()},applySettingsTimeout),$(".settings-color").removeClass("settings-color-selected"),$(".settings-color-"+e).addClass("settings-color-selected")}function updateSettingThemeStyle(){"light"==wiki.settings.theme||"sepia"==wiki.settings.theme?document.documentElement.style.setProperty("color-scheme","light"):document.documentElement.style.setProperty("color-scheme","dark")}function saveSettings(){chrome.storage.local.set({settings:wiki.settings}),storeBgColor()}function loadSettings(){chrome.storage.local.get(["settings"],function(e){void 0!==e.settings&&(wiki.settings=e.settings),void 0===wiki.settings.links_new&&(wiki.settings.links_new=!1),void 0===wiki.settings.hide_links&&(wiki.settings.hide_links=!1),void 0===wiki.settings.contents_bullets&&(wiki.settings.contents_bullets=!1),void 0===wiki.settings.contents_font_size&&(wiki.settings.contents_font_size=3),void 0===wiki.settings.contents_line_height&&(wiki.settings.contents_line_height=5),void 0===wiki.settings.contents_width&&(wiki.settings.contents_width=4),void 0===wiki.settings.auto_theme&&(wiki.settings.auto_theme=!1),void 0===wiki.settings.auto_theme_light&&(wiki.settings.auto_theme_light="light"),void 0===wiki.settings.auto_theme_dark&&(wiki.settings.auto_theme_dark="black"),void 0===wiki.settings.version&&(wiki.settings.version="1.21"),"1.21"==wiki.settings.version&&(5==wiki.settings.width&&(wiki.settings.width=9),6==wiki.settings.width&&(wiki.settings.width=10)),wiki.settings.version=wiki.version,saveSettings(),applySettings(),hideLoadingOverlay()})}function clearSettings(){chrome.storage.local.remove("settings")}function storeBgColor(){var e="#fff",t=!1;"sepia"==wiki.settings.theme?e="rgb(250,240,228)":"slate"==wiki.settings.theme?(e="rgb(39,40,45)",t=!0):"dark"==wiki.settings.theme?(e="rgb(17,18,22)",t=!0):"black"==wiki.settings.theme&&(e="rgb(0,0,0)",t=!0),localStorage.setItem("bg_color",e),localStorage.setItem("bg_dark",t)}var menuItems,scrollItems,scrollIntoViewTimer,applySettingsTimeout=0;function wikiOnArticlePage(){var e=window.location.href;if(0==$("script[type='application/ld+json']").length)return!1;var t=$(".mw-wiki-logo").first();return!(0<t.length&&-1!=e.indexOf(t.attr("href")))}function applySettings(){$("body").addClass("theme-"+wiki.settings.theme),updateSettingThemeStyle(),1==wikiOnArticlePage()?($("body").addClass("theme-article"),$("body").addClass("theme-font-"+wiki.settings.font),$("body").addClass("theme-font-size-"+wiki.settings.font_size),$("body").addClass("theme-line-height-"+wiki.settings.line_height),$("body").addClass("theme-width-"+wiki.settings.width)):($("body").addClass("theme-non-article"),$("body").addClass("theme-width-5")),$("body").addClass("theme-contents-font-size-"+wiki.settings.contents_font_size),$("body").addClass("theme-contents-line-height-"+wiki.settings.contents_line_height),$("body").addClass("theme-contents-width-"+wiki.settings.contents_width),updateSettingHeader(),updateSettingContents(),updateSettingJustify(),updateSettingLinksNew(),updateSettingHideLinks(),updateSettingContentsBullets()}function updateSettingContents(e){e=void 0!==e&&e;1==wiki.settings.contents?(1==e?$("#wiki_contents").css("transition","all 0.27s ease-out"):$("#wiki_contents").css("transition",""),$("#wiki_contents").removeClass("wiki-contents-hide"),$("body").removeClass("theme-contents-hidden"),$("body").addClass("theme-contents-visible")):(1==e?$("#wiki_contents").css("transition","all 0.27s ease-in"):$("#wiki_contents").css("transition",""),$("#wiki_contents").addClass("wiki-contents-hide"),1==e?setTimeout(function(){$("body").removeClass("theme-contents-visible"),$("body").addClass("theme-contents-hidden")},250):($("body").removeClass("theme-contents-visible"),$("body").addClass("theme-contents-hidden")))}function updateSettingHeader(){1==wiki.settings.fixed_header?($("html").removeClass("theme-header-not-fixed"),$("html").addClass("theme-header-fixed")):($("html").addClass("theme-header-not-fixed"),$("html").removeClass("theme-header-fixed"))}function updateSettingJustify(){1==wiki.settings.justify?$("#mw-content-text").addClass("theme-justify"):$("#mw-content-text").removeClass("theme-justify")}function updateSettingLinksNew(){1==wiki.settings.links_new?$("#mw-content-text a").each(function(){return null==$(this).attr("href")||void(0!=$(this).attr("href").indexOf("#")&&$(this).attr("target","_blank"))}):$("#mw-content-text a").removeAttr("target")}function updateSettingHideLinks(){1==wiki.settings.hide_links?$("#mw-content-text").addClass("theme-hide-links"):$("#mw-content-text").removeClass("theme-hide-links")}function updateSettingContentsBullets(){1==wiki.settings.contents_bullets?$("#wiki_contents").addClass("theme-contents-bullets"):$("#wiki_contents").removeClass("theme-contents-bullets")}function updateSliderStyle(e){var t=e[0].min;e.css("background-image","-webkit-gradient(linear, 50% 0%, 50% 100%, color-stop("+(t<0?"50%":"0%")+", "+sliderBgColor+"), color-stop(100%, "+sliderBgColor+"))")}function updateSliderTrackSize(e){var t,i,n,s,a,o,r;0!=e.length&&(t=e[0].min,i=e[0].max,n=e[0].value,s=Math.floor(e.width()),a=Math.floor(e.width()/2),o=100*(n-t)/(i-t)+"% 100%",r="0px 0px",t<0&&0<i?(-.5==t&&.5==i&&(n*=2),r=0<=n?(o=a*n+"px 100%",a+"px 0px"):(o=Math.floor(a*Math.abs(n))+"px 100%",Math.floor(a-Math.floor(a*Math.abs(n)))+"px 0px")):t<0&&0==i&&(r=s-Math.floor(s*(Math.abs(n)/Math.abs(t)))+"px 0px",o="100% 100%"),e.css({backgroundSize:o}).css("background-position",r))}var scrollMenuItemIntoViewTimer,scrollIntoView=!0,contentsMouseOver=!1;function wikiDrawContents(){var e,t,i,n;0!=$("#toc ul").length&&((n=$("<div />").attr("id","wiki_contents").addClass("wiki-contents").appendTo("body")).on("scroll",function(){clearTimeout(scrollMenuItemIntoViewTimer)}),n.on("mouseenter",function(){contentsMouseOver=!0}),n.on("mouseleave",function(){contentsMouseOver=!1}),$("<div />").addClass("wiki-contents-heading").text("Contents").appendTo(n),e=$("#firstHeading").text(),t=$("<ul />").html($("#toc ul").html()).attr("id","wiki_contents_wrap").addClass("wiki-contents-wrap").appendTo(n),$("#toc").remove(),i=$("<li />").addClass("toclevel-1 tocsection-1 wiki-contents-title").prependTo(t),n=$("<a />").attr("href","#firstHeading").appendTo(i),$("<span />").addClass("toctext").text(e).appendTo(n),n.on("click",function(){return setTimeout(function(){$("html, body").scrollTop(0)},10),window.location.replace("#"),history.replaceState({},"",window.location.href.slice(0,-1)),!1}),i.addClass("wiki-contents-selected"),$("a",t).on("click",function(){wikiDisableScrollIntoView(),$(".wiki-contents-selected").removeClass("wiki-contents-selected"),$(this).parent().addClass("wiki-contents-selected"),$(".wiki-contents-child-selected").removeClass("wiki-contents-child-selected"),$(this).parent().parent().parent(".toclevel-1").addClass("wiki-contents-selected wiki-contents-child-selected"),wikiScrollMenuItemIntoView()}),menuItems=t.find('a[href^="#"]'),scrollItems=menuItems.map(function(){var e=$(this).attr("href");if("#"!=e){e=e.replace(/^#/,""),e=$("#"+$.escapeSelector(e));if(e.length)return e}}),$(window).scroll(function(){updateContentsSelection()}))}function updateContentsSelection(){var e,t;0!=scrollIntoView&&(t=88,0==wiki.settings.fixed_header&&(t=23),e=$(window).scrollTop()+t,(t=(t=(t=scrollItems.map(function(){return $(this).offset().top<e?this:null}))[t.length-1])&&t.length?t[0].id:"")&&(menuItems.parent().removeClass("wiki-contents-selected"),$(".wiki-contents-child-selected").removeClass("wiki-contents-child-selected"),(t=menuItems.parent().end().filter('[href^="#'+$.escapeSelector(t)+'"]').parent()).addClass("wiki-contents-selected"),t.parent().parent(".toclevel-1").addClass("wiki-contents-selected wiki-contents-child-selected"),wikiScrollMenuItemIntoView()))}function toggleContents(){wiki.settings.contents=!wiki.settings.contents,updateSettingContents(!0),saveSettings()}function wikiScrollMenuItemIntoView(){var e,t,i;1==contentsMouseOver||0!=(e=0==(e=$(".wiki-contents-selected").not(".wiki-contents-child-selected").first()).length?$(".wiki-contents-child-selected"):e).length&&(t=$("#wiki_contents"),i=t.scrollTop()+e.position().top-t.height()/2+55,t.height(),clearTimeout(scrollMenuItemIntoViewTimer),scrollMenuItemIntoViewTimer=setTimeout(function(){t.scrollTop(i)},0))}function wikiDisableScrollIntoView(){scrollIntoView=!1,clearTimeout(scrollIntoViewTimer),scrollIntoViewTimer=setTimeout(function(){scrollIntoView=!0,$("#wiki_search").is(":focus")},1100)}function wikiScrollToTopClick(){return wikiDisableScrollIntoView(),$(".wiki-contents-selected").removeClass("wiki-contents-selected"),$(".wiki-contents-child-selected").removeClass("wiki-contents-child-selected"),$("#wiki_contents .toclevel-1").first().addClass("wiki-contents-selected"),$("#wiki_contents").scrollTop(0),$("html, body").scrollTop(0),!1}function getImageUrl(e){if(0==wiki.test)try{e=chrome.runtime.getURL(e)}catch(e){}return e}function isMac(){return 0<=navigator.platform.toUpperCase().indexOf("MAC")}"undefined"==typeof testMode&&wikiStartup();