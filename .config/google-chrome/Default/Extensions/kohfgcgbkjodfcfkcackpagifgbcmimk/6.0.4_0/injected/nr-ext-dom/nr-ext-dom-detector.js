function NRDomDetector(){let e=this;e.frame=null,e.iconDocument=null,e.hasIcon=!1,e.selectedText="",e.switchIcon=c,e.setLimit=a,e.LimitedReadSelectionOn=!0,e.LimitedReadSelectionCharAmount=20,e.iconState=!0,e.offset={start:-1,end:-1},e.isInjectingSD=!1,e.mousePos={x:0,y:0},e.isAsyncFunction=function(t){return!!e.asyncFunctions.includes(t)},e.asyncFunctions=["getHasIcon"],e.getHasIcon=function(t,n,o){o(e.hasIcon)},e.hasSelectionOnPage=r,e.hideReadIcon=function(){e.frame.style.display="none"},e.removeSelection=function(){window.getSelection().removeAllRanges()},e.curOnHoverEle=null;let t={readIcon:{}};function n(n){if(!e.isInjectingSD&&!e.hasIcon){e.isInjectingSD=!0,e.iconState=n.iconState,e.LimitedReadSelectionOn=n.LimitedReadSelectionOn,e.LimitedReadSelectionCharAmount=n.LimitedReadSelectionCharAmount;let o=document.createElement("iframe");e.frame=o,e.frame.id="nr-ext-rsicon",e.frame.style.position="absolute",e.frame.style.display="none",e.frame.style.width="50px",e.frame.style.height="50px",e.frame.style.zIndex="9000000000000000000",e.frame.style.borderStyle="none",e.frame.style.background="transparent",document.body.appendChild(o),e.frame.onload=()=>{!async function(){await(n=null,o=chrome.runtime.getURL("injected/nr-ext-dom/nr-ext-select-icon/nr-ext-select-icon.css"),new Promise(((t,i)=>{let r;if(!n){let e=o.match(/\.([^.]+)$/);e&&(n=e[1])}n||(n="js"),"css"===n?(r=document.createElement("link"),r.type="text/css",r.rel="stylesheet",r.href=o,e.iconDocument.head.appendChild(r)):"js"===n&&(r=document.createElement("script"),r.type="text/javascript",r.src=o,e.iconDocument.body.appendChild(r)),r&&(r.onload=()=>{t(o)},r.onerror=()=>{i(o)})})).catch((e=>{}))),await async function(){try{await new Promise((n=>{for(let n in t)t[n]=e.iconDocument.getElementById(n);n()})),await new Promise((n=>{null!=t&&(t.readIcon.onclick=()=>{e.frame.style.display="none",chrome.runtime.sendMessage({fn:"readSelection"},(()=>{chrome.runtime.lastError}))}),n()})),await(window.addEventListener("mouseup",(t=>{setTimeout((()=>{var n,o;e.iconState&&(r()?(n=t.pageX,o=t.pageY,e.frame.style.top=o+5+"px",e.frame.style.left=n+5+"px",e.frame.style.display="block",clearTimeout(e.floatBarTimeout),e.floatBarTimeout=setTimeout((function(){e.frame.style.display="none",e.selectedText=""}),3e3)):e.frame.style.display="none")}),0)})),void document.addEventListener("mousedown",(e=>{if("undefined"!=typeof doc&&"googleDoc"===doc.type&&"nr-sentence"===e.target.tagName.toLowerCase())try{e.target.click()}catch(e){}})))}catch(e){}}(),e.isInjectingSD=!1,e.hasIcon=!0;var n,o}()},fetch(chrome.runtime.getURL("injected/nr-ext-dom/nr-ext-select-icon/nr-ext-select-icon.html")).then((e=>e.text())).then((t=>{try{e.frame.contentDocument.write(t),e.iconDocument=e.frame.contentDocument,e.frame.contentDocument.close()}catch(t){e.frame.contentDocument.close()}}))}}function o(e=!0){if(Array.from($("div.kix-canvas-tile-selection")).length<=0){!function(){var e=$(".kix-selection-overlay").get(),t=$(window).height(),n=function(e,t){var n=0,o=e.length-1;for(;n<=o;){var i=o+n>>1,r=t(e[i]);if(r>0)n=i+1;else{if(!(r<0))return i;o=i-1}}return-1}(e,(function(e){var n=e.getBoundingClientRect();return n.top<120?1:n.top>=t?-1:0}));if(-1!=n){for(var o=[e[n]],i=e[n].parentNode;(i=l(i))&&$(i).hasClass("kix-lineview")&&$(i.firstElementChild).hasClass("kix-selection-overlay");)o.push(i.firstElementChild);for(i=e[n].parentNode;(i=s(i))&&$(i).hasClass("kix-lineview")&&$(i.firstElementChild).hasClass("kix-selection-overlay");)o.push(i.firstElementChild);e.length!=o.length&&$(e).not(o).remove()}else $(e).remove()}();var t=googleDocsUtil.getGoogleDocument();let o=(n=t.selectedText)&&n.replace(/\u200c/g,"");return""!==o&&(!e||i(o))}{const e=googleDocsUtil.getSelectedRects("all");let t="";for(let n=0;n<e.length;n++)t+=" "+e[n].getAttribute("aria-label");return t=t.trim(),i(t)}var n}function i(t){return!(e.LimitedReadSelectionOn&&t.length<=e.LimitedReadSelectionCharAmount)}function r(t=!0){let n=!1;return"html"===window.docType||"outlookMail"==window.docType||"gmail"==window.docType?function(t=!0){e.offset={start:-1,end:-1};let n=window.getSelection();if(e.offset={start:n.anchorOffset,end:n.focusOffset},n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset)return""!==n.toString().trim()&&(!t||i(n.toString().trim()));{let o=getSelectedNodes();return o.textNodes.length>0?n.anchorOffset!=e.offset.start||n.focusOffset!=e.offset.end||""!==n.toString().trim()?!t||i(n.toString().trim()):(e.offset={start:-1,end:-1},!1):0===o.allNodes.length&&""!==n.toString().trim()&&(!t||i(n.toString().trim()))}}(t)&&(n=!0):"googleDoc"===window.docType&&o(t)&&(n=!0),n}function c(t){e.iconState=t}function a(t){e.LimitedReadSelectionCharAmount=t}function l(e){return e.previousElementSibling||e.parentNode.previousElementSibling&&e.parentNode.previousElementSibling.lastElementChild||$(e).closest(".kix-page").prev().find(".kix-page-content-wrapper .kix-lineview").get(-1)}function s(e){return e.nextElementSibling||e.parentNode.nextElementSibling&&e.parentNode.nextElementSibling.firstElementChild||$(e).closest(".kix-page").next().find(".kix-page-content-wrapper .kix-lineview").get(0)}chrome.runtime.onMessage.addListener((function(t,o,i){if(e[t.fn]){if(e[t.fn](t,o,i),e.isAsyncFunction(t.fn))return!0}else"toggleShowReadIcon"===t.message&&c(t.value);if("injectSD"===t.message&&n(t.value),"setLimit"===t.message&&a(t.value),"hasSelectionOnPage"===t.message)return i(r()),!0}))}function debounce(e,t=500,n=!0){var o;return function(){var i=this,r=arguments,c=function(){o=null,n||e.apply(i,r)},a=n&&!o;clearTimeout(o),o=setTimeout(c,t),a&&e.apply(i,r)}}var nrDomDetector=nrDomDetector||new NRDomDetector;