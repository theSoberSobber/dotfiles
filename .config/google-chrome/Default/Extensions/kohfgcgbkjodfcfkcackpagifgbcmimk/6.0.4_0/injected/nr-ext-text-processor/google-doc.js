var doc=doc&&"googleDoc"===doc.type?doc:new function(){this.type="googleDoc";let e=this,t=[],n=$(".kix-appview-editor").get(0);const o=$(".kix-rotatingtilemanager-content").get(0);let r=[],a=0,l=0,i=0,s=0,c={},g=0,u=!1;function p(e=null){return new Promise((t=>{if(e){n.scrollTop=$(e).position().top;const o=Array.from($("div.kix-canvas-tile-content svg g",e));w(o);const r=[];let a=0;for(let e=0;e<o.length;e++){const t=document.createElement("DIV"),n=o[e].getElementsByTagName("rect");let l="";for(let e=0;e<n.length;e++)l+=n[e].getAttribute("aria-label")+" ";let i=processSentencesByLength(getNlpSentences(l.trim()));for(let e=0;e<i.length;e++){const n=document.createElement("nr-sentence");n.innerText=i[e],n.classList.add("nr-s"+a),n.id="nr-s"+a,a++,t.appendChild(n)}r.push(t)}t(r)}})).catch((e=>{}))}function h(){let e=0;r=$(".kix-page-paginated");const t=n.scrollTop+$(n).height()/2;for(let n=0;n<r.length;n++){const o=r.eq(n).position().top;if(t<=o+r.eq(n).height()&&t>o){e=parseInt(r[n].style.zIndex);break}}return e}function f(){return Promise.resolve().then((()=>{t=[]})).catch((e=>{}))}async function d(t,o){try{let r=await m(t);if(e.docInnerText===r&&"convert"!==o)return Promise.reject("ERR_ALREADY_PARSED");"convert"!==o&&(e.docInnerText=r),"convert"!==o&&(await f(),await removeNRTags({toNormalize:!1})),await function(e=0,t="all",o=null){return new Promise((async r=>{let a=await k(e);a?(n.scrollTop=$(a).position().top,await async function(e,t="all",n=null){try{let o=$(e).find("div.kix-canvas-tile-content svg g").get();w(o);o[0].parentNode;"convert"!=t&&await S(g);for(let e=0;e<o.length;e++)try{n?o[e].contains(n)&&(await T(o[e],n),n=null):await I(o[e],t)}catch(e){}}catch(e){}}(a,t,o),r()):r()})).catch((e=>{}))}(t,o)}catch(e){}}async function m(e){const t=await k(e),n=Array.from($(t).find("div.kix-canvas-tile-content svg g"));w(n);let o=[];for(let e=0;e<n.length;e++)o=o.concat(Array.from(n[e].querySelectorAll("rect")));let r="";for(let e=0;e<o.length;e++)r+=o[e].getAttribute("aria-label");return e+r}function v(e){const t=Array.from($(e).find("rect"));let n="";for(let e=0;e<t.length;e++)n+=" "+t[e].getAttribute("aria-label");return n}async function y(e,t,o){u=!1;const r=await k(e);if(await S(e),o){const o=t[0];await function(e,t=null){return new Promise((async o=>{let r=await k(e);if(r){n.scrollTop=$(r).position().top;const e=$(r).find("div.kix-canvas-tile-content svg g").get();w(e);for(let n=0;n<e.length&&(!t||e[n].contains(t)||t.compareDocumentPosition(e[n])==Node.DOCUMENT_POSITION_PRECEDING);n++)if(e[n].contains(t)){const a=document.createElement("g"),l=Array.from($(e[n]).find("rect")),i=[];for(let e=0;e<l.length;e++)if(t.compareDocumentPosition(l[e])===Node.DOCUMENT_POSITION_PRECEDING){const t=l[e].cloneNode();a.appendChild(t),i.push(l[e])}const s=processHtmlText(v(a)).trim();let c=processSentencesByLength(getNlpSentences(s)),g=createDeepCopy(c),u=0;for(let e=0;e<i.length;e++)u=await E(r,i[e],g,c,u);o()}else await I(e[n]);o()}else o()})).catch((e=>{}))}(e,o)}const a=[[]];let l=null;for(let e=0;e<t.length;e++)null==l||t[e].parentNode==l?a[a.length-1].push(t[e]):a.push([t[e]]),l=t[e].parentNode;u=!0;for(let e=0;e<a.length;e++){let t="";const n=a[e];for(let e=0;e<n.length;e++)t+=" "+n[e].getAttribute("aria-label");const o=processSentencesByLength(getNlpSentences(t));let l=createDeepCopy(o),i=0;for(let e=0;e<n.length;e++)i=await E(r,n[e],l,o,i)}if(u=!1,o){const o=t[t.length-1];await function(e,t=null){return new Promise((async o=>{let r=await k(e);if(r){n.scrollTop=$(r).position().top;const e=$(r).find("div.kix-canvas-tile-content svg g").get();w(e);for(let n=0;n<e.length;n++)if(!t||e[n].contains(t)||t.compareDocumentPosition(e[n])==Node.DOCUMENT_POSITION_FOLLOWING)if(e[n].contains(t)){const a=document.createElement("g"),l=Array.from($(e[n]).find("rect")),i=[];for(let e=0;e<l.length;e++)if(t.compareDocumentPosition(l[e])===Node.DOCUMENT_POSITION_FOLLOWING){const t=l[e].cloneNode();a.appendChild(t),i.push(l[e])}const s=processHtmlText(v(a)).trim();let c=processSentencesByLength(getNlpSentences(s)),g=createDeepCopy(c),u=0;for(let e=0;e<i.length;e++)u=await E(r,i[e],g,c,u);o()}else await I(e[n]);o()}else o()})).catch((e=>{}))}(e,o)}o=!1}function w(e){e.sort((function(e,t){const n=e.getBoundingClientRect().top,o=t.getBoundingClientRect().top;return n<o?-1:n>o?1:0}))}function x(e){return e.previousElementSibling||e.parentNode.previousElementSibling&&e.parentNode.previousElementSibling.lastElementChild||$(e).closest(".kix-page-paginated").prev().find(".kix-page-paginated-content-wrapper .kix-lineview").get(-1)}function P(e){return e.nextElementSibling||e.parentNode.nextElementSibling&&e.parentNode.nextElementSibling.firstElementChild||$(e).closest(".kix-page-paginated").next().find(".kix-page-paginated-content-wrapper .kix-lineview").get(0)}function T(e,t,n){return new Promise((async o=>{let r=googleDocsUtil.getTextNodesWithoutEmptyNodes(e),a=[];for(let e=0;e<r.length;e++)t.compareDocumentPosition(r[e])==Node.DOCUMENT_POSITION_FOLLOWING&&a.push(r[e]);n&&(await f(),await removeNRTags({toNormalize:!1})),await N(a),o()})).catch((e=>{}))}function I(e,n="all"){return new Promise((async o=>{const r=processHtmlText(v(e)).trim();if("convert"!==n){let t=processSentencesByLength(getNlpSentences(r));await async function(e,t){try{e.normalize();let n=createDeepCopy(t);const o=Array.from($(e).find("rect"));let r=0;for(let e=0;e<o.length;e++){let a=await k(g);r=await E(a,o[e],n,t,r)}}catch(e){}}(e,t),o()}else r&&t.push(r),o()})).catch((e=>{}))}async function N(e,n){let o="";for(let t=0;t<e.length;t++)o+=processHtmlText($(e[t]).text());if(o=o.trim(),"convert"===n&&o)return void t.push(o);let r=processSentencesByLength(getNlpSentences(o)),a=createDeepCopy(r),l=0;for(;e.length>0;){let t=e.shift(),n=await C(t,a,r,l),o=n.nextIndex,i=n.remainder;i&&e.unshift(i),l!=o&&(l=o)}}function E(e,n,o,r,a){return new Promise((l=>{e||l();let i=n.getAttribute("aria-label");i&&""!==processHtmlText(i.trim())||l(a);const s=document.createElement("nr-sentence");s.id="nr-s"+t.length;let p=o[a],h=a;n.setAttribute("page",b()),u&&$(s).addClass("nr-selected");let f=0;for(;f<i.length;){for(;p&&" "==p[0];)p=p.substring(1);processHtmlText(i[f])===p[0]&&(p=p.substring(1),0===p.trim().length?(h++,$(s).addClass("nr-s"+t.length),o[a]=p,t.push(r[a]),a++,p=o[a]):f+1>=i.length&&$(s).addClass("nr-s"+t.length)),f++}o[a]=p;const d=$(n).offset(),m=$(e).offset();s.style.position="absolute",s.style.width=$(n).width()+"px",s.style.height=$(n).height()+"px",s.style.display="block",s.style.left=d.left-m.left+"px",s.style.top=d.top-m.top+"px",s.style.zIndex="300",s.style.opacity="0.5";c[g].appendChild(s),l(h)})).catch((e=>{}))}async function C(e,n,o,r){try{if(!$(e).text()||""===processHtmlText($(e).text()).trim())return{nextIndex:r,remainder:null};let a=0,l=$(e).text(),i=l.length,s=n[r],c=r;for(;a<l.length;){if(processHtmlText(l[a])===s[0]&&(s=s.substring(1),0===s.length)){a++,c++;break}a++}i=a,n[r]=s;let g=document.createElement("nr-sentence");g.id="nr-s"+t.length,$(g).addClass("nr-s"+t.length),g.setAttribute("page",b()),u&&$(g).addClass("nr-selected"),0===n[r].length&&t.push(o[r]);let p=e.splitText(i);return""===$(p).text().trim()&&(p=null),$(e).wrap(g),{nextIndex:c,remainder:p}}catch(e){}}function k(t,n=!0){return new Promise((o=>{null!=e.pageGotten&&parseInt($(e.pageGotten).css("z-index"))==t?o(e.pageGotten):(e.getPageInterval=setInterval((async function(){r=$(".kix-page-paginated");for(let n=0;n<r.length;n++){const a=parseInt($(r[n]).css("z-index"));if(t==a)return e.getPageTimeout&&(clearTimeout(e.getPageTimeout),e.getPageTimeout=null),clearInterval(e.getPageInterval),e.getPageInterval=null,e.pageGotten=r[n],o(r[n])}if(!n)return e.getPageTimeout&&(clearTimeout(e.getPageTimeout),e.getPageTimeout=null),clearInterval(e.getPageInterval),e.getPageInterval=null,e.pageGotten=null,o(null)}),500),e.getPageTimeout=setTimeout((()=>(clearInterval(e.getPageInterval),e.pageGotten=null,o(null))),3e4))})).catch((t=>(e.pageGotten=null,e.getPageInterval&&(clearInterval(e.getPageInterval),e.getPageInterval=null),e.getPageTimeout&&(clearTimeout(e.getPageTimeout),e.getPageTimeout=null),Promise.resolve(null))))}function b(){return g}async function S(e){const t=await k(e),n=$(t).position(),r=document.createElement("nr-overlay");r.id="nr-page-overlay-"+e,r.style.zIndex=200,r.style.position="absolute",r.style.left=n.left+"px",r.style.top=n.top+"px",r.style.width=$(t).width()+"px",r.style.height=$(t).height()+"px",r.style.background="transparent",o.prepend(r),c[e]=r}e.isRendering=!0,e.docInnerText="",this.getPageIndex=b,e.getCurrentIndex=h,e.parsePageForImmersiveReader=async function(){return p(await k(h())).then((e=>e)).catch((e=>{}))},e.isSameText=function(){return m(g).then((t=>t===e.docInnerText)).catch((e=>!1))},this.getPages=function(){return r=$(".kix-page-paginated"),r},this.getNumPages=function(){return s},this.isPageInView=function(e=null){e=g,r=$(".kix-page-paginated");for(let t=0;t<r.length;t++){const n=parseInt($(r[t]).css("z-index"));if(e==n)return!0}return!1},this.changeDisplayPageOverlays=function(e){const t=Object.values(c);for(let n=0;n<t.length;n++)e?$(t[n]).show():$(t[n]).hide()},this.op="all",e.pageGotten=null,e.getPageInterval=null,e.getPageTimeout=null,e.hasAnnotated=!1,this.scrollToAdjacentPage=function(e){return new Promise((async t=>{try{"next"===e?(await this.scrollToPage(g+1),t()):(await this.scrollToPage(g-1),t())}catch(e){return t("ERR")}})).catch((e=>Promise.resolve("ERR")))},this.parseForConvertToPdf=function(){return new Promise((async e=>{let t=[];n.scrollTop=0;let o=n.scrollTop,r=0,a=await k(r);for(;a;){const e=await p(a);t=t.concat(e),r++,a=await k(r,!1)}n.scrollTop=o,e(t)})).then((e=>e)).catch((e=>{}))},this.scrollToPage=function(t){return new Promise((t=>{let n=null;const o=setInterval((function(){e.isRendering||(clearInterval(o),n&&clearTimeout(n),t())}),100);n=setTimeout((()=>{clearInterval(o),t()}),6e4)})).then((()=>new Promise(((e,o)=>{const r=Math.round(i*t);if(r>=l||r<0||t>=s)return o();n.scrollTop=r;let a=null,c=setInterval((async function(){try{h()===t&&(a&&clearTimeout(a),clearInterval(c),e())}catch(t){clearInterval(c),e()}}),200);a=setTimeout((()=>{clearInterval(c),e()}),6e4)})))).catch((e=>Promise.reject(new Error("ERR_SCROLL_PAGE"))))},this.scrollToSentence=async function(e){let t=-await function(e){return new Promise((t=>{let n=$(e).offset().top,o=0;for(e=$(e);e.offsetParent()&&"relative"===e.offsetParent().css("position")&&!e.offsetParent().hasClass("kix-page-paginated");)o+=e.offsetParent().offset().top,e=e.offsetParent();t(n-o)})).catch((e=>{}))}(e);const o=await k(g);n.scrollTop=t+o.position().top},this.getTexts=function(e="all"){return g=h(),this.op=e,new Promise((async(o,r)=>{try{await function(e,o="all"){if("all"===o)return u=!1,d(e,o);if("selection"===o)return function(e){return new Promise((async t=>{await f(),"convert"!==e&&await removeNRTags({toNormalize:!1}),t()})).then((async()=>{const e=googleDocsUtil.getSelectedRects();let t=!0;for(g in e)await y(g,e[g],t),t=!1;return Promise.resolve()})).then((()=>{const e=Array.from(document.querySelectorAll(".nr-selected")),t=parseInt(e[0].id.split("nr-s")[1]),o=parseInt(e[e.length-1].id.split("nr-s")[1]);return reader.setReadIndex(t),reader.setLastReadIndex(o),function(){n.blur(),$(".kix-appview-editor").each((()=>{$(this).blur()})),$("div.kix-canvas-tile-selection svg").each((function(){$(this).empty()}))}()})).catch((e=>{}))}();if("convert"===o){u=!1;try{return nrDomDetector.hasSelectionOnPage()?function(e){let n={};return new Promise((async t=>{await f(),"convert"!==e&&await removeNRTags({toNormalize:!1}),t()})).then((()=>new Promise((e=>{!function(){var e=$(".kix-selection-overlay").get(),t=$(window).height(),n=function(e,t){var n=0,o=e.length-1;for(;n<=o;){var r=o+n>>1,a=t(e[r]);if(a>0)n=r+1;else{if(!(a<0))return r;o=r-1}}return-1}(e,(function(e){var n=e.getBoundingClientRect();return n.top<120?1:n.top>=t?-1:0}));if(-1!=n){for(var o=[e[n]],r=e[n].parentNode;(r=x(r))&&$(r).hasClass("kix-lineview")&&$(r.firstElementChild).hasClass("kix-selection-overlay");)o.push(r.firstElementChild);for(r=e[n].parentNode;(r=P(r))&&$(r).hasClass("kix-lineview")&&$(r.firstElementChild).hasClass("kix-selection-overlay");)o.push(r.firstElementChild);e.length!=o.length&&$(e).not(o).remove()}else $(e).remove()}();let t=googleDocsUtil.getGoogleDocument(!0,!0,!1);n=t.selectedNodes,googleDocsUtil.removeSelectionOverlay(),e()})))).then((()=>new Promise((e=>{let t=[],o=[],r=n.textNodes,a=n.pNodes.shift();for(let e=0;e<r.length;e++)a&&a.contains(r[e])?(o.push(r[e]),e===r.length-1&&l()):(o.length>0&&l(),a=n.pNodes.shift(),a&&a.contains(r[e])?(o.push(r[e]),e===r.length-1&&l()):t.push(r[e]));function l(){let e=[];for(let t=0;t<o.length;t++)e.push(o[t]);o=[],t.push(e)}e(t)})))).then((async n=>{for(let t=0;t<n.length;t++){let o=n[t];Array.isArray(o)||(o=[n[t]]),await N(o,e)}return Promise.resolve(t)})).catch((e=>{}))}(o):function(e){return new Promise((async t=>{let o=n.scrollTop;n.scrollTop=0,await f(),"convert"!==e&&await removeNRTags({toNormalize:!1});let r=0,a=await k(r);for(;a;)await d(r,e),r++,a=await k(r,!1);n.scrollTop=o,t()})).catch((e=>{}))}(o)}catch(e){}}}(g,e),o(t)}catch(e){r(e)}}))},function(){!function(){const e=document.getElementById("nr-docs-annotated");return!!e&&(e.remove(),!0)}()?(e.isRendering=!1,e.hasAnnotated=!1):e.hasAnnotated=!0;let t=null;r=$(".kix-page-paginated");const o=setInterval((()=>{try{const c=l;if(l=$($(".kix-rotatingtilemanager").get(0)).height(),l===c)if(r=$(".kix-page-paginated"),a=$(r[0]).height(),i=a,r.length>1){const c=n.scrollTop;n.scrollTop=a,r=$(".kix-page-paginated");let g=r.eq(0).position().top,u=r.eq(1).position().top,p=parseInt(r.eq(0).css("z-index"));for(let e=0;e<r.length;e++){const t=parseInt(r.eq(e).css("z-index"));t<p&&(p=t,g=r.eq(e).position().top)}for(let e=0;e<r.length;e++){parseInt(r.eq(e).css("z-index"))==p+1&&(u=r.eq(e).position().top)}const h=Math.abs(u-(a+g));i=a+h,s=Math.abs(Math.round((l+h)/i)),n.scrollTop=c,t&&clearTimeout(t),"undefined"!=typeof readingBar&&readingBar.updateNumPages(),e.isRendering=!1,clearInterval(o)}else clearInterval(o),t&&clearTimeout(t),"undefined"!=typeof readingBar&&readingBar.updateNumPages(),e.isRendering=!1,s=1}catch(e){clearInterval(o)}}),1e3);t=setTimeout((()=>{clearInterval(o)}),6e4)}()};