var doc=doc&&"outlookMail"===doc.type?doc:new function(){let e=this;this.type="outlookMail";let t=[],n=!1;function l(){return Promise.resolve().then((()=>{t=[]})).catch((e=>{}))}function r(){trimmedText="",currPageTextNodes=d();for(let e=0;e<currPageTextNodes.length;e++)trimmedText+=$(currPageTextNodes[e]).text();return trimmedText}function o(e){const t=[];if($(e).data("read-aloud-multi-block")){let n=$(e).children(":visible").get();for(let e=0;e<n.length;e++)t.push(n[e])}else $(e).find("p, ul, ol, li").length>0?($(e).data("read-aloud-multi-block",!0),o(e)):t.push(e);return t}function i(n="all"){let r=document.body.innerText.substring(0,1e3);return e.docInnerText===r?Promise.reject("ERR_ALREADY_PARSED"):(e.docInnerText=r,new Promise((async e=>{await l(),"convert"!==n&&await removeNRTags(),e()})).then((()=>c())).then((e=>new Promise((async l=>{if("all"===n)for(let t=0;t<e.length;t++){let l=$(e[t]).find(":visible").filter(p).hide();await u(e[t],n),l.show()}else{let n=w(e.map(y)).filter(isNotEmpty);for(let e=0;e<n.length;e++)n[e]&&t.push(n[e])}l(t)})))).catch((e=>{})))}async function s(e,t,n=null){try{if(n&&!e.contains(n)&&n.compareDocumentPosition(e)!=Node.DOCUMENT_POSITION_PRECEDING)return;if($(e).data("read-aloud-multi-block")){let l=$(e).children(":visible").get();l=l.filter((e=>e.contains(n)||n.compareDocumentPosition(e)==Node.DOCUMENT_POSITION_PRECEDING));for(let e=0;e<l.length;e++)$(l[e]).find("p, ul, ol, li").length>0?await s(l[e],t,n):await g(l[e],t,{position:"first",node:n})}else n&&(e.contains(n)||n.compareDocumentPosition(e)==Node.DOCUMENT_POSITION_PRECEDING)&&($(e).find("p, ul, ol, li").length>0?($(e).data("read-aloud-multi-block",!0),await s(e,t,n)):await g(e,t,{position:"first",node:n}))}catch(e){}}async function a(e,t,n=null){try{if(n&&!e.contains(n)&&n.compareDocumentPosition(e)!=Node.DOCUMENT_POSITION_FOLLOWING)return;if($(e).data("read-aloud-multi-block")){let l=$(e).children(":visible").get();n&&(l=l.filter((e=>e.contains(n)||n.compareDocumentPosition(e)==Node.DOCUMENT_POSITION_FOLLOWING)));for(let e=0;e<l.length;e++)$(l[e]).find("p, ul, ol, li").length>0?await a(l[e],t,n):await g(l[e],t,{position:"last",node:n})}else n&&(e.contains(n)||n.compareDocumentPosition(e)==Node.DOCUMENT_POSITION_FOLLOWING)&&($(e).find("p, ul, ol, li").length>0?($(e).data("read-aloud-multi-block",!0),await a(e,t,n)):await g(e,t,{position:"last",node:n}))}catch(e){}}function c(){return new Promise((t=>{let n=d();e.docText=r();let l=[];for(let e=0;e<n.length;e++)l.push.apply(l,x(n[e],n[e-1])),l.push(n[e]);e.toRead=Array.from(l),t(l)})).catch((e=>{}))}function d(){let e=$("[aria-label='Reading Pane']");if(e.length>0){let t=e[0];parsedTexts=[];for(let e=0;e<t.children.length;e++){let n=t.children[e];parsedTexts=parsedTexts.concat(h(n))}return parsedTexts}return[]}function h(e){let t,n=[];if(!function(e){if(e.className.toString().includes("ms-Button"))return!1;if($(e).is(":hidden"))return!1;return!0}(e))return[];try{if(t=$(e).clone().children().remove().end().text(),null!=t&&""!=t)return[e];if(function(e){return"Email message"==e.getAttribute("aria-label")}(e))return h(e.children[2]);for(var l=0;l<e.children.length;l++){let t=h(e.children[l]);n=n.concat(t)}return n}catch(e){}}async function u(e,t){if($(e).data("read-aloud-multi-block")){let n=$(e).children(":visible").get();for(let e=0;e<n.length;e++)$(n[e]).find("p, ul, ol, li").length>0?await u(n[e],t):await g(n[e],t)}else $(e).find("p, ul, ol, li").length>0?($(e).data("read-aloud-multi-block",!0),await u(e,t)):await g(e,t)}async function f(e,n){let l=function(e){let t="",n=[];for(let l=0;l<e.length;l++)e[l]&&$(e[l].parentNode).is(":visible")&&(t+=N(e[l]),n.push(e[l]));return{text:t,textNodes:n}}(e);e=l.textNodes;let r=processHtmlText(l.text).trim();if("convert"===n)return void t.push(r);let o=processSentencesByLength(getNlpSentences(r)),i=createDeepCopy(o),s=0;for(;e.length>0;){let t=e.shift(),n=await m(t,i,o,s),l=n.nextIndex,r=n.remainder;r&&e.unshift(r),s!=l&&(s=l)}}async function g(e,n,l=null){let r=function(e,t,n=null){let l="",r=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),i=null;for(;i=o.nextNode();)i&&((!n||("first"!==n.position||n.node.compareDocumentPosition(i)!=Node.DOCUMENT_POSITION_PRECEDING&&n.node.compareDocumentPosition(e)!=Node.DOCUMENT_POSITION_PRECEDING)&&("last"!==n.position||n.node.compareDocumentPosition(i)!=Node.DOCUMENT_POSITION_FOLLOWING&&n.node.compareDocumentPosition(e)!=Node.DOCUMENT_POSITION_FOLLOWING))&&n||$(i.parentNode).is(":visible")&&(l+=N(i),r.push(i)));return{text:l,textNodes:r}}(e,0,l),o=r.textNodes,i=processHtmlText(r.text).trim(),s=processSentencesByLength(getNlpSentences(i));if("convert"!==n)try{if(s.length>0){e.normalize();let t=createDeepCopy(s),n=0;for(;o.length>0;){let e=o.shift(),l=await m(e,t,s,n),r=l.nextIndex,i=l.remainder;i&&o.unshift(i),n!=r&&(n=r)}}}catch(e){}else t.push(...s)}async function m(e,l,r,o){try{if(!$(e).text()||""===processHtmlText($(e).text()).trim())return{nextIndex:o,remainder:null};let i=$(e).text(),s=processHtmlText(l[o]).trim(),a=o;if(processHtmlText(i).length<=s.length){s=s.substring(i.length),l[o]=s;let c=document.createElement("nr-sentence");return $(c).addClass("nr-s"+t.length),c.id="nr-s"+t.length,c.setAttribute("page",0),n&&$(c).addClass("nr-selected"),0===l[o].length&&(t.push(r[o]),a++),$(e).wrap(c),{nextIndex:a,remainder:null}}{let c=i.search(/\S|$/),d=i.length;for(;c<i.length;){for(;i[c]&&""===processHtmlText(i[c]).trim()&&(c++,i[c]););if(!i[c])break;for(;s[0]&&""===processHtmlText(s[0]).trim();)if(s=s.substring(1),0===s.length){a++;break}if(0===s.length)break;if(processHtmlText(i[c])===processHtmlText(s[0])&&(s=s.substring(1),0===s.length)){c++,a++;break}c++}d=c;let h=document.createElement("nr-sentence");$(h).addClass("nr-s"+t.length),h.id="nr-s"+t.length,h.setAttribute("page",0),n&&$(h).addClass("nr-selected"),l[o]=s,0===l[o].length&&t.push(r[o]);let u=e.splitText(d);return""===$(u).text().trim()&&(u=null),$(e).wrap(h),{nextIndex:a,remainder:u}}}catch(e){}}function p(){let e=$(this).css("float"),t=$(this).css("position");return $(this).is(ignoreTags)||$(this).is("sup")||"right"==e||"fixed"==t}function N(e){return e.innerText?e.innerText:$(e).text()}function x(e,t){let n=[],l=T($(e).find("h1, h2, h3, h4, h5, h6, p").filter(":visible").get(0)),r=P(e,!0);for(;r&&r!=t;){let e=$(r).is(ignoreTags);if(!e&&1==r.nodeType&&$(r).is(":visible")){let e=T(r);e<l&&(n.push(r),l=e)}r=P(r,e)}return n.reverse()}function T(e){let t=e&&/^H(\d)$/i.exec(e.tagName);return t?Number(t[1]):100}function P(e,t){return $(e).is("body")?null:1==e.nodeType&&!t&&e.lastChild?e.lastChild:e.previousSibling?e.previousSibling:P(e.parentNode,!0)}function w(e){return[].concat.apply([],e)}function y(e){var t=$(e).find(":visible").filter(p).hide(),n=$(e).data("read-aloud-multi-block")?$(e).children(":visible").get().map(N):N(e).split(paragraphSplitter);return t.show(),n}e.docInnerText="",e.isSameText=function(){try{let t=!0;if("emailThread"===this.op){let n=document.getElementById("nr-gmail-email");t=!(!n||n.innerText.trim()!=e.docInnerText)}else t=r()==e.docText;return t}catch(e){}},this.op="all",e.toRead=[],this.queryString="[aria-label = 'Reading Pane']",e.getCurrentIndex=function(){return 0},this.getTexts=function(r="all"){return this.op=r,new Promise((async(o,d)=>{try{await function(r="all"){if(e.toRead=[],"all"===r)return n=!1,i(r);if("selection"===r)return n=!0,function(r=!0,o=!0,i){let d={},h="";e.docInnerText="";const u=[];return new Promise(((e,t)=>{let n=window.getSelection(),l=n.getRangeAt(0);if(d=getSelectedNodes(),d.textNodes.length>0&&d.allNodes.length>0){if(r&&(d.textNodes[0].isSameNode(d.allNodes[0])||d.allNodes[0].contains(d.textNodes[0]))){let e=d.textNodes[0].splitText(l.startOffset);d.textNodes[0]=e,d.allNodes[0]=e}o&&(d.textNodes[d.textNodes.length-1].isSameNode(d.allNodes[d.allNodes.length-1])||d.allNodes[d.allNodes.length-1].contains(d.textNodes[d.textNodes.length-1]))&&d.textNodes[d.textNodes.length-1].splitText(l.endOffset)}else h=n.toString(),d=null;n.removeAllRanges(),e()})).then((()=>new Promise((async e=>{await l(),"convert"!==i&&await removeNRTags({toNormalize:!1}),e()})))).then((()=>new Promise((e=>{if(d){let n=[],l=[],r=d.textNodes,o=d.pNodes.shift();for(let i=0;i<r.length;i++)o&&o.contains(r[i])?(l.push(r[i]),i===r.length-1&&t()):(l.length>0&&t(),o=d.pNodes.shift(),o&&o.contains(r[i])?(l.push(r[i]),i===r.length-1&&t()):n.push(r[i]));function t(){let e=[];for(let t=0;t<l.length;t++)e.push(l[t]);l=[],n.push(e)}e(n)}else e([])})).then((async e=>{if(e.length>0){for(let t=0;t<e.length;t++)Array.isArray(e[t])?await f(e[t],i):await f([e[t]],i);return Promise.resolve()}return h.trim()&&(t=processSentencesByLength(getNlpSentences(h))),Promise.resolve()})))).then((()=>{for(let e=0;e<t.length;e++)u.push(t[e]);return t=[],n=!1,Promise.resolve()})).then((()=>c())).then((async e=>{const n=Array.from(document.querySelectorAll(".nr-selected")),l=n[0],r=n[n.length-1];for(let t=0;t<e.length;t++)await s(e[t],i,l);for(let e=0;e<u.length;e++){const n=Array.from(document.querySelectorAll("nr-sentence.nr-selected.nr-s"+e));for(let e=0;e<n.length;e++)n[e].className="",n[e].classList.add("nr-selected-post"),n[e].classList.add("nr-s"+t.length),n[e].id="nr-s"+t.length;t.push(u[e])}for(let t=0;t<e.length;t++)await a(e[t],i,r);return Promise.resolve()})).then((()=>{const e=Array.from(document.querySelectorAll("nr-sentence.nr-selected-post")),n=parseInt(e[0].id.split("nr-s")[1]),l=parseInt(e[e.length-1].id.split("nr-s")[1]);return reader.setReadIndex(n),reader.setLastReadIndex(l),Promise.resolve(t)})).catch((e=>{}))}();if("convert"===r)return n=!1,nrDomDetector.hasSelectionOnPage()?function(n=!0,r=!0,o){let i={},s="";return e.docInnerText="",new Promise(((e,t)=>{let l=window.getSelection(),o=l.getRangeAt(0);if(i=getSelectedNodes(),i.textNodes.length>0&&i.allNodes.length>0){if(n&&(i.textNodes[0].isSameNode(i.allNodes[0])||i.allNodes[0].contains(i.textNodes[0]))){let e=i.textNodes[0].splitText(o.startOffset);i.textNodes[0]=e,i.allNodes[0]=e}r&&(i.textNodes[i.textNodes.length-1].isSameNode(i.allNodes[i.allNodes.length-1])||i.allNodes[i.allNodes.length-1].contains(i.textNodes[i.textNodes.length-1]))&&i.textNodes[i.textNodes.length-1].splitText(o.endOffset)}else s=l.toString(),i=null;l.removeAllRanges(),e()})).then((()=>new Promise((async e=>{await l(),"convert"!==o&&await removeNRTags({toNormalize:!1}),e()})))).then((()=>new Promise((e=>{if(i){let n=[],l=[],r=i.textNodes,o=i.pNodes.shift();for(let s=0;s<r.length;s++)o&&o.contains(r[s])?(l.push(r[s]),s===r.length-1&&t()):(l.length>0&&t(),o=i.pNodes.shift(),o&&o.contains(r[s])?(l.push(r[s]),s===r.length-1&&t()):n.push(r[s]));function t(){let e=[];for(let t=0;t<l.length;t++)e.push(l[t]);l=[],n.push(e)}e(n)}else e([])})).then((async e=>{if(e.length>0){for(let t=0;t<e.length;t++)Array.isArray(e[t])?await f(e[t],o):await f([e[t]],o);return Promise.resolve(t)}return s.trim()&&(t=processSentencesByLength(getNlpSentences(s))),Promise.resolve(t)})))).catch((e=>{}))}(!0,!0,r):i(r);if("emailThread"===r)return n=!1,function(n="emailThread"){let r=document.getElementById("nr-gmail-email");if(r){let o=r.innerText.trim();return e.docInnerText===o&&"convert"!==n&&"emailThread"!==n?Promise.reject("ERR_ALREADY_PARSED"):("convert"!==n&&(e.docInnerText=o),new Promise((async e=>{await l(),"convert"!==n&&await removeNRTags(),e()})).then((()=>new Promise((t=>{let n=$("#nr-gmail-email"),l=[];for(let e=0;e<n.length;e++)l=l.concat(h(n[e]));e.toRead=Array.from(l),t(l)})).catch((e=>{})))).then((e=>new Promise((async l=>{if("all"===n||"emailThread"===n)for(let t=0;t<e.length;t++){let l=$(e[t]).find(":visible").filter(p).hide();await u(e[t],n),l.show()}else{let n=w(e.map(y)).filter(isNotEmpty);for(let e=0;e<n.length;e++)n[e]&&t.push(n[e])}l(t)})))).catch((e=>{})))}}(r)}(r),o(t)}catch(e){d(e)}}))},this.parseForConvertToPdf=function(){if(e.toRead.length>0){let t=[];for(let n=0;n<e.toRead.length;n++)t=t.concat(o(e.toRead[n]));return Promise.resolve(t)}return c().then((e=>{let t=[];for(let n=0;n<e.length;n++)t=t.concat(o(e[n]));return t})).catch((e=>{}))}};