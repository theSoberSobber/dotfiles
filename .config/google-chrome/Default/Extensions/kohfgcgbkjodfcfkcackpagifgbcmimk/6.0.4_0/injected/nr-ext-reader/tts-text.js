function TtsText(){function e(e,t){let n=e.substring(0,t);if(e.length<=t)return e.length;{let r=Number.MAX_VALUE,s=n.lastIndexOf(" ");return s<=r&&s>=0&&(r=s),r===Number.MAX_VALUE&&(r=-1),r<=0?t:r+10>=e.length?e.length:r}}function t(e,t=500){let n=[];for(;e.length>0;){let s=r(e,t),u=e.substring(0,s+1);n.push(u),e=e.substring(s+1)}return n}function n(e){let t="",n=[];for(let r=0;r!=e.length;r++){t+=e[r];let s=!0;r+1<e.length&&((t+e[r+1]).length>250&&(s=!1),t.length<50&&(s=!0)),r!=e.length-1&&s||(n.push(t),t="")}return n}function r(e,t){let n=["?","!","¿","¡","。","～","……","！","？"],r=[",",";",":","，","；","："],s=e.substring(0,t);if(e.length<=t)return e.length-1;{let u=Number.MAX_VALUE;for(let e=0;e<n.length;e++){let t=s.indexOf(n[e]);t<=u&&t>=0&&(u=t)}if(u===Number.MAX_VALUE&&(u=-1),u<=0){for(let e=0;e<r.length;e++)u=Math.max(s.lastIndexOf(r[e]),u);return u<=0&&(u=s.lastIndexOf(" "),u<=0&&(u=s.lastIndexOf("〿"))),u<=0?t-1:u}return e[u+1]&&'"'===e[u+1]?u+1:u}}function s(e){const t=/[\*\.\?\+\$\^\[\]\(\)\{\}\|\\\/\:\<\>\=\-]/g;let n=e,r=!1;return(t.test(e)||/[^ -~]/g.test(e))&&(r=!0,n=e.replace(t,(function(e){return"\\"+e}))),{hasSpecialChars:r,processedText:n}}self=this,self.textsForTts=[],self.clearTexts=function(){self.textsForTts=[]},self.previewTexts={en:"Hi. I can read webpages or documents for you.",es:"¡Hola! Puedo leer sus páginas web o documentos por usted.",fr:"Salut! Je peux lire vos pages Web ou documents pour vous.",de:"Hallo! Ich kann Ihre Webseiten oder Dokumente für Sie lesen.",it:"Ciao! Posso leggere le tue pagine web o documenti per te.",pt:"Olá! Posso ler suas páginas da web ou documentos para você.",sv:"Hej! Jag kan läsa dina webbsidor eller dokument åt dig.",nl:"Hallo! Ik kan uw webpagina's of documenten voor u lezen.",ro:"Salut! Îți pot citi paginile web sau documentele pentru tine.",tr:"Merhaba! Web sayfalarınızı veya belgelerinizi sizin için okuyabilirim.",ru:"Здравствуйте! Я могу читать ваши веб-страницы или документы для вас.",pl:"Cześć! Mogę dla ciebie czytać twoje strony internetowe lub dokumenty.",no:"Hallo! Jeg kan lese websidene eller dokumentene dine for deg.",is:"Halló! Ég get lesið vefsíður þínar eða skjöl fyrir þig.",da:"Hej! Jeg kan læse dine websider eller dokumenter for dig."},self.getIndexOfNNextSentence=async function e(t,n){try{if(0===t)return n;if(t>=1&&n>=ttsText.textsForTts.length-1)return-1;{n++;let r=ttsText.textsForTts[n].processed;return r&&""!==r.trim()?e(t-1,n):e(t,n)}}catch(e){}},self.getIndexOfNPrevSentence=async function e(t,n){try{if(0===t)return n;if(t>0&&n<=0)return-1;{n--;let r=ttsText.textsForTts[n].processed;return r&&""!==r.trim()?e(t-1,n):e(t,n)}}catch(e){}},self.getTextsForTts=function(e,t,n){n(ttsText.textsForTts)},self.asyncFunctions=["getTextsForTts"],self.getTextChunks=function(t){let n=0,r=[];for(;t.trim();){let s=e(t,60),u=t.substring(0,s).trim();t=t.substring(s),r.push({charIndex:n,text:u}),n+=s}return r},self.textChunks=[],self.processSentencesByLength=function(e){let r=[];for(let s=0;s<e.length;s++){let u=t(e[s]);u=n(u),r.push(...u)}return r},self.getNlpSentences=function(e){return nlp(e).sentences().data().map((e=>e.text.trim()))},self.processText=function(e){let t=function(e){if(!e||0===e.trim().length)return"";for(let t=0;t<pe.peList.length;t++){let n=pe.peList[t].matchCase?"":"i";if(pe.peList[t].hasSpecialChars){if(pe.peList[t].ignoreWordBoundary){const r=new RegExp(s(pe.peList[t].processedSource).processedText,"gm"+n);e=e.replace(r,pe.peList[t].processedReplace)}}else{let r=null;r=pe.peList[t].ignoreWordBoundary?new RegExp(pe.peList[t].processedSource,"gm"+n):new RegExp("\\b"+pe.peList[t].processedSource+"\\b","gm"+n),e=e.replace(r,pe.peList[t].processedReplace)}}const t=e.split(" ");for(let e=0;e<t.length;e++)pe.peMap&&pe.peMap.has(t[e])&&(t[e]=pe.peMap.get(t[e]));return t.join(" ")}(e);t=function(e){let t=e.replace(/<br\s*\/?>/gi,". ");return t=t.replace(/[\u25a0-\u25ff|\u2700-\u27bf]/gi,""),t=t.replace(/[\u200c|\u200b|\u200d|\ufeff]/gi," "),t=t.replace(/[\u0000|\u001b|\u001c|\u001f|\ufe4f|\u005f|\uff3f]/g,""),t=t.replace(/[\u2018|\u2019|\u2039|\u203A]/g,"'"),t=t.replace(/[\u201c|\u201d|\u00ab|\u00bb]/g,'"'),t=t.replace(/[\uff01]/g,"!"),t=t.replace(/[\uff1f]/g,"?"),t=t.replace(/[\uff0c]/g,","),t=t.replace(/[\uff1a]/g,":"),t=t.replace(/[\uff1b]/g,";"),t=t.replace(/[\u2026]/g,"."),t=t.replace(/[\u2014|\u2015]/g,"-"),t=t.replace(/[\u005f|\uff3f]/g," "),t=t.replace(/(^|\s*)(&c\.|&c|etc)(\s|\”|\’|\'|\"|\;|\,|\?|\!|$)/g,"$1etc.$3"),t}(t);let n=function(e){return nlp(e).normalize({case:!1,punctuation:!1,contractions:!1,unicode:!1,numbers:!1}).out("text")}(t);n.trim()&&t&&(t=n);return t},browser.runtime.onMessage.addListener((function(e,t,n){if(self[e.fn]&&(self[e.fn](e,t,n),r=e.fn,self.asyncFunctions.includes(r)))return!0;var r}))}var ttsText=ttsText||new TtsText;