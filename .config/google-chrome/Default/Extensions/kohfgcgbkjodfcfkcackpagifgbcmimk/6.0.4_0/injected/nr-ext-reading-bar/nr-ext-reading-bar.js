function NRExtReadingBar(){let e=this;e.capsule=null,e.dragHandle=null,e.prevPos={top:null,right:null},e.readingBarDocument=null,e.frame=null,displace=window.displacejs,e.hasReadingBar=!1,e.isVoicesInit=!1,e.mode="max",e.theme="light",e.systemTheme="light",e.isAutoSelectVoice=!1,e.isImmersive=!1,e.isImmersiveTextSpacing=!1,e.immersiveTextSize=1,e.isInjectingReadingBar=!1,e.showOnboard=!1,e.isSavingToMobile=!1,e.isAsyncFunction=function(t){return e.asyncFunctions.includes(t)},e.asyncFunctions=["getHasTextProcessor","getHasReadingBar","injectReadingBar"],e.getHasTextProcessor=function(e,t,n){try{return void 0===nrTextProcessor?n(!1):n(!0),!0}catch(e){return n(!1),!0}},e.getHasReadingBar=function(t,n,i){i(e.hasReadingBar)},e.injectReadingBar=he,e.setReadingBarSetting=D,e.updateReadingBarSetting=function(t,n,i){e.settings=t.settings},e.setReadingBarVisibility=fe,e.setReadingBarUI=c,e.toggleReadingBar=xe,e.voicesOnLoad=function(t,n,i){e.settings.freeVoice=e.settings.freeVoice?e.settings.freeVoice:voices.defaultFreeVoice,e.settings.premVoice=e.settings.premVoice?e.settings.premVoice:voices.defaultPremVoice,e.settings.plusVoice=e.settings.plusVoice?e.settings.plusVoice:voices.defaultPlusVoice,e.settings.preset1Voice=e.settings.preset1Voice?e.settings.preset1Voice:voices.defaultPremVoice,e.settings.preset2Voice=e.settings.preset2Voice?e.settings.preset2Voice:voices.defaultPremVoice,e.settings.preferredVoicesByLang=0===Object.keys(e.settings.preferredVoicesByLang).length?voices.preferredVoicesByLang:e.settings.preferredVoicesByLang,voices.preferredVoicesByLang=e.settings.preferredVoicesByLang,e.isVoicesInit||m()},e.updateVoice=p,e.getReadingBarElements=function(){return readingBarElements},e.setPresetAsSelectedVoice=function(t,n,i){const s=t.index,r=e["preset"+s+"VoiceList"].querySelectorAll(".nr-ext-selectable"),o=e["preset"+s+"VoiceListMapper"].selectedIndex,a=r[o],c=a.getAttribute("voiceType"),l=a.getAttribute("value");C(e[c+"VoiceListMapper"],l);const d=e[c+"Voice"],g=new Event("click");d.dispatchEvent(g)},e.setToggle=ie,e.setDyslexia=ee,e.updateNumPages=function(){e.isInjectingReadingBar||(e.immersiveTotalPages.innerText=doc.getNumPages(),Ue(),ttsText.textsForTts&&ttsText.textsForTts.length>0&&Ve(ttsText.textsForTts))},e.toggleImmersive=$e,e.setImmersiveTexts=function(){if(ze(),"googleDoc"==doc.type||"googleDrivePreview"==doc.type||!doc.parseForConvertToPdf)return Promise.resolve().then((()=>{if("googleDoc"!=doc.type)return function(){const t=nrTextProcessor.textsToRead,n=doc.getCurrentIndex();for(let i=0;i<t.length;i++){sentenceId="nr-immersive-s"+i;const s=document.createElement("P"),r=document.createElement("nr-sentence"),o=document.createTextNode(t[i]);r.classList.add(sentenceId),r.id=sentenceId,r.setAttribute("page",n),r.appendChild(o),s.appendChild(r),nrDomController.bindClickToReadEventsForImmersiveReader(r),e.immersiveTextContainer.appendChild(s)}}();doc.parsePageForImmersiveReader().then((function(e){return He(e)}))})).then((()=>{je(),e.immersiveTotalPages.innerText=doc.getNumPages(),e.immersiveCurrentPageInput.value=doc.getPageIndex(),e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",Ue()})).catch((e=>{}));doc.parseForConvertToPdf().then((function(e){return He(e)})).then((()=>{je(),e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",Ue()})).catch((e=>{}))},e.showRelocateButton=function(){"googleDrivePreview"!==doc.type&&"max"===e.mode&&"selection-context-menu"!=reader.readOption&&(e.relocateBtn.style.display="block")},e.hideRelocateButton=Z,e.readSelection=X,e.setCCText=Pe,e.initTooltip=Ie,e.setUIOnLoading=le,e.setUIOnPause=ge,e.setUIOnPlay=de,e.readerOnPlay=function(){de(),async function(t=0,n=null,i=null,r=null,o="nr-ext-reading-bar"){let a;e.progressValue.value?(a=JSON.parse(e.progressValue.value),a.tag=o):a={sentenceIndex:0,pageIndex:-1,percentage:0,lastModified:"sentence",tag:o};if("page"===De(s))if(-1===doc.getPageIndex()){const e=doc.getNumPages();a.pageIndex=e-1}else a.pageIndex=doc.getPageIndex();null!=n&&(a.pageIndex=n);a.sentenceIndex=t,null!=i&&(a.percentage=i);null!=r&&(a.lastModified=r);e.progressValue.value=JSON.stringify(a),e.progressTimeCurr.innerText=e.indexToProgressTime[t]?e.indexToProgressTime[t].displayedTime:"0:00";const c=new Event("change");e.progressValue.dispatchEvent(c)}(reader.currReadIndex),function(t){if(!e.indexToProgressTime[t]||!e.indexToProgressTime[t+1])return;const n=e.indexToProgressTime[t].seconds;e.indexToProgressTime[t+1].seconds;let i=n;e.progressTimeIncrementor&&(clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null);e.progressTimeIncrementor=setInterval((()=>{i++,e.progressTimeCurr.innerText=Ce(i)}),1e3)}(reader.currReadIndex),"undefined"==typeof nrCC||"kindle"!==doc.type&&"googleDoc"!==doc.type||(Pe(ttsText.textsForTts[reader.currReadIndex].processed,reader.currReadIndex),nrCC.isCC?nrCC.setCCVisibility(!0):nrCC.setCCVisibility(!1))},e.readerOnPause=pe,e.readerOnLoading=me,e.readerOnStop=function(){ue()},e.textsToReadOnChange=function(){Le(ttsText.textsForTts),Ve(ttsText.textsForTts)},e.defaultEmail="user@naturalreaders.com",e.freeUserText="Free User",e.premUserText="Premium User",e.plusUserText="Plus User",e.eduPremUserText="Edu Premium Group User",e.freeEduPremUserText="Free Edu Premium Group User",e.eduPremUserExpiredText="Edu Premium Group User (Expired)",e.loadingTimer=null,e.voiceType="prem",e.progressTimeIncrementor=null,e.minimizerTimeout=null,e.isBeingDragged=!1,e.inactivityTimeout=null,e.messageType="signup",e.messageTime=null,e.messageFirstDay=null,e.isShowMobileMessage=!0,e.isShowRateMessage=!0,e.messageIndex=0;let t={ext:"nr-ext",container:"nr-ext-container",exitBtn:"nr-ext-exit",closeMenuBtn:"nr-ext-menu-close",uploadDragAndDrop:"nr-ext-upload-box",uploadFinishDragAndDrop:"nr-ext-drag-and-drop-finish",uploadErrorDragAndDrop:"nr-ext-drag-and-drop-error",uploadBrowseBtn:"nr-ext-btn-upload-browse",openFileBtn:"nr-ext-btn-open-file",uploadDiffFileBtn:"nr-ext-btn-upload-diff-file",uploadProgress:"nr-ext-upload-progress",uploadFileName:"nr-ext-upload-filename",uploadErrorMsg:"nr-ext-upload-error",uploadTryAgainBtn:"nr-ext-btn-upload-try-again",inputTextsBtn:"nr-ext-btn-input-texts",readBtn:"nr-ext-btn-read",forwardBtn:"nr-ext-btn-forward",backwardBtn:"nr-ext-btn-rewind",clickToReadToggle:"nr-ext-click-to-read-toggle",clickToReadTooltip:"nr-ext-tooltip-click",peBtn:"nr-ext-settings-pe",helpBtn:"nr-ext-settings-help",convertBtn:"nr-ext-btn-convert",ccToggle:"nr-ext-cc-toggle",autoScrollToggle:"nr-ext-autoscroll-toggle",darkThemeToggle:"nr-ext-theme-toggle",accountMenu:"nr-ext-account",loginBtn:"nr-ext-login",logoutBtn:"nr-ext-logout",signupBtn:"nr-ext-signup",loginBtnMobile:"nr-ext-mobile-login",signupBtnMobile:"nr-ext-mobile-signup",refreshLicenseBtn:"nr-ext-refresh-license-btn",refreshLicenseBtnIcon:"nr-ext-refresh-license-icon",upgradeBtn:"nr-ext-account-upgrade",userEmail:"nr-ext-account-email",userPlan:"nr-ext-account-plan",mobileAuth:"nr-ext-mobile-auth",mobileTips:"nr-ext-mobile-tips",onboard:"nr-ext-onboard",onboardLight:"nr-ext-onboard-light",onboardDark:"nr-ext-onboard-dark",onboardLogin:"nr-ext-onboard-login",onboardSignup:"nr-ext-onboard-signup",onboardLanguageList:"nr-ext-language-list",onboardVoiceList:"nr-ext-onboard-voice-list",onboardSpeedPreview:"nr-ext-onboard-speed-preivew",noFreeVoices:"nr-ext-no-free-voices",settingsNoFreeVoices:"nr-ext-settings-no-free-voices",noFreeVoicesReloadBtn:"nr-ext-no-free-voices-reload-btn",settingsNoFreeVoicesReloadBtn:"nr-ext-settings-no-free-voices-reload-btn",voiceList:"nr-ext-voice-list",freeVoice:"nr-ext-voice-free",premVoice:"nr-ext-voice-prem",plusVoice:"nr-ext-voice-plus",preset1Voice:"nr-ext-preset1-voice",preset2Voice:"nr-ext-preset2-voice",preset1VoiceFlag:"nr-ext-preset1-voice-flag",preset2VoiceFlag:"nr-ext-preset2-voice-flag",freeVoiceList:"nr-ext-free-voice-list",premVoiceList:"nr-ext-prem-voice-list",plusVoiceList:"nr-ext-plus-voice-list",voiceListSettings:"nr-ext-settings-voice-list",freeVoiceSettings:"nr-ext-settings-voice-free",premVoiceSettings:"nr-ext-settings-voice-prem",plusVoiceSettings:"nr-ext-settings-voice-plus",freeVoiceListSettings:"nr-ext-settings-free-voice-list",premVoiceListSettings:"nr-ext-settings-prem-voice-list",plusVoiceListSettings:"nr-ext-settings-plus-voice-list",preset1VoiceList:"nr-ext-preset1-voice-list",preset2VoiceList:"nr-ext-preset2-voice-list",freeVoiceListMapper:"nr-ext-free-voice-list-mapper",premVoiceListMapper:"nr-ext-prem-voice-list-mapper",plusVoiceListMapper:"nr-ext-plus-voice-list-mapper",preset1VoiceListMapper:"nr-ext-preset1-voice-list-mapper",preset2VoiceListMapper:"nr-ext-preset2-voice-list-mapper",freeVoiceListSettingsMapper:"nr-ext-settings-free-voice-list-mapper",premVoiceListSettingsMapper:"nr-ext-settings-prem-voice-list-mapper",plusVoiceListSettingsMapper:"nr-ext-settings-plus-voice-list-mapper",readIcon:"nr-ext-read-icon",highlightMode:"highlight-mode",highlightModeText:"nr-ext-highlight-mode-text",highlightModeMenu:"nr-ext-highlight-mode-menu",highlightColour:"highlight-color",highlightColourText:"nr-ext-highlight-colour-text",highlightColourMenu:"nr-ext-highlight-color-menu",darkTheme:"nr-ext-theme-dark",lightTheme:"nr-ext-theme-light",systemTheme:"nr-ext-theme-system",autoSelectVoiceToggle:"nr-ext-auto-select-voice",autoSelectVoiceTooltip:"nr-ext-tooltip-auto-select-voice",restartBtn:"nr-ext-settings-restart",restartTooltip:"nr-ext-tooltip-restart-reader",selectableCharLimit:"nr-ext-rs-char-limit",selectedCharLimit:"nr-ext-read-selection-text",hotkeysBtn:"nr-ext-settings-hotkey",speedValue:"nr-ext-speed-slider-value-sender",settingsSpeedValue:"nr-ext-settings-speed-slider-value-sender",onboardSpeedValue:"nr-ext-onboard-speed-slider-value-sender",speedSlider:"nr-ext-speed",settingsSpeedSlider:"nr-ext-settings-speed",volumeValue:"nr-ext-volume-slider-value-sender",ccContainer:"nr-ext-cc",closeCC:"btn-close-cc",ccText:"nr-ext-cc-text",progressMax:"nr-ext-progress-max-sender",progressValue:"nr-ext-progress-value-sender",progressTimeTotal:"nr-ext-progress-time-total",progressTimeCurr:"nr-ext-progress-time-curr",progressLabel:"nr-ext-progress-label",progressSlider:"nr-ext-progress-bar",progressContainer:"nr-ext-progress-container",feedbackBtn:"nr-ext-feedback",uploadBtn:"nr-ext-pdf",saveToMobileBtn:"nr-ext-mobile",convertToPdfBtn:"nr-ext-btn-convert-to-pdf",convertToPdfAgainBtn:"nr-ext-btn-convert-to-pdf-again",saveToMobileErrorMsg:"nr-ext-mobile-error",saveToMobileTryAgainBtn:"nr-ext-btn-mobile-try-again",downloadAndroidBtn:"nr-ext-download-android",downloadIosBtn:"nr-ext-download-ios",maxBtn:"nr-ext-max",settingsBtn:"nr-ext-settings-open",settingsCloseBtn:"nr-ext-settings-close",settingsAccountBtn:"nr-ext-settings-account",settingsAppearanceBtn:"nr-ext-settings-appearance",settingsReaderBtn:"nr-ext-settings-reader",settingsVoicesBtn:"nr-ext-settings-voices",menuContainer:"nr-ext-menu",immersiveBtn:"nr-ext-immersive-toggle",openSettingsIcon:"nr-ext-icon-open-settings",closeSettingsIcon:"nr-ext-icon-close-settings",profileContainer:"ext-profile-container",preferenceBtn:"nr-ext-btn-preference",closePreferenceBtn:"nr-ext-btn-close-preference",presetVoiceListBtn:"nr-ext-btn-preset-voices",closePresetVoiceListBtn:"nr-ext-close-preset-voice-list",quickStartToggle:"nr-ext-toggle-quick-start",quickStartWebpageCheckbox:"nr-ext-quick-start-webpage",quickStartPdfCheckbox:"nr-ext-quick-start-pdf",quickStartGoogleDocsCheckbox:"nr-ext-quick-start-googledocs",quickStartEmailCheckbox:"nr-ext-quick-start-email",quickStartWebsiteCheckbox:"nr-ext-quick-start-website",quickStartOptions:"nr-ext-quick-start-group",readSelectionBtn:"btn_selection",uploadMenu:"nr-ext-upload-menu",mobileMenu:"nr-ext-mobile-menu",openVoiceMenu:"nr-ext-menu-open",closeVoiceMenu:"nr-ext-menu-close",voiceMenu:"nr-ext-demo-voice",settingsMenu:"nr-ext-settings",settingsTitle:"settings-title",launchContainer:"nr-ext-launch",launchClose:"launch-close",launchClose2:"launch-close2",launchClose3:"launch-close3",launchStep2:"launch-step2",launchStep3:"launch-step3",relocateBtn:"nr-ext-btn-relocate",uploadTooltip:"nr-ext-tooltip-upload",immersiveReader:"nr-ext-immersive-reader",immersiveTextSettingsButton:"nr-ext-immersive-trigger",immersiveCloseBtn:"nr-ext-immersive-close",immersiveTextSpacingToggle:"nr-ext-immersive-toggle-text-spacing",immersiveTextSizeSlider:"nr-ext-immersive-textsize",immersiveTextSizeValueSender:"nr-ext-immersive-textsize-value-sender",immersiveTextContainer:"nr-ext-immersive-text-container",immersiveTextContent:"nr-ext-immersive-text",immersiveTextSettingsMenu:"nr-ext-immersive-menu",immersiveDyslexiaToggle:"nr-ext-immersive-toggle-dyslexia",immersiveNextPageButton:"nr-ext-immersive-next-page",immersivePrevPageButton:"nr-ext-immersive-prev-page",immersiveTotalPages:"nr-ext-immersive-all-page",immersivePagesToolbar:"nr-ext-immersive-reader-pages",immersiveCurrentPageInput:"nr-ext-immersive-current-page",msgBar:"nr-ext-msg-bar",msgBox:"nr-ext-msg-box",mobileMsgOffCheckbox:"ext-msg-hide",msgAndroidButton:"nr-ext-msg-android",msgIosButton:"nr-ext-msg-ios",msgMobileDownload:"nr-ext-msg-download-mobile",msgRateNo:"nr-ext-rate-no",msgRateYes:"nr-ext-rate-yes",msgLeaveReviewButton:"nr-ext-msg-leave-review"},n={both:{key:"both",value:["sentence","word"],text:"Sentence and word"},sentence:{key:"sentence",value:["sentence"],text:"Sentence only"},word:{key:"word",value:["word"],text:"Word only"},none:{key:"none",value:[],text:"None"}};e.indexToProgressTime={},e.isAutoScroll=!0,e.isDyslexic=!1,e.isClickToRead=!0,e.isCC=!1,e.isQuickStartWebpage=!0,e.isQuickStartPdf=!0,e.isQuickStartGoogleDocs=!0,e.isQuickStartEmail=!0,e.isQuickStartThisWebsite=!0,e.isDarkTheme=!1,e.isReadIcon=!0;let s="all";function r(e){return"ccContainer"===e||"closeCC"===e||"ccText"===e}async function o(){try{await new Promise((n=>{for(let n in t)r(n)?e[n]=nrCC.ccDocument.getElementById(t[n]):e[n]=e.readingBarDocument.getElementById(t[n]);e.speedRange=$(e.speedSlider).data("ionRangeSlider"),e.settingsSpeedRange=$(e.settingsSpeedSlider).data("ionRangeSlider"),n()})).catch((e=>{})),await new Promise((t=>{const n={constrain:!1,handle:e.dragHandle,onMouseDown:E,onMouseUp:R,customMove:A};displace(e.capsule,n),e.capsule.style.position="fixed",e.exitBtn.onclick=()=>{Q(),xe()},e.readBtn.onclick=W,e.forwardBtn.onclick=reader.forward,e.backwardBtn.onclick=reader.backward,$(e.openVoiceMenu).on("click",(function(){$(e.container).attr("menu-status","open"),d()})),$(e.closeVoiceMenu).on("click",(function(){$(e.container).attr("menu-status","init");const t=(new Date).getTime(),n=setInterval((()=>{(!e.voiceMenu.classList.contains("collapsing")||(new Date).getTime()-t>=1e3)&&(clearInterval(n),d())}),100)})),e.settingsBtn.onclick=()=>{q()},e.settingsCloseBtn.onclick=()=>{q()},e.settingsAccountBtn.onclick=()=>{z("account")},e.settingsAppearanceBtn.onclick=()=>{z("appearance")},e.settingsVoicesBtn.onclick=()=>{z("voices")},e.settingsReaderBtn.onclick=()=>{z("reader-settings")},e.darkTheme.onclick=()=>{te("dark")},e.lightTheme.onclick=()=>{te("light")},e.systemTheme.onclick=()=>{te("system")},$("#nr-ext-highlight-color-list input[name='nr-ext-highlight-color']",e.readingBarDocument).on("click",(function(){k($(this).val(),$("#nr-ext-highlight-color-list",e.readingBarDocument).attr("value"))})),$("#nr-ext-highlight-type-list .dropdown-item",e.readingBarDocument).on("click",(function(){b($(this).attr("value"))})),e.immersiveBtn.onclick=()=>{$e()},e.quickStartToggle.onclick=t=>{"on"!==e.quickStartToggle.getAttribute("toggle-status")?(re("webpage",!0),re("googleDocs",!0),re("website",!0)):(re("webpage",!1),re("googleDocs",!1),re("website",!1)),oe()},e.quickStartWebpageCheckbox.onclick=()=>{re("webpage",!e.isQuickStartWebpage,!0)},e.quickStartPdfCheckbox.onclick=()=>{re("pdf",!e.isQuickStartPdf,!0)},e.quickStartGoogleDocsCheckbox.onclick=()=>{re("googleDocs",!e.isQuickStartGoogleDocs,!0)},e.quickStartEmailCheckbox.onclick=()=>{re("email",!e.isQuickStartEmail,!0)},e.quickStartWebsiteCheckbox.onclick=()=>{re("website",!e.isQuickStartThisWebsite,!0)},e.selectableCharLimit.onclick=t=>{!function(t){const n=t.target.innerText;L(t.target);const i=parseInt(n.split(" ")[0],10);e.selectedCharLimit.innerText=n,D("LimitedReadSelectionCharAmount",i)}(t)},e.freeVoice.onclick=()=>{H("free")},e.premVoice.onclick=()=>{H("prem")},e.plusVoice.onclick=()=>{H("plus")},e.freeVoiceSettings.onclick=()=>{H("free")},e.premVoiceSettings.onclick=()=>{H("prem")},e.plusVoiceSettings.onclick=()=>{H("plus")},e.speedValue.onchange=()=>{Le(ttsText.textsForTts),D("speed",e.speedValue.value),Se(e.speedValue.value)},e.settingsSpeedValue.onchange=()=>{Le(ttsText.textsForTts),D("speed",e.settingsSpeedValue.value),Be(e.settingsSpeedValue.value)},e.onboardSpeedValue.onchange=()=>{Le(ttsText.textsForTts),D("speed",e.onboardSpeedValue.value),Be(e.onboardSpeedValue.value),Se(e.onboardSpeedValue.value)},e.volumeValue.onchange=()=>{D("volume",e.volumeValue.value)},e.autoSelectVoiceToggle.onclick=()=>{ae(!e.isAutoSelectVoice)},e.clickToReadToggle.onclick=()=>{ne(!e.isClickToRead)},e.readIcon.onclick=()=>{ce(!e.isReadIcon)},e.ccToggle.onclick=()=>{se(!e.isCC)},e.autoScrollToggle.onclick=()=>{Y(!e.isAutoScroll,!0)},e.closeCC.onclick=()=>{se(!1)},e.peBtn.onclick=J,e.helpBtn.onclick=()=>{window.open("https://help.naturalreaders.com/en/collections/785014-naturalreader-online-chrome-extension","_blank")},e.convertBtn.onclick=()=>{nrTextProcessor.getTextsFromPage("convert").then((function(e){if(e&&0===e.length)throw new Error("ERR_NO_TEXT");{const t=new Blob([e.join("\n")],{type:"text/plain"}),n=window.URL.createObjectURL(t);chrome.runtime.sendMessage({fn:"setFile",url:n,fileName:"ext-file.txt"},(()=>{chrome.runtime.lastError}))}})).catch((function(e){return e&&e.message?chrome.runtime.sendMessage({fn:"displayAlertMessage",message:e.message}):chrome.runtime.sendMessage({fn:"displayAlertMessage",message:new Error("ERR_UNKNOWN")})}))},e.loginBtn.onclick=M,e.loginBtnMobile.onclick=M,e.logoutBtn.onclick=I,e.onboardLogin.onclick=()=>{Qe(!1),M()},e.signupBtn.onclick=P,e.signupBtnMobile.onclick=P,e.onboardSignup.onclick=()=>{Qe(!1),P()},e.refreshLicenseBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"updateLicense"},(()=>{chrome.runtime.lastError})),e.refreshLicenseBtnIcon.classList.add("spin")},e.feedbackBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"openReportIssues"},(()=>{chrome.runtime.lastError}))},e.convertToPdfBtn.onclick=be,e.convertToPdfAgainBtn.onclick=be,e.downloadAndroidBtn.onclick=()=>{_("android")},e.downloadIosBtn.onclick=()=>{_("ios")},e.saveToMobileTryAgainBtn.onclick=()=>{U(e.mobileMenu,"save-status","init")},e.inputTextsBtn.onclick=G,e.uploadBrowseBtn.onchange=t=>{O(e.uploadBrowseBtn.files[0])},e.openFileBtn.onclick=()=>{if(e.uploadPdfUrl){const t=N(e.uploadFileName.innerText);"pdf"===t||"txt"===t?chrome.runtime.sendMessage({fn:"setFile",url:e.uploadPdfUrl,fileName:e.uploadFullFileName},(()=>{chrome.runtime.lastError})):chrome.runtime.sendMessage({fn:"openFileInPW",pdfUrl:e.uploadPdfUrl,source:"ext-file"},(()=>{chrome.runtime.lastError}))}},e.uploadDiffFileBtn.onclick=()=>{U(e.uploadMenu,"upload-status","init")},e.uploadTryAgainBtn.onclick=()=>{U(e.uploadMenu,"upload-status","init")},e.uploadDragAndDrop.ondrop=t=>{e.uploadDragAndDrop.classList.remove("ondrag"),t.stopPropagation(),t.preventDefault(),O(t.dataTransfer.files[0])},e.uploadDragAndDrop.ondragenter=t=>{t.stopPropagation(),t.preventDefault(),e.uploadDragAndDrop.classList.add("ondrag")},e.uploadDragAndDrop.ondragleave=t=>{e.uploadDragAndDrop.classList.remove("ondrag")},e.uploadDragAndDrop.ondragover=t=>{e.uploadDragAndDrop.classList.contains("ondrag")||e.uploadDragAndDrop.classList.add("ondrag"),t.stopPropagation(),t.preventDefault()},e.uploadErrorDragAndDrop.ondrop=e=>{e.stopPropagation(),e.preventDefault(),O(e.dataTransfer.files[0])},e.uploadErrorDragAndDrop.ondragenter=t=>{e.uploadErrorDragAndDrop.classList.add("ondrag"),t.stopPropagation(),t.preventDefault()},e.uploadErrorDragAndDrop.ondragleave=t=>{e.uploadErrorDragAndDrop.classList.remove("ondrag")},e.uploadErrorDragAndDrop.ondragover=t=>{e.uploadErrorDragAndDrop.classList.contains("ondrag")||e.uploadErrorDragAndDrop.classList.add("ondrag"),t.stopPropagation(),t.preventDefault()},e.uploadFinishDragAndDrop.ondrop=t=>{e.uploadFinishDragAndDrop.classList.remove("ondrag"),t.stopPropagation(),t.preventDefault(),O(t.dataTransfer.files[0])},e.uploadFinishDragAndDrop.ondragenter=t=>{e.uploadFinishDragAndDrop.classList.add("ondrag"),t.stopPropagation(),t.preventDefault()},e.uploadFinishDragAndDrop.ondragover=t=>{e.uploadFinishDragAndDrop.classList.contains("ondrag")||e.uploadFinishDragAndDrop.classList.add("ondrag"),t.stopPropagation(),t.preventDefault()},e.hotkeysBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"editHotkeys"},(()=>{chrome.runtime.lastError}))},e.restartBtn.onclick=K,e.noFreeVoicesReloadBtn.onclick=K,e.progressValue.onchange=Me((()=>{let t=JSON.parse(e.progressValue.value);"nr-ext-reading-bar"!==t.tag&&("page"===t.lastModified?reader.readIndex(null,t.pageIndex,t.percentage):reader.readIndex(t.sentenceIndex))})),e.upgradeBtn.onclick=()=>{12===e.settings.userInfo.licNum?chrome.runtime.sendMessage({fn:"upgrade"},(()=>{chrome.runtime.lastError})):window.open("https://www.naturalreaders.com/checkout/plans?plan=personal","_blank")},e.relocateBtn.onclick=()=>{"reading"===reader.state&&"undefined"!=typeof nrDomController&&("kindle"===doc.type?nrDomController.highlightLocation(reader.currReadIndex):nrDomController.scrollTo(reader.currReadIndex)),"kindle"!==doc.type&&Z()},e.maxBtn.onclick=()=>{l("max")},e.exitBtn.onclick=()=>{Q(),xe()},e.container.onmouseenter=()=>{null!==e.minimizerTimeout&&clearTimeout(e.minimizerTimeout)},e.dragHandle.onmouseenter=()=>{e.isBeingDragged=!0,null!==e.minimizerTimeout&&clearTimeout(e.minimizerTimeout)},e.dragHandle.onmouseleave=()=>{e.isBeingDragged=!1},e.onboardLight.onclick=()=>{te("light")},e.onboardDark.onclick=()=>{te("dark")},$(".nr-ext-onboard-skip",e.readingBarDocument).on("click",(function(){Qe(!1),reader.stop()})),$(".nr-ext-onboard-next",e.readingBarDocument).on("click",(function(){let t=parseInt($(e.onboard).attr("onboard-step"));2===t&&reader.stop(),t<5?($(e.onboard).attr("onboard-step",t+1),1==t&&h()):$(e.onboard).fadeOut("fast",d)})),$(".nr-ext-msg-close",e.readingBarDocument).on("click",(function(){g()})),e.mobileMsgOffCheckbox.onchange=t=>{e.mobileMsgOffCheckbox.checked&&(e.isShowMobileMessage=!1,D("isShowMobileMessage",!1))},e.msgAndroidButton.onclick=()=>{_("android")},e.msgIosButton.onclick=()=>{_("ios")},e.msgMobileDownload.onclick=()=>{j("msgBar",!1),j("msgBox",!0),clearTimeout(e.minimizerTimeout),e.minimizerTimeout=null,d()},e.msgRateNo.onclick=()=>{g(),chrome.runtime.sendMessage({fn:"openReportIssues"},(()=>{chrome.runtime.lastError}))},e.msgRateYes.onclick=()=>{U(e.msgBox,"msg-type","review")},e.msgLeaveReviewButton.onclick=()=>{window.open("https://chrome.google.com/webstore/detail/natural-reader-text-to-sp/kohfgcgbkjodfcfkcackpagifgbcmimk","_blank"),g()},$("#nr-ext-language-list .dropdown-item",e.readingBarDocument).on("click",(function(){const t=$(this).attr("value");$("#nr-ext-language-list .dropdown-item",e.readingBarDocument).removeClass("active"),$(this).addClass("active"),f(t)})),$("#nr-ext-voices-prev",e.readingBarDocument).on("click",(function(){preVoiceOnboard()})),$("#nr-ext-voices-next",e.readingBarDocument).on("click",(function(){nextVoiceOnboard()})),e.onboardSpeedPreview.onclick=()=>{T()},t()})).catch((e=>{})),await c(),await async function(){try{if(e.immersiveTextSettingsButton.onclick=()=>{"open"===$(e.immersiveReader).attr("menu-status")?($(e.immersiveTextSettingsMenu).fadeOut("fast"),$(e.immersiveReader).attr("menu-status","close")):($(e.immersiveTextSettingsMenu).fadeIn("fast"),$(e.immersiveReader).attr("menu-status","open"))},e.immersiveCloseBtn.onclick=()=>{$e()},e.immersiveDyslexiaToggle.onclick=()=>{ee(!e.isDyslexic)},e.isImmersiveTextSpacing=e.settings.isImmersiveTextSpacing,e.immersiveTextSize=e.settings.immersiveTextSize,qe(e.isImmersiveTextSpacing),function(t,n=!0){e.immersiveTextSizeValueSender.value=t;const i=new Event("change");e.immersiveTextSizeValueSender.dispatchEvent(i),$(e.immersiveTextContent).attr("text-scale",t),n&&D("immersiveTextSize",t)}(e.immersiveTextSize,!1),e.immersiveTextSpacingToggle.onclick=()=>{qe(!e.isImmersiveTextSpacing)},$(e.immersiveTextContent).attr("text-scale",e.immersiveTextSize),e.immersiveTextSizeValueSender.onchange=()=>{e.immersiveTextSize=e.immersiveTextSizeValueSender.value,D("immersiveTextSize",e.immersiveTextSize)},"undefined"!=typeof doc&&("googleDoc"===doc.type||"googleDrivePreview"===doc.type)){e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",e.immersivePagesToolbar.style.display="flex";const t=doc.getNumPages();e.immersiveTotalPages.innerText=t,e.immersiveCurrentPageInput.value=doc.getPageIndex(),e.immersiveCurrentPageInput.max=t,$(e.immersiveCurrentPageInput).on("keyup",(function(t){if("Enter"===t.key||13===t.keyCode){const t=e.immersiveCurrentPageInput.value;t&&t>=1&&t<=doc.getNumPages()?Oe(t-1):e.immersiveCurrentPageInput.value=doc.getPageIndex()+1}})),Ue(),e.immersivePrevPageButton.onclick=Me((()=>{Oe(doc.getPageIndex()-1)})),e.immersiveNextPageButton.onclick=Me((()=>{Oe(doc.getPageIndex()+1)}))}}catch(e){}}(),e.isVoicesInit||await m(),chrome.runtime.sendMessage({fn:"addMostListenedWebsite",origin:location.origin})}catch(e){}}function a(t,n){return new Promise(((i,s)=>{let r;if(!t){let e=n.match(/\.([^.]+)$/);e&&(t=e[1])}t||(t="js"),"css"===t?(r=document.createElement("link"),r.type="text/css",r.rel="stylesheet",r.href=n,e.readingBarDocument.head.appendChild(r)):"js"===t&&(r=document.createElement("script"),r.type="text/javascript",r.src=n,e.readingBarDocument.body.appendChild(r)),r&&(r.onload=()=>{i(n)},r.onerror=()=>{s(n)})})).catch((e=>{}))}function c(t,s,r){return new Promise((t=>{chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(async s=>{if(chrome.runtime.lastError,e.settings=s,e.voiceType=e.settings.voiceType,e.settings.freeVoice=e.settings.freeVoice?e.settings.freeVoice:voices.defaultFreeVoice,e.settings.premVoice=e.settings.premVoice?e.settings.premVoice:voices.defaultPremVoice,e.settings.plusVoice=e.settings.plusVoice?e.settings.plusVoice:voices.defaultPlusVoice,e.settings.preset1Voice=e.settings.preset1Voice?e.settings.preset1Voice:voices.defaultPremVoice,e.settings.preset2Voice=e.settings.preset2Voice?e.settings.preset2Voice:voices.defaultPremVoice,e.settings.preferredVoicesByLang=0===Object.keys(e.settings.preferredVoicesByLang).length?voices.preferredVoicesByLang:e.settings.preferredVoicesByLang,voices.preferredVoicesByLang=e.settings.preferredVoicesByLang,Te(e.settings.userInfo,e.settings.loggedIn),e.messageType=e.settings.messageType?e.settings.messageType:"signup",e.messageTime=e.settings.messageTime?e.settings.messageTime:null,e.messageFirstDay=e.settings.messageFirstDay?e.settings.messageFirstDay:null,!e.messageFirstDay){const t=Date.now();D("messageFirstDay",t),e.messageFirstDay=t}e.isShowMobileMessage=!("isShowMobileMessage"in e.settings)||e.settings.isShowMobileMessage,e.isShowRateMessage=!("isShowRateMessage"in e.settings)||e.settings.isShowRateMessage;let r=n.none;e.settings.beHighlighted.length>0&&(r=e.settings.beHighlighted.length>1?n.both:n[e.settings.beHighlighted[0]]),k(e.settings.highlightColour,"light"),b(r.key),"kindle"!==doc.type&&"googleDoc"!==doc.type||se(e.settings.isCC),re("webpage",e.settings.isQuickStartWebpage),re("pdf",e.settings.isQuickStartPdf),re("googleDocs",e.settings.isQuickStartGoogleDocs),re("email",e.settings.isQuickStartEmail),e.isQuickStartThisWebsite=!(location.origin in e.settings.quickStartBlackList),re("website",e.isQuickStartThisWebsite),oe(),"kindle"===doc.type&&(e.ccToggle.style.display="inline-block",e.immersiveBtn.style.display="none",e.saveToMobileBtn.style.display="none"),"googleDoc"===doc.type&&(e.ccToggle.style.display="inline-block",e.immersiveBtn.style.display="none"),"googleDrivePreview"===doc.type&&(e.immersiveBtn.style.display="none"),ve(e.settings.highlightColour),ee(e.settings.isDyslexic),e.systemTheme=e.settings.systemTheme,te(e.settings.theme),e[e.theme+"Theme"].checked=!0,Y(e.settings.isAutoScroll),e.isClickToRead=e.settings.isClickToRead,ae(e.settings.isAutoSelectVoice),e.isVoicesInit?(p(),C(e.preset1VoiceListMapper,e.settings.preset1Voice),C(e.preset2VoiceListMapper,e.settings.preset2Voice)):await m(),function(t,n=!0){e.speedValue.value=t,e.settingsSpeedValue.value=t;const i=new Event("change");e.speedValue.dispatchEvent(i),e.settingsSpeedValue.dispatchEvent(i),n&&D("speed",t)}(e.settings.speed,!1),function(t,n=!0){e.volumeValue.value=t;const i=new Event("change");e.volumeValue.dispatchEvent(i),n&&D("volume",t)}(e.settings.volume,!1),ce(e.settings.readIcon),function(t){const n=t+" characters";e.selectedCharLimit.innerText=n;const s=e.selectableCharLimit.querySelectorAll(".nr-ext-selectable");for(i=0;i<s.length;i++)if(s[i].innerText==n){L(s[i]);break}}(e.settings.LimitedReadSelectionCharAmount),"reading"===reader.state?de():"pause"===reader.state?ge():"loading"===reader.state?le():ue(),"googleDoc"===doc.type||"googleDrivePreview"===doc.type?(e.progressLabel.style.display="none",e.progressSlider.classList.contains("nr-ext-full")||e.progressSlider.classList.add("nr-ext-full")):(e.progressLabel.style.display="block",e.progressSlider.classList.contains("nr-ext-full")&&e.progressSlider.classList.remove("nr-ext-full")),Ie(e.relocateBtn,"right","Relocate text"),Ie(e.exitBtn,"left","Exit"),Ie(e.refreshLicenseBtn,"bottom","Refresh License"),Ie(e.convertBtn,"bottom","Convert to MP3"),Ie(e.saveToMobileBtn,"bottom","Save to Mobile"),Ie(e.uploadBtn,"bottom","Upload Document"),Ie(e.immersiveBtn,"bottom","Immersive Reader"),l(e.settings.mode),d(),e.showOnboard?(Qe(!0),chrome.runtime.sendMessage({fn:"setShowOnboard",val:!1},(()=>{chrome.runtime.lastError}))):e.onboard&&e.onboard.remove(),t()}))})).then((()=>{e.settings.isVisible&&t&&(t.beingReadTabId&&t.beingReadTabId===t.tabId&&t.activeTabId===t.tabId||!t.beingReadTabId&&t.tabId&&t.activeTabId===t.tabId)?fe(!0):fe(!1)})).catch((e=>{}))}function l(t){$(e.container).attr("ext-size",t),e.mode=t,"min"===e.mode&&(e.relocateBtn.style.display="none"),d()}function d(){if(!("init"===$(e.ext).attr("ext-settings"))||e.isImmersive||e.showOnboard)return e.dragHandle.style.display="none",e.prevPos.right=e.capsule.style.right,e.prevPos.top=e.capsule.style.top,e.capsule.style.position="fixed",e.capsule.style.height="100%",e.capsule.style.width="100%",e.capsule.style.top=0,void(e.capsule.style.right=0);e.dragHandle.style.display="block";if("min"==$(e.container).attr("ext-size")){const t="90px",n="90px";e.capsule.style.height=n,e.capsule.style.width=t,e.dragHandle.style.left="6px",e.dragHandle.style.top="58px"}else{const t="340px";e.capsule.style.width=t;let n=136;e.dragHandle.style.left="20px",e.dragHandle.style.top="91px";"init"==$(e.container).attr("menu-status")||(n+=443),($(e.msgBox).is(":visible")||"block"===e.msgBox.style.display)&&(n+=390),n+="px",e.capsule.style.height=n}null!=e.prevPos.top&&null!=e.prevPos.right&&(e.capsule.style.top=e.prevPos.top,e.capsule.style.right=e.prevPos.right),e.prevPos.top=null,e.prevPos.right=null,e.container.style.display="block"}function g(){j("msgBar",!1),j("msgBox",!1),d()}function u(t){e.messageTime=Date.now(),t||(t=e.messageType),D("messageType",t),D("messageTime",e.messageTime)}function p(){let t=e[e.settings.voiceType+"Voice"];const n=new Event("click");t.dispatchEvent(n)}function m(){return new Promise((function(t){voices.isSettingVoices||(e.isVoicesInit=!0,function(){const t=voices.voices.free;t&&Object.keys(t).length>0?(e.noFreeVoices&&(e.noFreeVoices.remove(),e.noFreeVoicesReloadBtn.remove()),e.settingsNoFreeVoices&&(e.settingsNoFreeVoices.remove(),e.settingsNoFreeVoicesReloadBtn.remove()),v("freeVoiceList",t),v("freeVoiceListSettings",t)):(e.noFreeVoices.innerHTML='No voices are available on your device or there might be a problem when retrieving the voices. Please try re-installing the extension, closing other TTS applications or clicking the "Restart Reader" button below. Sorry for the inconvenience. If problem persists, please contact us.',e.noFreeVoicesReloadBtn.style.display="block",e.settingsNoFreeVoices.innerHTML='No voices are available on your device or there might be a problem when retrieving the voices. Please try re-installing the extension, closing other TTS applications or clicking the "Restart Reader" button below. Sorry for the inconvenience. If problem persists, please contact us.',e.settingsNoFreeVoicesReloadBtn.style.display="block")}(),function(){const e=voices.voices.prem;v("premVoiceList",e),v("premVoiceListSettings",e)}(),function(){const e=voices.voices.plus;v("plusVoiceList",e),v("plusVoiceListSettings",e)}(),function(){const e=voices.voices.all;v("preset1VoiceList",e),v("preset2VoiceList",e)}(),e.showOnboard&&function(){const t=["en-US","en-GB","en-AU","en-IN","en-CY","es-ES","es-US","fr-FR","fr-CA","pt-PT","pt-BR","de-DE","it-IT","nl-NL","sv-SE","da-DK","is-IS","no-NO","pl-PL","ro-RO","ru-RU","tr-TR","cy-GB"],n=voices.voices.prem,i=voices.voices.plus;for(let s=0;s<t.length;s++){let r=y(Object.values(n),t[s]);r=r.concat(y(Object.values(i),t[s]));const o=document.createElement("DIV");o.classList.add("nr-ext-voices-onboard"),o.id="nr-ext-onboard-lang-voices-"+t[s];for(let e=0;e<r.length;e++){const t=r[e],n=document.createElement("DIV");n.classList.add("nr-ext-voices-item"),n.setAttribute("voiceType",t.type),n.setAttribute("value",t.key),n.id="nr-ext-onboard-voice-"+t.key,n.innerHTML='<div class="nr-ext-voices-name">'+t.name+'</div><div class="nr-ext-voices-animation">\n                            <svg class="nr-ext-wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 38.05">\n                            <use xlink:href="#nr-ext-wave"></use>\n                          </svg>\n                            </div>',"Sharon"===t.name&&n.classList.add("selected-onboard-voice"),o.appendChild(n)}o.style.display="none",e.onboardVoiceList.appendChild(o),$(o).scrollLeft(0)}h(),f("en-US")}(),H(e.voiceType)),t()})).catch((e=>{}))}function h(){const t=$(e.onboardVoiceList).width(),n=Math.floor((t-100)/4);$(".nr-ext-voices-onboard .nr-ext-voices-item",e.readingBarDocument).outerWidth(n),$(".nr-ext-voices-onboard .nr-ext-voices-item",e.readingBarDocument).off("click"),$(".nr-ext-voices-onboard .nr-ext-voices-item",e.readingBarDocument).on("click",(function(){const t=$(this).attr("value");$(this).attr("index");x(t,this),function(t,n){$(".nr-ext-voices-animation",e.readingBarDocument).hide(),$(n).find(".nr-ext-voices-animation").fadeIn("fast").css("display","flex"),T(t),setTimeout((()=>{$(n).find(".nr-ext-voices-animation").hide()}),3500)}(t,this)})),$(".nr-ext-voices-onboard",e.readingBarDocument).css("transform","translateX(0px)")}function x(t,n){n.parentElement.setAttribute("selectedVoice",t),$(".nr-ext-voices-item",e.readingBarDocument).removeClass("selected-onboard-voice"),$(n).addClass("selected-onboard-voice");const i=n.getAttribute("voiceType");D("voiceType",i),D(i+"Voice",t)}function f(t){$("#nr-ext-language-list",e.readingBarDocument).attr("value")==t||($("#nr-ext-language-list",e.readingBarDocument).attr("value",t),$("#nr-ext-voice-language",e.readingBarDocument).text(S(t)),$(".nr-ext-voices-onboard",e.readingBarDocument).each((function(){if($(this).hide(),this.id==="nr-ext-onboard-lang-voices-"+t){const n=$("#nr-ext-onboard-lang-voices-"+t,e.readingBarDocument).attr("selected-voice");let i=null;i=n?$("#nr-ext-onboard-voice-"+n,e.readingBarDocument).get()[0]:$("#nr-ext-onboard-lang-voices-"+t+" .nr-ext-voices-item",e.readingBarDocument).first().get()[0];x(i.getAttribute("value"),i),$(this).show()}})))}function v(t,n){let i=t+"Mapper";!function(t,n){const i=e[t];i.innerHTML="";for(let e in n){if(t.includes("free")&&n[e].isPrem)continue;const s=document.createElement("div");s.classList.add("nr-ext-voice-cell");const r=document.createElement("label");r.classList.add("nr-ext-selectable");const o=document.createElement("div");o.classList.add("nr-ext-voice"),o.classList.add(n[e].language);const a=document.createElement("div");a.classList.add("voice");const c=n[e].isLegacy;a.innerText=c?S(n[e].language)+" - "+n[e].name+" (legacy)":S(n[e].language)+" - "+n[e].name;let l=null;if(t.includes("preset"))r.classList.add("preset-voice"),a.innerText="free"===n[e].type?"Free: "+a.innerText:("prem"===n[e].type?"Premium: ":"Plus: ")+a.innerText,r.appendChild(o),r.appendChild(a),s.appendChild(r);else{r.classList.add("voice-detail"),r.htmlFor=n[e].key,l=document.createElement("button"),l.classList.add("ext-icon-button-sm"),l.innerHTML='<svg class="ext-icon"><use xlink:href="#ext_icon_play"></use></svg>',l.onclick=()=>{T(n[e].key)},l.style.opacity=0,s.onmouseover=()=>{"reading"!==reader.state&&"loading"!==reader.state?l.style.opacity=1:l.style.opacity=0,a.style.overflow="visible"},s.onmouseleave=()=>{l.style.opacity=0,a.style.overflow=""},r.appendChild(o),r.appendChild(a);const i=document.createElement("input");i.type="radio",i.name=t+"Voice",i.id=n[e].key,i.value=n[e].key,s.appendChild(r),s.appendChild(l),s.appendChild(i)}t.includes("preset")&&(r.setAttribute("voiceType",n[e].type),r.setAttribute("isPreset",!0)),r.setAttribute("value",n[e].key),i.appendChild(s),s.onclick=e=>{const n=e.target;l&&(l.contains(n)||n===l)||B(r,t)}}}(t,n),function(t,n){const i=e[t];i.options.length=0;for(let e in n){if(t.includes("free")&&n[e].isPrem)continue;const s=document.createElement("option");s.text=n[e].key,s.value=n[e].key,i.add(s)}i.onchange=Me(V)}(i,n),i==e.settings.voiceType+"VoiceListMapper"?C(e[e.settings.voiceType+"VoiceListMapper"],e.settings[e.settings.voiceType+"Voice"]):i==e.settings.voiceType+"VoiceListsSettingsMapper"?C(e[e.settings.voiceType+"VoiceListSettingsMapper"],e.settings[e.settings.voiceType+"Voice"]):"preset1VoiceListMapper"==i?C(e.preset1VoiceListMapper,e.settings.preset1Voice):"preset2VoiceListMapper"==i&&C(e.preset2VoiceListMapper,e.settings.preset2Voice)}function y(e,t,n=2){let i=[],s=!1;for(let r=0;r<e.length;r++){const o=e[r];if(o.language)if(o.language==t){if(s=!0,i.push(o),i.length>=n)return i}else if(!0===s)return i}return i}function T(e){reader.preview(e)}function b(t){switch($("#nr-ext-highlight-type-list",e.readingBarDocument).attr("value",t),$("#nr-ext-highlight",e.readingBarDocument).show(),t){case"both":$("#nr-ext-highlight-type-text",e.readingBarDocument).text("Sentence & Word");break;case"sentence":$("#nr-ext-highlight-type-text",e.readingBarDocument).text("Sentence Only");break;case"word":$("#nr-ext-highlight-type-text",e.readingBarDocument).text("Word Only");break;case"none":$("#nr-ext-highlight-type-text",e.readingBarDocument).text("None"),$("#nr-ext-highlight",e.readingBarDocument).hide()}D("beHighlighted",n[t].value);const i=$("#nr-ext-highlight-color-list",e.readingBarDocument).attr("value");k(i,i)}function k(t,n){$("#nr-ext-highlight-color-list",e.readingBarDocument).attr("value",t),e.readingBarDocument.getElementById("nr-ext-highlight-"+t).checked=!0,function(t,n){const i=$("#nr-ext-highlight-type-list",e.readingBarDocument).attr("value");var s="nr-sentence-highlight-"+t,r="nr-word-highlight-"+t;switch(function(t){var n="nr-sentence-highlight-"+t,i="nr-word-highlight-"+t;$("#nr-ext-highlight-preview .nr-ext-sentence",e.readingBarDocument).removeClass(n),$("#nr-ext-highlight-preview .nr-ext-word",e.readingBarDocument).removeClass(i)}(n),i){case"both":$("#nr-ext-highlight-preview .nr-ext-sentence",e.readingBarDocument).addClass(s),$("#nr-ext-highlight-preview .nr-ext-word",e.readingBarDocument).addClass(r);break;case"sentence":$("#nr-ext-highlight-preview .nr-ext-sentence",e.readingBarDocument).addClass(s);break;case"word":$("#nr-ext-highlight-preview .nr-ext-word",e.readingBarDocument).addClass(r)}}(t,n),D("highlightColour",t)}function S(e){switch(e){case"en-US":return"English (US)";case"en-GB":case"en-UK":return"English (UK)";case"en-CY":return"English (Wales)";case"en-AU":return"English (Australia)";case"en-IN":return"English (India)";case"es-ES":case"es-CA":return"Spanish (Spain)";case"es-MX":return"Spanish (Mexico)";case"de-DE":return"German";case"fr-FR":return"French";case"es-US":return"Spanish (US)";case"it-IT":return"Italian";case"pl-PL":return"Polish";case"nl-NL":return"Dutch";case"tr-TR":return"Turkish";case"no-NO":case"nb-NO":return"Norwegian";case"is-IS":return"Icelandic";case"da-DK":return"Danish";case"cy-GB":return"Welsh";case"zh-CN":return"Chinese";case"zh-TW":return"Chinese (Taiwan)";case"zh-HK":return"Chinese (Hong Kong)";case"ja-JP":return"Japanese";case"ko-KR":return"Korean";case"hi-HI":return"Hindi";case"id-ID":return"Indonesian";case"ro-RO":return"Romanian";case"ru-RU":return"Russian";case"pt-BR":return"Portuguese (Brazil)";case"pt-PT":return"Portuguese (Portugal)";case"fr-CA":return"French (Canada)";case"sv-SE":return"Swedish";default:return e}}function B(t,n){const i=t.getAttribute("value");t.getAttribute("isPreset");let s=null,r=null;switch(n){case"freeVoiceList":case"freeVoiceListSettings":default:s=e.freeVoiceListMapper,r=e.freeVoiceListSettingsMapper;break;case"premVoiceList":case"premVoiceListSettings":s=e.premVoiceListMapper,r=e.premVoiceListSettingsMapper;break;case"plusVoiceList":case"plusVoiceListSettings":s=e.plusVoiceListMapper,r=e.plusVoiceListSettingsMapper;break;case"preset1VoiceList":s=e.preset1VoiceListMapper,e.preset1Voice.textContent=t.textContent.split(": ")[1],L(t);break;case"preset2VoiceList":s=e.preset2VoiceListMapper,e.preset2Voice.textContent=t.textContent.split(": ")[1],L(t)}C(s,i),C(r,i)}function V(n){let i,s,r="";switch(r=n.target.id.includes("plus")?"plus":n.target.id.includes("prem")?"prem":n.target.id.includes("preset1")?"preset1":n.target.id.includes("preset2")?"preset2":"free",r&&D(r+"Voice",n.target.value),n.target.id){case t.freeVoiceListMapper:case t.freeVoiceSettingsListMapper:i=e.freeVoiceList,s=e.freeVoiceListSettings;break;case t.premVoiceListMapper:case t.premVoiceSettingsListMapper:i=e.premVoiceList,s=e.premVoiceListSettings;break;case t.plusVoiceListMapper:case t.plusVoiceListSettingsMapper:i=e.plusVoiceList,s=e.plusVoiceListSettings;break;case t.preset1VoiceListMapper:i=e.preset1VoiceList;break;case t.preset2VoiceListMapper:i=e.preset2VoiceList;break;default:i=e.freeVoiceList,s=e.freeVoiceListSettings}const o=i.querySelectorAll(".nr-ext-selectable");let a=null;s&&(a=s.querySelectorAll(".nr-ext-selectable"));try{JSON.parse(o[n.target.selectedIndex].getAttribute("isPreset"))&&(n.target.id.includes("preset1")?(e.preset1VoiceFlag.className="",e.preset1VoiceFlag.classList.add("nr-ext-voice"),e.preset1VoiceFlag.classList.add(o[n.target.selectedIndex].language),e.preset1Voice.textContent=o[n.target.selectedIndex].textContent.split(": ")[1]):n.target.id.includes("preset2")&&(e.preset2VoiceFlag.className="",e.preset2VoiceFlag.classList.add("nr-ext-voice"),e.preset2VoiceFlag.classList.add(o[n.target.selectedIndex].language),e.preset2Voice.textContent=o[n.target.selectedIndex].textContent.split(": ")[1]))}catch(e){}w(o[n.target.selectedIndex]),a&&w(a[n.target.selectedIndex])}function L(e){try{if(e.classList.contains("preset-voice")){const t=e.parentElement.parentElement.querySelector(".nr-ext-selectable.selected");e.classList.contains("selected")||(e.classList.add("selected"),t&&t.classList.remove("selected"))}else{const t=e.parentElement.querySelector(".nr-ext-selectable.selected");e.classList.contains("selected")||(e.classList.add("selected"),t&&t.classList.remove("selected"))}}catch(e){}}function w(e){try{const t=e.parentElement.querySelector("input");t&&!t.checked&&(t.checked=!0)}catch(e){}}function C(e,t){let n=e;const i=new Event("change");n&&null!==t&&(n.value=t),n&&n.dispatchEvent(i)}function D(t,n,i=null){"voiceType"===t&&n!==e.settings.voiceType?(reader.setTts(n),i&&i.sameLang&&voices.autoSelectVoice(e.settings[e.settings.voiceType+"Voice"].split(" ").pop(),n),reader.replay()):"freeVoice"==t||"premVoice"==t||"plusVoice"==t?(i&&!i.isAutoSelected&&voices.rememberPreferredVoiceByLang(t.split("Voice")[0],n),"default"===n&&(n=voices[n+(t.charAt(0).toUpperCase()+t.slice(1))]),n!==e.settings[t]&&(reader.setTts(e.settings.voiceType),reader.replay())):("speed"===t&&n!==e.settings.speed||"volume"===t&&n!==e.settings.volume)&&reader.replay(),e.settings[t]=n,i&&i.toPlay&&reader.play(),chrome.runtime.sendMessage({fn:"setReadingBarSetting",key:t,value:n},(()=>{chrome.runtime.lastError}))}function I(){chrome.runtime.sendMessage({fn:"logout"},(()=>{chrome.runtime.lastError}))}function M(){chrome.runtime.sendMessage({fn:"login"},(()=>{chrome.runtime.lastError}))}function P(){chrome.runtime.sendMessage({fn:"signup"},(()=>{chrome.runtime.lastError}))}function E(){document.body.style.pointerEvents="none"}function R(){document.body.style.pointerEvents="unset"}function A(t,n,i){const s=window.innerHeight,r=window.innerWidth;let o=90,a=90;"max"===e.container.getAttribute("ext-size")&&(o=340,a=74),t.style.right=n>=0&&n+o<=r?r-(n+o)+"px":n<0?r-o+"px":"0px",i>=0&&i+a<=s?t.style.top=i+"px":i<0?t.style.top="0px":t.style.bottom=s+"px"}function F(t){return new Promise((async(n,i)=>{const s=["jpeg","png","jpg"],r=N(t.name);if(t.size>52428800)"pdf"===r?t.size>209715200?i(new Error("Upload PDF failed: over 200MB")):n():i(new Error("Upload failed: over 50MB"));else if(-1===["txt","odp","odt","ods","pages","numbers","ppt","pptx","xls","xlsx","jpeg","png","jpg","doc","docx","pdf","rtf","epub"].indexOf(r))i(new Error("Upload failed: unsupported file type"));else{const t=await new Promise((t=>{if(e.settings&&e.settings.userInfo){const n=e.settings.userInfo;let i=0,s=0;n.licNum?i=n.licNum:n.license&&(i=parseInt(n.license)),n.pwLicNum&&(s=parseInt(n.pwLicNum)),t(12===i||12===s||13===i||13===s||i>=32&&i<=37)}else t(!1)})).catch((e=>Promise.resolve(!1)));s.indexOf(r)>-1&&!t?i(new Error("Upload failed: OCR not supported")):n()}})).catch((e=>Promise.reject(e)))}function N(e){const t=e.toString();return t.substring(t.lastIndexOf(".")+1).toString().toLowerCase()}function O(t=null){if(!t)return;const n=(uuidv4()+"#"+t.name).replace(/[*]/g,"_");return F(t).then((()=>{const i=N(t.name);if("pdf"!==i&&"txt"!==i)return U(e.uploadMenu,"upload-status","uploading"),e.uploadProgress.innerText="0%",function(e,t){return chrome.amplifyStorage.put(t,e,{level:"public",contentType:"multipart/form-data"}).catch((e=>Promise.reject(new Error("ERR_UPLOAD"))))}(t,n).then((()=>{e.settings.userInfo&&e.settings.userInfo.id;const i=new FileReader;new Date;i.onload=function(i){new Date;const s={filename:n,product:"pw",app:"ext",device:"web",filePath:"public/"+n,licNum:e.settings.userInfo?e.settings.userInfo.licNum:"0",ownerEmail:e.settings.userInfo&&e.settings.userInfo.ownerEmail?e.settings.userInfo.ownerEmail:"",userId:e.settings.userInfo&&e.settings.userInfo.id?e.settings.userInfo.id:""};var r=new XMLHttpRequest;r.open("POST","https://dc.naturalreaders.com/convert-to-pdf",!0),r.upload.onprogress=function(t){e.uploadProgress.innerText=Math.round(100*t.loaded/t.total)+"%"},r.onload=()=>{r.status>=400&&(U(e.uploadMenu,"upload-status","error"),e.uploadErrorMsg.innerText="Upload failed: server error or file corrupted"),200==r.status&&(U(e.uploadMenu,"upload-status","finish"),e.uploadPdfUrl=JSON.parse(r.response).pdfurl,e.uploadFileName.innerText=t.name)},r.onerror=function(t){U(e.uploadMenu,"upload-status","error"),e.uploadErrorMsg.innerText="Upload failed: server error or file corrupted"},r.send(JSON.stringify(s))},i.readAsDataURL(t)}));U(e.uploadMenu,"upload-status","finish"),e.uploadPdfUrl=URL.createObjectURL(t),e.uploadFileName.innerText=function(e,t){(e=e.substring(0,e.lastIndexOf(".")).trim()).length>15&&(e=e.slice(0,15));return e+="."+t}(t.name,i),e.uploadFullFileName=t.name})).catch((t=>{U(e.uploadMenu,"upload-status","error"),e.uploadErrorMsg.innerText=t.message}))}function U(e,t,n){$(e).attr(t,n)}function q(){"init"===$(e.ext).attr("ext-settings")?(e.container.style.display="none",$(e.settingsMenu).fadeIn("fast"),$(e.ext).attr("ext-settings","reader-settings"),$(document.body).css("overflow-y","hidden"),d()):(e.container.style.display="block",$(e.settingsMenu).fadeOut("fast",d),$(e.ext).attr("ext-settings","init"),$(document.body).css("overflow-y","auto"))}function z(t){$(e.ext).attr("ext-settings")!=t&&$(e.ext).attr("ext-settings",t)}function H(t){$(e.voiceList).attr("voice-type",t),$(e.voiceListSettings).attr("voice-type",t),"free"===t?(j("freeVoiceList"),j("premVoiceList",!1),j("plusVoiceList",!1),j("freeVoiceListSettings"),j("premVoiceListSettings",!1),j("plusVoiceListSettings",!1),D("voiceType","free")):"prem"===t?(j("premVoiceList"),j("freeVoiceList",!1),j("plusVoiceList",!1),j("premVoiceListSettings"),j("freeVoiceListSettings",!1),j("plusVoiceListSettings",!1),D("voiceType","prem")):(j("plusVoiceList"),j("premVoiceList",!1),j("freeVoiceList",!1),j("plusVoiceListSettings"),j("premVoiceListSettings",!1),j("freeVoiceListSettings",!1),D("voiceType","plus")),C(e[t+"VoiceListMapper"],e.settings[t+"Voice"]),C(e[t+"VoiceListSettingsMapper"],e.settings[t+"Voice"])}function j(t,n=!0){e[t]&&(e[t].style.display=n?"block":"none")}function Q(){reader.stop()}function W(){if("pause"===reader.state||"init"===reader.state)if(nrDomDetector.hasSelectionOnPage(!1))X();else if(!doc||"googleDoc"!==doc.type&&"googleDrivePreview"!==doc.type)if(doc&&"kindle"===doc.type){doc.isSameText()||reader.stop(),reader.play({caller:"readBtn"})}else reader.play({caller:"readBtn"});else if("googleDoc"===doc.type){let e=null;me();const t=setInterval((function(){if(!doc.isRendering){pe(),clearInterval(t),e&&clearTimeout(e);const n=doc.getPageIndex(),i=doc.getCurrentIndex();n!==i?reader.readPage(i,0):reader.play({caller:"readBtn"})}}),100);e=setTimeout((()=>{clearInterval(t),pe()}),6e4)}else{const e=doc.getPageIndex(),t=doc.getCurrentIndex();e!==t?reader.readPage(t):reader.play({caller:"readBtn"})}else reader.pause(!0),function(){const t=e.messageTime?utils.getDiffFromDate(e.messageTime):null,n=e.messageFirstDay?utils.getDiffFromDate(e.messageFirstDay):null;(null==t||t>=1)&&(n>=2&&e.isShowRateMessage?(l("max"),j("msgBar",!1),j("msgBox",!0),U(e.msgBox,"msg-type","rate"),clearTimeout(e.minimizerTimeout),e.minimizerTimeout=null,d(),D("isShowRateMessage",!1),e.isShowRateMessage=!1,e.messageTime=Date.now(),D("messageTime",e.messageTime)):"mobile"!==e.messageType&&e.isShowMobileMessage?(e.messageType="mobile",l("max"),U(e.msgBar,"msg-type","mobile"),U(e.msgBox,"msg-type","mobile"),j("msgBar",!0),j("msgBox",!1),clearTimeout(e.minimizerTimeout),e.minimizerTimeout=null,d(),u()):e.settings.loggedIn||(e.messageType="signup",l("max"),j("msgBar",!0),U(e.msgBar,"msg-type","signup"),clearTimeout(e.minimizerTimeout),e.minimizerTimeout=null,d(),u()))}()}function G(){window.open("https://www.naturalreaders.com/online/?source=ext-input-texts","_blank")}function _(e){let t="";t="ios"===e?"https://apps.apple.com/app/id1487572960":"https://play.google.com/store/apps/details?id=com.naturalsoft.personalweb",window.open(t,"_blank")}function J(){window.open("https://www.naturalreaders.com/online/?action=pe&source=ext-pe","_blank")}function K(){chrome.runtime.sendMessage({fn:"reload"},(()=>{chrome.runtime.lastError}))}function X(){chrome.runtime.sendMessage({fn:"readSelection"},(()=>{chrome.runtime.lastError})),nrDomDetector.frame.style.display="none"}function Y(t,n=!1){e.isAutoScroll=t,ie(e.isAutoScroll,e.autoScrollToggle),D("isAutoScroll",t),n&&chrome.runtime.sendMessage({fn:"relocate"},(()=>{chrome.runtime.lastError}))}function Z(){e.relocateBtn.style.display="none"}function ee(t){e.isDyslexic=t,ie(e.isDyslexic,e.immersiveDyslexiaToggle),D("isDyslexic",e.isDyslexic),function(t){t?("undefined"!=typeof nrCC&&e.ccText.classList.add("dyslexicfonts"),e.immersiveTextContainer.classList.add("dyslexicfonts")):e.immersiveTextContainer.classList.remove("dyslexicfonts")}(t)}function te(t){e.theme=t,D("theme",e.theme),"system"===e.theme&&(t=e.systemTheme),"light"==t?(e.dragHandle.querySelector("#ext-bar-drag").style.fill="#3d5aa1",e.dragHandle.querySelector("#ext-bar-drag").style.color="#3d5aa1"):(e.dragHandle.querySelector("#ext-bar-drag").style.fill="#e0e6ef",e.dragHandle.querySelector("#ext-bar-drag").style.color="#e0e6ef"),U(e.ext,"ext-theme",t)}function ne(t,n=!1){return new Promise((i=>{if(e.isClickToRead=t,D("isClickToRead",e.isClickToRead),e.isClickToRead)if(reader.isFirstRead&&"all"===reader.readOption)if(e.readBtn.classList.add("spin"),e.readBtn.style.pointerEvents="none",e.forwardBtn.style.pointerEvents="none",e.backwardBtn.style.pointerEvents="none",n)e.readBtn.classList.remove("spin"),e.readBtn.style.pointerEvents="auto",e.forwardBtn.style.pointerEvents="auto",e.backwardBtn.style.pointerEvents="auto",i();else{let t="all";nrDomDetector.hasSelectionOnPage(!1)&&(t="selection"),reader.setTextsForTtsWithoutPlay(t),e.readBtn.classList.remove("spin"),e.readBtn.style.pointerEvents="auto",e.forwardBtn.style.pointerEvents="auto",e.backwardBtn.style.pointerEvents="auto",i()}else i();else i();ie(e.isClickToRead,e.clickToReadToggle)})).catch((e=>{}))}function ie(e,t){e?$(t).attr("toggle-status","on"):$(t).attr("toggle-status","off")}function se(t){e.isCC=t,nrCC.isCC=t,ie(e.isCC,e.ccToggle),e.isCC?(D("isCC",!0),"reading"===reader.state?nrCC.setCCVisibility(!0):nrCC.setCCVisibility(!1),e.ccToggle.classList.add("on")):(D("isCC",!1),nrCC.setCCVisibility(!1),e.ccToggle.classList.remove("on"))}function re(t,n=null,i=!1){"webpage"===t?(D("isQuickStartWebpage",n),e.isQuickStartWebpage=n,e.quickStartWebpageCheckbox.checked=e.isQuickStartWebpage):"pdf"===t?(D("isQuickStartPdf",n),e.isQuickStartPdf=n,e.quickStartPdfCheckbox.checked=e.isQuickStartPdf):"email"===t?(D("isQuickStartEmail",n),e.isQuickStartEmail=n,e.quickStartEmailCheckbox.checked=e.isQuickStartEmail,e.isQuickStartEmail||("undefined"!=typeof outlookUiIcons&&outlookUiIcons.removeIcons(),"undefined"!=typeof gmailIcons&&gmailIcons.removeIcons())):"googleDocs"===t?(D("isQuickStartGoogleDocs",n),e.isQuickStartGoogleDocs=n,e.quickStartGoogleDocsCheckbox.checked=e.isQuickStartGoogleDocs):"website"===t&&(e.isQuickStartThisWebsite=n,e.isQuickStartThisWebsite?chrome.runtime.sendMessage({fn:"removeQuickStartBlackList"},(()=>{chrome.runtime.lastError})):chrome.runtime.sendMessage({fn:"addQuickStartBlackList"},(()=>{chrome.runtime.lastError})),e.quickStartWebsiteCheckbox.checked=e.isQuickStartThisWebsite),i&&oe()}function oe(){e.isQuickStartWebpage||e.isQuickStartPdf||e.isQuickStartGoogleDocs||e.isQuickStartEmail||e.isQuickStartThisWebsite?ie(!0,e.quickStartToggle):(e.quickStartOptions.classList.remove("show"),ie(!1,e.quickStartToggle))}function ae(t){e.isAutoSelectVoice=t,ie(e.isAutoSelectVoice,e.autoSelectVoiceToggle),D("isAutoSelectVoice",t)}function ce(t){e.isReadIcon=t,ie(e.isReadIcon,e.readIcon),D("readIcon",e.isReadIcon),null!=nrDomDetector&&nrDomDetector.switchIcon(t)}function le(){$(e.container).attr("data-play","play"),e.readBtn.classList.add("spin"),nrCC.setCCVisibility(!1),$(".nr-ext-preview-voice",e.readingBarDocument).hide(),e.forwardBtn.disabled=!0,e.backwardBtn.disabled=!0}function de(){e.readBtn&&e.readBtn.classList.contains("spin")&&e.readBtn.classList.remove("spin"),$(".nr-ext-preview-voice",e.readingBarDocument).hide(),$(e.container).attr("data-play","play"),e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,g(),"kindle"!==doc.type&&"googleDoc"!==doc.type||(e.ccToggle.style.display="inline-block"),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!0)}function ge(){e.readBtn&&e.readBtn.classList.contains("spin")&&e.readBtn.classList.remove("spin"),"init"!==reader.state&&$(e.container).attr("data-play","pause"),e.ccToggle.style.display="none",e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,nrCC.setCCVisibility(!1),Z(),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!1)}function ue(){e.readBtn&&e.readBtn.classList.contains("spin")&&e.readBtn.classList.remove("spin"),$(e.container).attr("data-play","init"),e.ccToggle.style.display="none",reader.state="init",nrCC.setCCVisibility(!1),e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,Z(),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!1),"kindle"===doc.type&&doc.hideHighlightCanvas()}function pe(){ge(),clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null}function me(){le()}function he(t,n,i){if(doc&&"googleDoc"===doc.type&&!doc.hasAnnotated)return chrome.runtime.sendMessage({fn:"displayAlertMessage",message:"ERR_DOCS_NO_ANNOTATED"}),i(!1);if(t.tabId&&(nrDomController.beingReadTabId=t.tabId),t.activeTabId&&(nrDomController.activeTabId=t.activeTabId),!e.isInjectingReadingBar&&!e.hasReadingBar){if("undefined"!=typeof nrQuickStart){nrQuickStart=null;const e=document.getElementById("nr-ext-quick-start-capsule");e&&e.remove()}e.isInjectingReadingBar=!0,e.showOnboard=!!t.showOnboard&&t.showOnboard,chrome.runtime.sendMessage({fn:"setIcon",state:"loading"},(()=>{chrome.runtime.lastError})),e.loadingTimer||(e.loadingTimer=setTimeout((()=>{clearTimeout(e.loadingTimer),chrome.runtime.sendMessage({fn:"setIcon"},(()=>{chrome.runtime.lastError}))}),1e4));let n=document.createElement("iframe");e.frame=n,e.frame.id="nr-ext-frame",e.frame.style.background="none",e.frame.style.backgroundColor="transparent",e.frame.style.overflow="hidden",e.frame.style.position="absolute",e.frame.style.margin=0,e.frame.style.width="100%",e.frame.style.height="100%",e.frame.style.background="transparent",e.frame.style.top=0,e.frame.style.right=0,e.frame.style.borderStyle="none",e.capsule=document.createElement("DIV"),e.capsule.style.display="none",e.capsule.style.zIndex="999999999",e.capsule.id="nr-ext-capsule",e.capsule.appendChild(e.frame),e.capsule.style.top="70px",e.capsule.style.right="34px";const s=document.createElement("DIV");s.style.margin=0,s.style.zIndex="2000",s.style.width="20px",s.style.height="20px",s.style.padding="2px",s.style.lineHeight="14px",s.style.cursor="grab";const r='<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 24 24" id="ext-bar-drag"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>';s.innerHTML+=r,s.style.background="transparent",s.style.position="absolute",e.dragHandle=s,e.capsule.appendChild(e.dragHandle),document.body.appendChild(e.capsule),e.frame.onload=async()=>{let n=!1;t.isEmail&&(n=t.isEmail),await async function(t=!1){await a(null,chrome.runtime.getURL("assets/css/bootstrap.min.css")),await a(null,chrome.runtime.getURL("assets/css/ion.rangeSlider.css")),await a(null,chrome.runtime.getURL("injected/nr-ext-reading-bar/nr-ext-reading-bar.css")),await a(null,chrome.runtime.getURL("assets/js/jquery-3.6.0.min.js")),await a(null,chrome.runtime.getURL("assets/js/bootstrap.bundle.min.js")),await a(null,chrome.runtime.getURL("assets/js/ion.rangeSlider.min.js")),await a(null,chrome.runtime.getURL("injected/nr-ext-reading-bar/slider-init.js")),await o(),fe(!0),D("isVisible",!0),e.hasReadingBar=!0,chrome.runtime.sendMessage({fn:"setIcon"},(()=>{chrome.runtime.lastError})),clearTimeout(e.loadingTimer),e.isInjectingReadingBar=!1,ie(e.isClickToRead,e.clickToReadToggle)}(n),e.inactivityTimeout=setTimeout((()=>{reader.setIsSpeechMark(!1)}),2e4),document.addEventListener("mousedown",utils.debounce(We,1e3)),document.addEventListener("wheel",utils.debounce(We,1e3)),document.addEventListener("keydown",utils.debounce(We,1e3)),document.addEventListener("touchstart",utils.debounce(We,1e3)),document.addEventListener("touchmove",utils.debounce(We,1e3)),document.addEventListener("visibilitychange",(e=>{"visible"!==document.visibilityState&&reader.setIsSpeechMark(!1)})),i(!0)},fetch(chrome.runtime.getURL("injected/nr-ext-reading-bar/nr-ext-reading-bar.html")).then((e=>e.text())).then((t=>{try{e.frame.contentDocument.write(t),e.readingBarDocument=e.frame.contentDocument,e.frame.contentDocument.close()}catch(t){e.frame.contentDocument.close()}})).catch((e=>{}))}}function xe(t,n,i){t&&t.toShow||"none"===e.capsule.style.display?(fe(!0),D("isVisible",!0),c(t),reader.isFirstRead&&("undefined"!=typeof nrTextProcessor&&nrTextProcessor.resetDocInnerTexts(),ne(e.isClickToRead))):(fe(!1),D("isVisible",!1)),t.beingReadTabId&&(nrDomController.beingReadTabId=t.beingReadTabId),t.activeTabId&&(nrDomController.activeTabId=t.activeTabId)}function fe(t){e.capsule.style.display=t?"block":"none"}function ve(t,n=null){e.ccContainer&&(n&&e.ccContainer.classList.remove("nr-sentence-highlight-"+n),e.ccContainer.classList.add("nr-sentence-highlight-"+t))}function ye(t){t||(e.userEmail.innerText="",e.userPlan.innerText=e.freeUserText),t.email&&t.email!=e.defaultEmail?e.userEmail.innerText=t.email:e.userEmail.innerText="";let n=0;t.licNum?n=t.licNum:t.license&&(n=t.license,"0"===n?n=0:"12"===n?n=12:"32"===n?n=32:"13"===n&&(n=13));let i=t.pwLicNum;12==n?(e.userPlan.innerText=e.premUserText,j("upgradeBtn",!0)):13==n?(e.userPlan.innerText=e.plusUserText,j("upgradeBtn",!1)):n>=33&&0==i||n>=33&&12==i?(e.userPlan.innerText=e.eduPremUserText,j("upgradeBtn",!0)):32==n&&0==i||32==n&&12==i?(e.userPlan.innerText=e.freeEduPremUserText,j("upgradeBtn",!0)):31==n&&0==i?(e.userPlan.innerText=e.eduPremUserExpiredText,j("upgradeBtn",!0)):(e.userPlan.innerText=e.freeUserText,j("upgradeBtn",!0))}function Te(t,n){e.refreshLicenseBtnIcon.classList.remove("spin"),n?($(e.accountMenu).attr("ext-account","login"),$(e.logoutBtn).css("display","flex"),$(e.mobileAuth).hide(),$(e.mobileTips).show(),e.peBtn&&(e.peBtn.disabled=!1),e.onboard&&"none"!==e.onboard.style.display&&Qe(!1,"max"),ye(t)):($(e.accountMenu).attr("ext-account","init"),$(e.logoutBtn).fadeOut("fast"),$(e.mobileTips).hide(),$(e.mobileAuth).show(),e.peBtn&&(e.peBtn.disabled=!0),ye(t))}function be(){return"googleDoc"===doc.type?function(){if(e.isSavingToMobile)return;e.isSavingToMobile=!0;const t=e.settings.userInfo?e.settings.userInfo.id:"";U(e.mobileMenu,"save-status","saving"),doc.parseForConvertToPdf().then((function(n){fetch(chrome.runtime.getURL("assets/template.html")).then((e=>e.text())).then((i=>{let s="",r=document.head.getElementsByTagName("title");r.length>0&&(s=r[0].innerText);var o=ke("Description");""==o&&(o=ke("description"));let a=[];for(var c=0;c!=n.length;c++)if(""!=s)a.push(n[c].innerText);else{const e=n[c].nodeName.toLowerCase();"h1"!=e&&"h2"!=e||(s=n[c].innerText)}for(i+=s+"</div>",i+='<div class="pdf-subtitle">'+o+"</div>",i+='<section class="pdf-content">',c=0;c!=a.length;c++)i+='<p class="pdf-paragraphs">'+a[c]+"</p>";i+="</section></body></html>";const l=new XMLHttpRequest,d=new URLSearchParams;d.set("html",i),d.set("title",s),t&&d.set("userid",t),l.open("POST","https://uploadocr.naturalreaders.com/html2pdf"),l.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&this.status>=400&&(U(e.mobileMenu,"save-status","error"),e.saveToMobileErrorMsg.innerText="Server error"),this.readyState===XMLHttpRequest.DONE&&200===this.status&&U(e.mobileMenu,"save-status","finish"),e.isSavingToMobile=!1},l.onerror=function(t){U(e.mobileMenu,"save-status","error"),e.saveToMobileErrorMsg.innerText="Server error",e.isSavingToMobile=!1};try{l.send(d)}catch(t){U(e.mobileMenu,"save-status","error"),e.saveToMobileErrorMsg.innerText="Server or unknown error",e.isSavingToMobile=!1}})).catch((t=>{U(e.mobileMenu,"save-status","error"),e.saveToMobileErrorMsg.innerText="Unknown error",e.isSavingToMobile=!1}))})).catch((t=>{U(e.mobileMenu,"save-status","error"),e.saveToMobileErrorMsg.innerText="Error getting texts from the page",e.isSavingToMobile=!1}))}():function(){if(e.isSavingToMobile)return;let t=location.href;e.isSavingToMobile=!0;let n="NaturalReader_PDF";const i=e.settings.userInfo?e.settings.userInfo.id:"";let s="";U(e.mobileMenu,"save-status","saving");const r="https://readability.naturalreaders.com/";let o={url:t,service:"urltojson"};e.settings.userInfo&&e.settings.userInfo.email&&(s=e.settings.userInfo.email,o.userEmail=s);const a={"Content-Type":"application/json"};return fetch(r+"urltojson",{method:"POST",mode:"cors",cache:"no-cache",headers:a,referrer:"client",referrerPolicy:"origin-when-cross-origin",body:JSON.stringify(o)}).then((e=>e.json())).then((e=>(n=e.title,o={htmlContent:e.content,service:"jsontopdf",url:t,title:n},i&&(o.userId=i),s&&(o.userEmail=s),fetch(r+"jsontopdf",{method:"POST",mode:"cors",cache:"no-cache",headers:a,referrer:"client",referrerPolicy:"origin-when-cross-origin",body:JSON.stringify(o)})))).then((e=>e.json())).then((t=>{U(e.mobileMenu,"save-status","finish"),e.isSavingToMobile=!1})).catch((t=>{U(e.mobileMenu,"save-status","error"),e.saveToMobileErrorMsg.innerText="Error saving page",e.isSavingToMobile=!1}))}()}function ke(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n].getAttribute("content");return""}function Se(t){e.settingsSpeedValue.value=t,e.frame.contentWindow.postMessage({fn:"update",target:"settingsSpeedRange",value:t},"*")}function Be(t){e.speedValue.value=t,e.frame.contentWindow.postMessage({fn:"update",target:"speedRange",value:t},"*")}function Ve(t){return new Promise((n=>{let i={readOption:"all",texts:t,pageCount:-1};if(t.length>0){if(i.readOption=reader.readOption,"page"===De(reader.readOption)&&(i.pageCount=doc.getNumPages()),e.progressMax.value!==JSON.stringify(i)){e.progressMax.value=JSON.stringify(i);var s=new Event("change");e.progressMax.dispatchEvent(s)}n()}else{if(e.progressMax.value!==JSON.stringify(i)){e.progressMax.value=JSON.stringify(i);s=new Event("change");e.progressMax.dispatchEvent(s)}n()}}))}function Le(t=null){if(!t)return;let n=0;t.map(((t,i)=>{if(0===i)e.indexToProgressTime[i]={displayedTime:"0:00",seconds:0};else{const t=Math.round(n/we(e.speedValue.value));e.indexToProgressTime[i]={displayedTime:Ce(t),seconds:t}}n+=t.processed.length}));const i=Math.round(n/we(e.speedValue.value));e.indexToProgressTime[t.length]={displayedTime:Ce(i),seconds:i},e.progressTimeTotal.innerText=Ce(Math.round(n/we(e.speedValue.value)))}function we(e){return isNaN(e)&&(e=parseInt(e)),e/180*5}function Ce(e){const t=parseInt(e,10);let n=Math.floor(t/3600),i=Math.floor((t-3600*n)/60),s=t-3600*n-60*i;return n>=1&&n<10&&(n="0"+n),i<10&&(i="0"+i),s<10&&(s="0"+s),n<1?i+":"+s:n+":"+i+":"+s}async function De(e){let t="sentence";return"undefined"==typeof doc||"googleDoc"!==doc.type&&"googleDrivePreview"!==doc.type||doc.getNumPages()>1&&"selection"!==e&&(t="page"),t}function Ie(t,n,i){const s=e.readingBarDocument.getElementById(t.id+"Tooltip");if(s)return void(s.style.display="none");let r=function(e,t,n){let i=document.createElement("span");n.length>20&&i.classList.add("tooltip");return i.id=e.id+"Tooltip",i.classList.add(t+"Tooltip"),i.style.display="none",i.innerHTML=n,e.appendChild(i),i}(t,n,i);t.onmouseenter=function(){"nr-ext-btn-relocate"===t.id&&"min"===e.mode||(r.style.display="block")},t.onmouseleave=function(){r.style.display="none"},r.onmouseenter=function(){r.style.display="none"}}function Me(e,t=500,n=!0){var i;return function(){var s=this,r=arguments,o=function(){i=null,n||e.apply(s,r)},a=n&&!i;clearTimeout(i),i=setTimeout(o,t),a&&e.apply(s,r)}}function Pe(t,n){$(e.ccText).empty();let i=document.createTextNode(t);e.ccText.appendChild(i)}function Ee(t){const n=t.matches;e.systemTheme=n?"dark":"light",te("system"),chrome.runtime.sendMessage({message:"systemThemeOnChange",value:e.systemTheme})}e.uploadPdfUrl="",e.settings={},chrome.runtime.onMessage.addListener((function(t,n,i){if(t.fn in readingBar){if(readingBar[t.fn](t,n,i),readingBar.isAsyncFunction(t.fn))return!0}else{if("injectReadingBar"===t.message)return he(t,0,i),!0;"textsToReadOnChange"===t.message?(Le(t.texts),Ve(t.texts)):"tabOnActivated"===t.message?c(t):"setLoggedInUI"===t.fn||"setLoggedOutUI"===t.fn?chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(async t=>{chrome.runtime.lastError,e.settings=t,e.settings&&e.settings.userInfo&&Te(e.settings.userInfo,e.settings.loggedIn)})):"readSelectionOnEnd"===t.message||("toggleShowReadIcon"===t.message?ce(t.value):"highlightColourOnChange"===t.message?ve(t.highlightColour,t.oldHighlightColour):"systemThemeOnChange"===t.message?(e.systemTheme=t.value,te("system")):"setReadingBarSetting"===t.message&&D(t.key,t.value,t.data))}}));const Re=window.matchMedia("(prefers-color-scheme: dark)");Re.matches?e.systemTheme="dark":e.systemTheme="light";try{Re.addEventListener("change",(e=>{Ee(e)}))}catch(e){try{Re.addListener((e=>{Ee(e)}))}catch(e){}}function $e(t=null){null===t?(e.isImmersive=!e.isImmersive,e.isImmersive?Ae():Fe()):(e.isImmersive=t,t?Ae():Fe())}function Ae(){e.immersiveBtn.classList.add("on"),"undefined"!=typeof nrTextProcessor&&(!reader.isFirstRead&&nrTextProcessor.isSameText()?($(e.immersiveReader).fadeIn(),$(e.ext).attr("immersive","true"),$(document.body).css("overflow-y","hidden")):(ze(),reader.setTextsForTtsWithoutPlay(),$(e.immersiveReader).fadeIn(),$(e.ext).attr("immersive","true"),$(document.body).css("overflow-y","hidden")),d())}function Fe(){e.immersiveBtn.classList.remove("on"),$(e.ext).attr("immersive","false"),"googleDoc"!==doc.type&&$(document.body).css("overflow-y","auto"),Ne(),$(e.immersiveReader).fadeOut("fast",d)}function Ne(){$(e.immersiveTextSettingsMenu).fadeOut("fast"),$(e.immersiveReader).attr("menu-status","close")}function Oe(e){if("reading"===reader.state)reader.readPage(e);else if(doc.scrollToPage)return doc.scrollToPage(e).then((e=>{reader.setTextsForTtsWithoutPlay()}))}async function Ue(){if(void 0===doc.getPageIndex)return;const t=doc.getPageIndex();e.immersiveCurrentPageInput.value=t+1,e.immersivePrevPageButton.disabled=0===t;const n=doc.getNumPages();e.immersiveNextPageButton.disabled=t>=n-1||-1==t}function qe(t){e.isImmersiveTextSpacing=t,e.isImmersiveTextSpacing?($(e.immersiveTextSpacingToggle).attr("toggle-status","on"),e.immersiveTextContainer.classList.add("nr-text-spacing")):($(e.immersiveTextSpacingToggle).attr("toggle-status","off"),e.immersiveTextContainer.classList.remove("nr-text-spacing")),D("isImmersiveTextSpacing",e.isImmersiveTextSpacing)}function ze(){$(e.immersiveTextContainer).empty()}function He(t){return new Promise((n=>{for(let n=0;n<t.length;n++){const i=t[n];let s=null;"h1"===i.tagName.toLowerCase()?(s=document.createElement("H1"),s.classList.add("nr-immersive-heading1")):"h2"===i.tagName.toLowerCase()?(s=document.createElement("H2"),s.classList.add("nr-immersive-heading2")):s=document.createElement("P");const r=Array.from(i.querySelectorAll("nr-sentence"));let o=-1;for(let t=0;t<r.length;t++){const n=r[t].classList;let i=-1;for(let e=0;e<n.length;e++)if(n[e].includes("nr-s")){i=parseInt(n[e].split("nr-s")[1]);break}if(o!=i){const n=nrTextProcessor.textsToRead[i],a=r[t].cloneNode(!0);$(a).empty();const c=document.createTextNode(n);a.appendChild(c),a.removeAttribute("class"),sentenceId="nr-immersive-s"+i,a.classList.add(sentenceId),a.id=sentenceId,nrDomController.bindClickToReadEventsForImmersiveReader(a),s.appendChild(a),s.appendChild(document.createTextNode(" ")),e.immersiveTextContainer.appendChild(s),o=i}}}n()})).catch((e=>{}))}function je(){e.isDyslexic&&e.immersiveTextContainer.classList.add("dyslexicfonts")}async function Qe(t,n="min"){t?e.onboard.style.display="flex":("prem"===e.settings.voicetype?D("plusVoice","default"):"plus"===e.settings.voiceType&&D("premVoice","default"),p(),l(n),e.onboard.remove(),e.showOnboard=!1),d()}function We(){"undefined"!=typeof nrDomController&&nrDomController.activeTabId&&nrDomController.activeTabId===nrDomController.beingReadTabId&&(e.inactivityTimeout&&(reader.setIsSpeechMark(!0),clearTimeout(e.inactivityTimeout),e.inactivityTimeout=null),e.inactivityTimeout||(e.inactivityTimeout=setTimeout((()=>{reader.setIsSpeechMark(!1)}),2e4)))}}var readingBar=readingBar||new NRExtReadingBar;