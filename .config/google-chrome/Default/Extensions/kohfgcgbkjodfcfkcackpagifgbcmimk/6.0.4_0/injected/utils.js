function Utils(){let e=this;function n(){chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(e=>new Promise((n=>{if(e&&e.userInfo){const t=e.userInfo;let o=0,r=0;t.licNum?o=t.licNum:t.license&&(o=parseInt(t.license)),t.pwLicNum&&(r=parseInt(t.pwLicNum)),n(12===o||12===r||13===o||13===r||o>=32&&o<=37)}else n(!1)})).catch((e=>Promise.resolve(!1)))))}function t(e){const n=e.toString();return n.substring(n.lastIndexOf(".")+1).toString().toLowerCase()}function o(){let e="false";const n=document.getElementById("nr-ext-bootstrap-check");try{e="function"==typeof $().modal||"function"==typeof $().emulateTransitionEnd||window.bootstrap,n.setAttribute("nr-has-bootstrap",e)}catch(t){n.setAttribute("nr-has-bootstrap",e)}}e.tabId=null,e.isAsyncFunction=function(n){return!!e.asyncFunctions.includes(n)},e.displayAlertMessage=function(e){chrome.runtime.sendMessage({fn:"displayAlertMessage",message:e})},e.setTextInNRInput=function(e,n,t){e.text&&e.text.trim()&&(document.getElementById("inputDiv").innerHTML=e.text)},e.getHasUtils=function(e,n,t){t(!0)},e.getDocType=function(n,t,o){if(window.isDocTypeChecked)o(window.docType);else{let n=null;"docs.google.com"==location.hostname?Array.from(document.querySelectorAll(".kix-appview-editor canvas")).length>0?n="googleDoc":document.getElementsByClassName(".drive-viewer-paginated-scrollable").length&&(n="googleDriveDoc"):n=location.hostname.includes("outlook.live")||location.hostname.includes("outlook.office")?"outlookMail":"drive.google.com"==location.hostname?document.getElementsByClassName("drive-viewer-paginated-scrollable").length?"googleDriveDoc":"googleDrivePreview":location.hostname.includes("read.amazon")||location.hostname.includes("ler.amazon")||location.pathname.includes("kindle-library")?"kindle":"mail.google.com"==location.hostname?"gmail":"html",window.isDocTypeChecked=!0,window.docType=n,e.docType=n,o(n)}},e.getOS=function(){let e={os:"non-mac"};-1!==navigator.platform.toUpperCase().indexOf("MAC")&&(e.os="mac");return e},e.getHasBootstrap=function(e,n,t){try{const e=document.createElement("SCRIPT");e.id="nr-ext-bootstrap-check",e.appendChild(document.createTextNode("("+o+")();")),(document.body||document.head||document.documentElement).appendChild(e);const n=e.getAttribute("nr-has-bootstrap");e.remove(),t(n)}catch(e){t(!1)}},e.setTabId=function(n){return Promise.resolve().then((()=>{chrome.runtime.sendMessage({fn:"setTabId",type:n,tabId:e.tabId})})).catch((e=>{}))},e.calculateRate=function(e,n=null){return n&&"google"===n.source?e/180*.66:e/180},e.getLocation=function(e,n,t){t(location)},e.reloadTab=function(e,n,t){setTimeout((()=>{window.location.reload()}),500)},e.getExtName=t,e.blobToFile=function(e,n){return e.lastModifiedDate=new Date,e.name=n,e},e.checkCanUpload=function(e){return new Promise((async(o,r)=>{const i=["jpeg","png","jpg"],c=t(e.name);if(e.size>52428800)"pdf"===c?e.size>209715200?r(new Error("Upload PDF failed: over 200MB")):o():r(new Error("Upload failed: over 50MB"));else if(-1===["txt","odp","odt","ods","pages","numbers","ppt","pptx","xls","xlsx","jpeg","png","jpg","doc","docx","pdf","rtf","epub"].indexOf(c))r(new Error("Upload failed: unsupported file type"));else{const e=await n();i.indexOf(c)>-1&&!e?r(new Error("Upload failed: OCR not supported")):o()}})).catch((e=>Promise.reject(e)))},e.canOCR=n,e.debounce=function(e,n=500,t=!0){var o;return function(){var r=this,i=arguments,c=function(){o=null,t||e.apply(r,i)},a=t&&!o;clearTimeout(o),o=setTimeout(c,n),a&&e.apply(r,i)}},e.getDiffFromDate=function(e){const n=new Date;return e=new Date(e),Math.round((n-e)/864e5)},e.getDiffInMin=function(e){const n=new Date;return e=new Date(e),Math.round((n-e)%864e5%36e5/6e4)},e.calculateScreenCenter=function(e,n,t){let o=e.width,r=e.height,i=0,c=0;try{i=null!=window.screenLeft?window.screenLeft:window.screenX,c=null!=window.screenTop?window.screenTop:window.screenY}catch(e){}let a=null,s=null;try{a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height}catch(e){}let l=a?Math.round(a/2-o/2+i):null,u=a?Math.round(s/2-r/2+c):null;t({left:l,top:u})},e.increaseTtsUsage=function(e,n){let t=new URL("https://moxu0s1jnk.execute-api.us-east-1.amazonaws.com/prod-wpm/incr-tts"),o={l:e,c:n};return t.search=new URLSearchParams(o),fetch(t,{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{let n=e.headers.get("content-type");return e.ok?e.json().then((function(e){return e})):n&&n.includes("application/json")?e.json().then((function(e){throw e&&e.errorCode&&"ERR_CONVERT_LIMIT"===e.errorCode?new Error("ERR_TTS_LIMIT"):e&&e.errorCode&&1005==e.errorCode?new Error(e.errorCode):new Error("ERR_UNKOWN")})):void 0})).catch((e=>{throw e}))},e.detectLanguage=function(e){return n=function(e,n){for(var t=0;t<n.length&&e.length<1e3;t++)e+=n[t]+" ";return e}("",e),function(e){return chrome.i18n.detectLanguage?new Promise((function(n){chrome.i18n.detectLanguage(e,n)})).then((function(e){if(e){var n=e.languages.filter((function(e){return"und"!=e.language}));return n.sort((function(e,n){return n.percentage-e.percentage})),n[0]&&n[0].language}return null})):Promise.resolve(null)}(n).then((function(e){return e}));var n},e.asyncFunctions=["getDocType","getLocation","getHasUtils","getHasBootstrap","calculateScreenCenter"],e.docType="",chrome.runtime.onMessage.addListener((function(n,t,o){if(n.fn in e&&(e[n.fn](n,t,o),e.isAsyncFunction(n.fn)))return!0})),chrome.runtime.sendMessage({fn:"getTabId"},(n=>{e.tabId=n}))}var utils=utils||new Utils,browser="undefined"!=typeof chrome?chrome:void 0!==browser?browser:{};