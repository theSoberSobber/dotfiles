(()=>{function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(t){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?e(Object(s),!0).forEach((function(e){n(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}chrome.pe=new function(){var e=this;function n(e){return chrome.cognitoUser?chrome.cognitoUser.getSession((function(t,n){if(n){var s={Authorization:n.idToken.jwtToken,"Content-Type":"application/json"},o=new URLSearchParams({userId:e});return fetch("https://sgglax06i9.execute-api.us-east-1.amazonaws.com/prod/pe?"+o,{method:"GET",mode:"cors",cache:"no-cache",headers:s,referrer:"client",referrerPolicy:"origin-when-cross-origin"}).then((function(e){return e.json()})).then((function(e){return e.pe?i(r(e.pe)):i([])})).catch((function(e){return i([])}))}console.error("pe getSession error",t)})):i([])}function r(e){return e?e.map(s.bind(this)):[]}function s(e){var n=function(e){var t=/[\*\.\?\+\$\^\[\]\(\)\{\}\|\\\/\:\<\>\=\-]/g,n=/[^ -~]/g,r=e,s=!1;(t.test(e)||n.test(e))&&(s=!0,r=e.replace(t,(function(e){return"\\"+e})));return{hasSpecialChars:s,processedText:r}}(e.source),r={hasSpecialChars:!1,processedText:e.replace};return t(t({},e),{},{processedSource:e.source,processedReplace:r.processedText,hasSpecialChars:n.hasSpecialChars||r.hasSpecialChars,ignoreWordBoundary:e.ignoreWordBoundary,matchCase:e.matchCase})}function o(e){i(r(e.peList))}function i(t){e.peList=t,e.peMap=e.peList.reduce((function(e,t){return e.set(t.source,t.replace),e}),new Map),chrome.storage.sync.set({peList:e.peList}),e.lastUpdated=Date.now();var n=extension.beingReadTabId?extension.beingReadTabId:extension.activeTabId?extension.activeTabId:null;null!=n&&chrome.tabs.sendMessage(n,{fn:"setPeAndTts",peList:e.peList,lastUpdated:e.lastUpdated},(function(){chrome.runtime.lastError}))}e.getPeListForUser=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&t&&n(t.id)},e.setPeAndTts=i,e.getPeLastUpdated=function(t,n,r){r(e.lastUpdated)},e.getLastestPe=function(t,n,r){r({peList:e.peList,peMap:e.peMap,lastUpdated:e.lastUpdated})},e.getPeListAndMap=function(t,n,r){r({peList:e.peList,peMap:e.peMap})},e.isAsyncFunction=function(t){return e.asyncFunctions.includes(t)},e.peList=[],e.peMap=new Map,e.asyncFunctions=[],e.lastUpdated=null,function(){chromeRuntimeMsgExternal.setFilter("setPeData",o.bind(this)),chrome.runtime.onMessage.addListener((function(t,n,r){if(e[t.fn]&&(e[t.fn](t,n,r),e.isAsyncFunction(t.fn)))return!0}))}()}})();