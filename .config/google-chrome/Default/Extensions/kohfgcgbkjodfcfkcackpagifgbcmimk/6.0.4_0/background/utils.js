function Utils(){let e=this;function n(e=null){if(null===e){if(null===extension.activeTabId)return Promise.reject(new Error("ERR_NO_ACTIVE_TAB"));e=extension.activeTabId}return new Promise(((n,t)=>{chrome.tabs.sendMessage(e,{fn:"getHasUtils"},(()=>{chrome.runtime.lastError?chrome.scripting.executeScript({target:{tabId:e},files:["injected/utils.js"]},(()=>{chrome.runtime.lastError&&t(),n()})):n()}))})).catch((e=>{}))}function t(e){let n=e.replace(/'/g,"\\'");return n=n.replace(/"/g,'\\"'),n}function r(e){let n=e.trim();return n=n.replace(/(?:\r\n|\r)/g,"\\n"),n=n.replace(/(?:\n{2,})/g,"\\n"),n=n.replace(/(?<!([\\?\\}\\{\\.\\;\\,\\!\\,]))\n/g,". "),n=n.replace(/(?:\n)/g," "),n}function o(e){let n=function(e){let n=e.replace(/<br\s*\/?>/gi,". ");return n=n.replace(/[\u200c|\u200b|\u200d|\ufeff]/gi," "),n=n.replace(/[\u0000|\u001b|\u001c|\u001f|\ufe4f|\u005f|\uff3f]/g,""),n=n.replace(/[\u2018|\u2019|\u2039|\u203A]/g,"'"),n=n.replace(/[\u201c|\u201d|\u00ab|\u00bb]/g,'"'),n=n.replace(/[\uff01]/g,"!"),n=n.replace(/[\uff1f]/g,"?"),n=n.replace(/[\uff0c]/g,","),n=n.replace(/[\uff1a]/g,":"),n=n.replace(/[\uff1b]/g,";"),n=n.replace(/[\u2026]/g,"."),n=n.replace(/[\u2014|\u2015]/g,"-"),n=n.replace(/[\u005f|\uff3f]/g," "),n=n.replace(/(^|\s*)(&c\.|&c|etc)(\s|\”|\’|\'|\"|\;|\,|\?|\!|$)/g,"$1etc.$3"),n}(e);return n}function c(e){let n=o(e);return n=r(n),n=t(n),n}function i(e){return e.map((function(e){return`<p>${c(e)}</p>`}))}this.getActiveTab=function(){return new Promise((function(e,n){browser.tabs.query({active:!0,lastFocusedWindow:!0},(function(t){t&&t.length>0?e(t[0]):n(new Error("ERR_NO_ACTIVE_TAB"))}))}))},this.getActiveTabId=function(){return new Promise((function(e,n){browser.tabs.query({active:!0,lastFocusedWindow:!0},(function(t){t.length>0?e(t[0].id):n(new Error("ERR_NO_ACTIVE_TAB"))}))}))},this.listenForPortConnection=function(e){return new Promise((function(n,t){browser.runtime.onConnect.addListener((function(r){e===r.name?n(r):t("No port")}))}))},this.writeToLocalStorage=function(e,n){return new Promise((function(n,t){try{browser.storage.local.set(e,(function(e){n({res:"ok",err:null})}))}catch(e){t({res:"ko",err:e})}}))},this.readFromLocalStorage=function(e,n){return new Promise((function(n,t){try{browser.storage.local.get(e,(function(e){n({res:e,err:null})}))}catch(e){t({res:"ko",err:e})}}))},this.debounce=function(e,n=500,t=!0){var r;return function(){var o=this,c=arguments,i=function(){r=null,t||e.apply(o,c)},u=t&&!r;clearTimeout(r),r=setTimeout(i,n),u&&e.apply(o,c)}},this.calculateRate=function(e,n=null){return n&&"google"===n.source?e/180*.66:e/180},this.increaseTtsUsage=function(e,n){let t=new URL("https://moxu0s1jnk.execute-api.us-east-1.amazonaws.com/prod-wpm/incr-tts"),r={l:e,c:n};return t.search=new URLSearchParams(r),fetch(t,{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{let n=e.headers.get("content-type");return e.ok?e.json().then((function(e){return e})):n&&n.includes("application/json")?e.json().then((function(e){throw e&&e.errorCode&&"ERR_CONVERT_LIMIT"===e.errorCode?new Error("ERR_TTS_LIMIT"):e&&e.errorCode&&1005==e.errorCode?new Error(e.errorCode):new Error("ERR_UNKOWN")})):void 0})).catch((e=>{throw e}))},this.runtimeSendMessage=function(e){return new Promise((function(n){browser.runtime.sendMessage(e,(()=>{browser.runtime.lastError})),n()}))},this.getTextsFromPage=function(e,n="all"){let t=[];chrome.tabs.sendMessage(e,{fn:"getTextsFromPage",op:n},(function(e){return chrome.runtime.lastError,t=e,Promise.resolve(t)}))},this.replaceLineBreakWithPeriod=r,this.excapeQuotes=t,this.processText=o,this.processTextForConvert=c,this.addParagraphTagAndCleanUpText=i,this.combineTextForConvertIntoAString=function(e){return i(e).join("")},this.getOS=function(){let e={os:"non-mac"};-1!==navigator.platform.toUpperCase().indexOf("MAC")&&(e.os="mac");return e},this.recordExtUsage=function(e){let n=new URL("https://tuwz0i1tl0.execute-api.us-east-1.amazonaws.com/prod/use-ext"),t={o:e.origin,h:e.href};return n.search=new URLSearchParams(t),fetch(n,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>Promise.resolve())).catch((e=>Promise.resolve()))},this.isWindowValid=function(e){chrome.windows.get(e,{populate:!1,windowTypes:["popup"]},(function(e){return!!e}))},this.getDocType=async function(e){try{e||(e=extension.activeTabId);await n(e);return pdfDoc.checkPDF().then((n=>new Promise((t=>{n.isPdf?t(null):chrome.tabs.sendMessage(e,{fn:"getDocType"},(e=>{chrome.runtime.lastError&&t(null),t(e||null)}))})))).catch((e=>{}))}catch(e){}},this.setFunctionId=function(e){void 0===e?e=0:e++;return e},e.isAsyncFunction=function(n){return e.asyncFunctions.includes(n)},e.asyncFunctions=["getTabId"],e.getTabId=function(e,n,t){t(n.tab.id)},e.setTabId=function(e,n,t){const r=e.type;extension[r+"TabId"]=e.tabId;const o={};o[r+"TabId"]=e.tabId,storage.set(o)},e.getLocation=async function(e=null){null===e&&(e=extension.activeTabId);try{await n(e);return new Promise((n=>{chrome.tabs.sendMessage(e,{fn:"getLocation"},(function(e){chrome.runtime.lastError&&n(null),n(e)}))})).catch((e=>{}))}catch(e){}},e.getUrlInfo=function(e=""){let n={origin:null,href:null};if(e){let t=(e=new URL(e)).origin,r=e.href;n={origin:t,href:r}}return n},this.detectLanguage=function(e){return n=function(e,n){for(var t=0;t<n.length&&e.length<1e3;t++)e+=n[t]+" ";return e}("",e),function(e){return chrome.i18n.detectLanguage?new Promise((function(n){chrome.i18n.detectLanguage(e,n)})).then((function(e){if(e){var n=e.languages.filter((function(e){return"und"!=e.language}));return n.sort((function(e,n){return n.percentage-e.percentage})),n[0]&&n[0].language}return null})):Promise.resolve(null)}(n).then((function(e){return e}));var n},chrome.runtime.onMessage.addListener((function(e,n,t){if(e.fn in utils&&(utils[e.fn](e,n,t),utils.isAsyncFunction(e.fn)))return!0}))}const utils=new Utils;