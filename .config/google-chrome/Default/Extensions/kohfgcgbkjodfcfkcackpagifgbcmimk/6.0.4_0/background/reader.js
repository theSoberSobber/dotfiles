function Reader(){let e=this;function n(e=null,n=null,a=null){e||(e=extension.beingReadTabId?extension.beingReadTabId:extension.activeTabId),n?chrome.tabs.sendMessage(e,{message:"play",caller:n,op:a}):chrome.tabs.sendMessage(e,{message:"play",op:a})}function a(e=null,n=!0){e||(e=extension.beingReadTabId?extension.beingReadTabId:extension.activeTabId),chrome.tabs.sendMessage(e,{message:"stop",toReset:n})}async function t(e=null){let t="emailThread"===e;a();let i=await utils.getDocType(),s=extension.activeTabId;return readingBar.injectReadingBar(s,i,!0,!0,t).then((()=>{t?n(s,null,"emailThread"):n(s)})).catch((e=>{}))}e.state="init",e.isFirstRead=!0,e.readSelection=function(e,t,i){a(extension.beingReadTabId);let s=t&&t.tab.id?t.tab.id:extension.activeTabId;return readingBar.injectReadingBar(s,extension.activeTab.docType,!0,!0).then((()=>{chrome.tabs.sendMessage(s,{fn:"setReadOption",readOption:"selection"},(()=>{chrome.runtime.lastError})),n(s)})).catch((e=>{}))},e.readSelectionWithContextMenu=function(e){return a(extension.beingReadTabId),readingBar.injectReadingBar(extension.activeTabId,extension.activeTab.docType,!0,!0).then((()=>{chrome.tabs.sendMessage(extension.activeTabId,{fn:"readSelectionWithContextMenu",texts:e})})).catch((e=>{}))},e.injectReadingBarAndRead=t,e.setShouldCheckForPreviewMode=function(e,n,a){chrome.tabs.sendMessage(extension.activeTabId,{fn:"setShouldCheckForPreviewMode",val:e.val})},e.hasInvalidLicenseError=!1,e.isWaitingForLicense=!1,e.onLicenseUpdated=function(){e.isWaitingForLicense=!1,chrome.tabs.sendMessage(extension.beingReadTabId,{fn:"onLicenseUpdated"},(()=>{chrome.runtime.lastError}))},e.setState=function(n,a,t){e.state=n.state,storage.set({state:e.state})},e.setIsFirstRead=function(n,a,t){a.tab.id===extension.beingReadTabId&&(e.isFirstRead=n.val)},e.readOption="all",e.setBeingRead=function(n,a,t){n.toReset?(extension.beingReadTab=null,extension.beingReadTabId=null,extension.beingReadWindowId=null,extension.removeTabs({tabIds:[e.audioPlayerTabId]}),e.mediaViolationTabId=null,e.audioPlayerTabId=null,e.readOption="all"):(n.readOption&&(e.readOption=n.readOption),extension.beingReadTab=a.tab,extension.beingReadTabId=a.tabId)},e.isAsyncFunction=function(n){return e.asyncFunctions.includes(n)},e.asyncFunctions=["injectPlayer"],e.play=n,e.pause=function(e=null){e||(e=extension.beingReadTabId);chrome.tabs.sendMessage(e,{message:"pause"})},e.stop=a,e.injectPlayer=function(n,a,t){chrome.tabs.create({url:chrome.runtime.getURL("assets/player.html"),index:0,active:!0}).then((async n=>{e.mediaViolationTabId=a.tab.id,e.audioPlayerTabId=n.id,chrome.tabs.onUpdated.addListener((function e(a,i){a==n.id&&"complete"===i.status&&(chrome.tabs.onUpdated.removeListener(e),t())})),await chrome.tabs.update(n.id,{pinned:!0})})).then((()=>{})).catch((e=>{}))},e.mediaViolationTabId=null,e.audioPlayerTabId=null,chrome.runtime.onMessage.addListener((function(a,i,s){if(e[a.fn]){if(e[a.fn](a,i,s),e.isAsyncFunction(a.fn))return!0}else"play"===a.message?n(null,a.caller):"injectReadingBarAndRead"===a.message&&t(a.op)}))}const reader=new Reader;