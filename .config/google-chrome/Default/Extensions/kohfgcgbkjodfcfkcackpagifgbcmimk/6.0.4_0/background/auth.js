(()=>{function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */n=function(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,n,t){e[n]=t.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{l({},"")}catch(e){l=function(e,n,t){return e[n]=t}}function d(e,n,t,r){var o=n&&n.prototype instanceof p?n:p,a=Object.create(o.prototype),c=new k(r||[]);return i(a,"_invoke",{value:E(e,t,c)}),a}function f(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h={};function p(){}function m(){}function g(){}var w={};l(w,c,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(C([])));y&&y!==r&&o.call(y,c)&&(w=y);var L=g.prototype=p.prototype=Object.create(w);function b(e){["next","throw","return"].forEach((function(n){l(e,n,(function(e){return this._invoke(n,e)}))}))}function I(n,t){function r(i,a,c,s){var u=f(n[i],n,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==e(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(d).then((function(e){l.value=e,c(l)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function E(e,n,t){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return S()}for(t.method=o,t.arg=i;;){var a=t.delegate;if(a){var c=x(a,t);if(c){if(c===h)continue;return c}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var s=f(e,n,t);if("normal"===s.type){if(r=t.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:t.done}}"throw"===s.type&&(r="completed",t.method="throw",t.arg=s.arg)}}}function x(e,n){var t=e.iterator[n.method];if(void 0===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=void 0,x(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=f(t,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,h;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,h):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function T(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function N(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function C(e){if(e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var t=-1,r=function n(){for(;++t<e.length;)if(o.call(e,t))return n.value=e[t],n.done=!1,n;return n.value=void 0,n.done=!0,n};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return m.prototype=g,i(L,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:m,configurable:!0}),m.displayName=l(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===m||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,u,"GeneratorFunction")),e.prototype=Object.create(L),e},t.awrap=function(e){return{__await:e}},b(I.prototype),l(I.prototype,s,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new I(d(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(L),l(L,u,"Generator"),l(L,c,(function(){return this})),l(L,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var r in n)t.push(r);return t.reverse(),function e(){for(;t.length;){var r=t.pop();if(r in n)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function t(t,r){return a.type="throw",a.arg=e,n.next=t,r&&(n.method="next",n.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),s=o.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=n,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),h},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),N(t),h}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var r=t.completion;if("throw"===r.type){var o=r.arg;N(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,t){return this.delegate={iterator:C(e),resultName:n,nextLoc:t},"next"===this.method&&(this.arg=void 0),h}},t}function t(e,n,t,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function r(e){return function(){var n=this,r=arguments;return new Promise((function(o,i){var a=e.apply(n,r);function c(e){t(a,o,i,c,s,"next",e)}function s(e){t(a,o,i,c,s,"throw",e)}c(void 0)}))}}chrome.auth=new function(){var e=this;function t(){return extension.activeTabId}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise((function(n){if(!e)return n();var t={IdToken:new chrome.CognitoIdToken({IdToken:e.idToken.jwtToken}),AccessToken:new chrome.CognitoAccessToken({AccessToken:e.accessToken.jwtToken}),RefreshToken:new chrome.CognitoRefreshToken({RefreshToken:e.refreshToken.token}),ClockDrift:e.clockDrift},r=new chrome.CognitoUserSession(t),o={Username:r.getIdToken().payload["cognito:username"],Pool:new chrome.CognitoUserPool({UserPoolId:"us-east-1_cIskjGoJg",ClientId:"2o2ltcq8tnme2fidk35frk2kt4"})};chrome.cognitoUser=new chrome.CognitoUser(o),chrome.cognitoUser.setSignInUserSession(r),n()})).catch((function(e){}))}function i(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";chrome.storage.sync.get(["userInfo"],(function(t){var r=t.userInfo&&t.userInfo.id?t.userInfo.id:null;if(r){var i={email:t.userInfo.email,id:r,username:t.userInfo.username,session:t.userInfo.session};return o(i.session).then((function(){return"init"==n&&(i.licenseTimestamp=Date.now()),d(i.id,i.username)})).then((function(n){var t=n.license,r=n.pwLicNum?n.pwLicNum.toString():"0",o=n.pwLicCode?n.pwLicCode:"0",a=n.pwLicType?n.pwLicType:"pw";t?(i.licNum=t.licNum,i.license=t.licNum.toString(),i.licCode=t.licCode,i.pwLicNum=r,i.pwLicCode=o,i.pwLicType=a,t.ownerEmail&&(i.ownerEmail=t.ownerEmail)):(i.licNum=0,i.license="0",i.licCode="0",i.pwLicNum="0",i.pwLicCode="0",i.pwLicType="pw"),readingBar.setReadingBarSetting({key:"userInfo",value:i}),chrome.pe.getPeListForUser(readingBar.settings.loggedIn,i);var c=e.currentExtId&&e.currentExtId>0?e.currentExtId:extension.activeTabId;c>0&&chrome.tabs.sendMessage(c,{fn:"setLoggedInUI"},(function(){chrome.runtime.lastError})),(0!=i.licNum||reader.hasInvalidLicenseError)&&extension.beingReadTabId>0&&chrome.tabs.sendMessage(extension.beingReadTabId,{fn:"clearBlobsWithError"},(function(){chrome.runtime.lastError}));try{reader.isWaitingForLicense&&reader.onLicenseUpdated()}catch(e){reader.stop()}}))}}))}function a(n){e.isProcessing=!0;var t="";"login"===n?t="https://www.naturalreaders.com/login-service/login?redir=ext-login&dest=ext/loading":"logout"===n?t="https://www.naturalreaders.com/login-service/extension/loggedout":"signup"===n&&(t="https://www.naturalreaders.com/login-service/signup?redir=ext-login&dest=ext/loading"),chrome.tabs.create({url:t,active:!1},(function(t){var r=t.id,o=0,i=0;e.tabId=r,chrome.tabs.sendMessage(extension.activeTabId,{fn:"calculateScreenCenter",width:400,height:700},(function(t){t&&(t.top&&(i=t.top),t.left&&(o=t.left)),chrome.windows.create({tabId:r,type:"popup",focused:!0,width:400,height:700,left:o,top:i},(function(t){e.windowId=t.id,chrome.windows.onFocusChanged.addListener((function n(r){t.id===r||e.isProcessing||(chrome.windows.remove(t.id,(function(){chrome.runtime.lastError})),chrome.windows.onFocusChanged.removeListener(n))})),chrome.windows.onRemoved.addListener((function n(t){e.windowId===t&&(e.isProcessing=!1,chrome.windows.onRemoved.removeListener(n))})),chrome.tabs.onUpdated.addListener((function t(r,o){if(r==e.tabId&&"complete"===o.status)return"login"===n?chrome.tabs.sendMessage(r,{fn:"login"},(function(){chrome.runtime.lastError})):"logout"===n?chrome.tabs.sendMessage(r,{fn:"logout"},(function(){chrome.runtime.lastError})):"signup"===n&&chrome.tabs.sendMessage(r,{fn:"signup"},(function(){chrome.runtime.lastError})),void chrome.tabs.onUpdated.removeListener(t)}))}))}))}))}function c(n,t,r){var i,a=t.tab.id;if(n.session&&o(n.session),n&&n.user&&"string"==typeof n.user&&(i=JSON.parse(n.user)),i){var c={};c.email=i.userid,c.id=i.id,c.username=i.username,c.session=n.session,n.alreadyLoggedIn||chrome.tabs.sendMessage(a,{fn:"onAlreadyLoggedIn"},(function(){chrome.runtime.lastError}));var s=n.license?JSON.parse(n.license):null,u=n.pwLicense?JSON.parse(n.pwLicense):s,l=u?u.num.toString():"0",f=u?u.licCode:"0",h=u?u.type:"pw";if(s&&"0"!=s.num){c.license=s.num.toString(),c.licNum=s.licNum,c.licCode=s.licCode,c.pwLicNum=l,c.pwLicCode=f,c.session=n.session,c.pwLicType=h,s.ownerEmail&&(c.ownerEmail=s.ownerEmail),readingBar.setReadingBarSetting({key:"userInfo",value:c}),readingBar.setReadingBarSetting({key:"loggedIn",value:1}),0!=c.licNum&&extension.beingReadTabId>0&&chrome.tabs.sendMessage(extension.beingReadTabId,{fn:"clearBlobsWithError"},(function(){chrome.runtime.lastError}));var p=e.currentExtId&&e.currentExtId>0?e.currentExtId:extension.activeTabId;chrome.tabs.sendMessage(p,{fn:"setLoggedInUI"},(function(){chrome.runtime.lastError})),e.isProcessing=!1,r({ok:!0})}else d(i.id,i.username).then((function(n){s=n.license,l=n.pwLicNum?n.pwLicNum.toString():"0",f=n.pwLicCode?n.pwLicCode:"0",h=n.pwLicType?n.pwLicType:"pw",s?(c.licNum=s.licNum,c.license=s.licNum.toString(),c.licCode=s.licCode,c.pwLicNum=l,c.pwLicCode=f,c.pwLicType=h,s.ownerEmail&&(c.ownerEmail=s.ownerEmail)):(c.licNum=0,c.license="0",c.licCode="0",c.pwLicNum="0",c.pwLicCode="0",c.pwLicType="pw",c.session=null),readingBar.setReadingBarSetting({key:"userInfo",value:c}),readingBar.setReadingBarSetting({key:"loggedIn",value:1}),0!=c.licNum&&extension.beingReadTabId>0&&chrome.tabs.sendMessage(extension.beingReadTabId,{fn:"clearBlobsWithError"},(function(){chrome.runtime.lastError}));var t=e.currentExtId&&e.currentExtId>0?e.currentExtId:extension.activeTabId;chrome.tabs.sendMessage(t,{fn:"setLoggedInUI"},(function(){chrome.runtime.lastError})),chrome.pe.getPeListForUser(readingBar.settings.loggedIn,readingBar.settings.userInfo),e.isProcessing=!1}))}else chrome.tabs.onUpdated.addListener((function(e,n,t){e===a&&null!=n.url&&(n.url.includes("https://www.naturalreaders.com/login-service/auth-password?email=")&&chrome.tabs.sendMessage(a,{fn:"clearLogin"},(function(){chrome.runtime.lastError})),n.url.includes("https://www.naturalreaders.com/login-service/extension/loggedin")&&chrome.tabs.sendMessage(a,{fn:"onLogin"},(function(){chrome.runtime.lastError})))}))}function s(n,t,r){e.isProcessing=!1;readingBar.setReadingBarSetting({key:"userInfo",value:{licNum:0,license:"0",pwLicNum:"0",pwLicCode:"0",email:"user@naturalreaders.com",id:null,username:"",licCode:"0",session:null}}),readingBar.setReadingBarSetting({key:"loggedIn",value:0});var o=e.currentExtId&&e.currentExtId>0?e.currentExtId:extension.activeTabId;chrome.tabs.sendMessage(o,{fn:"setLoggedOutUI"},(function(){chrome.runtime.lastError})),chrome.pe.setPeAndTts([]),r({ok:!0})}function u(e,n,t,r){return l.apply(this,arguments)}function l(){return(l=r(n().mark((function e(t,r,o,i){var a,c,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:t,username:r,provider:o,app:"ext"},c={"Content-Type":"application/json"},(s=new URL("https://rrauikxmbg.execute-api.us-east-1.amazonaws.com/prod/"+i)).search=new URLSearchParams(a),e.abrupt("return",fetch(s,c).then((function(e){return Promise.resolve(e.json())})).catch((function(e){})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,n){return Promise.all([u(e,n,"pw","billing"),u(e,n,"edu","license")]).then((function(e){var n=e[0],t=e[1];if(n){var r=n&&n.planDefine&&!f(n.status)?n.planDefine.licNum:0,o=n&&n.planDefine&&!f(n.status)?n.planDefine.plan:"0",i=n&&n.planDefine&&!f(n.status)?{licNum:n.planDefine.licNum,licCode:n.planDefine.plan}:null,a=n&&n.planDefine&&!f(n.status)?n.app:"pw";"stripe"===a&&(a="pw");var c=t&&t.planDefine?t.planDefine.licNum:0,s=t&&t.planDefine?{licNum:t.planDefine.licNum,licCode:t.planDefine.plan,ownerEmail:t.ownerEmail?t.ownerEmail:""}:null;return 13==r||12==r?{license:i,pwLicNum:r,pwLicCode:o,pwLicType:a}:c>=31&&c<=37?{license:s,pwLicNum:r,pwLicCode:o,pwLicType:a}:{license:null,pwLicNum:r,pwLicCode:o,pwLicType:a}}return{license:null,pwLicNum:"0",pwLicCode:"0",pwLicType}})).catch((function(e){}))}function f(e){return!1}e.windowId=null,e.isProcessing=!1,e.tabId=null,e.currentExtId=-1,e.login=function(n,r,o){e.currentExtId=t(),a("login")},e.signup=function(n,r,o){e.currentExtId=t(),a("signup")},e.logout=function(n,r,o){e.currentExtId=t(),a("logout")},e.signupHelper=function(e,n,t){var r=n.tab.id;chrome.tabs.onUpdated.addListener((function(e,n,t){e===r&&null!=n.url&&(n.url.includes("https://naturalreaders.com/login-service/login?redir=ext-login&dest=ext/loading")&&chrome.tabs.sendMessage(r,{fn:"loginAfterSignup"},(function(){chrome.runtime.lastError})),n.url.includes("https://www.naturalreaders.com/login-service/extension/loggedin")&&chrome.tabs.sendMessage(r,{fn:"onLogin"},(function(){chrome.runtime.lastError})))}))},e.loginHelper=c,e.logoutHelper=s,e.updateLicense=i,function(){chromeRuntimeMsgExternal.setFilter("authLogin",c.bind(this)),chromeRuntimeMsgExternal.setFilter("authLogout",s.bind(this)),chrome.runtime.onMessage.addListener((function(e,n,t){e.fn in chrome.auth&&chrome.auth[e.fn](e,n,t)})),chrome.storage.sync.get(["userInfo"],(function(e){(!e||!e.userInfo||e.userInfo&&(!e.userInfo.licenseTimestamp||Date.now()-e.userInfo.licenseTimestamp>864e5))&&i("init")}))}()}})();